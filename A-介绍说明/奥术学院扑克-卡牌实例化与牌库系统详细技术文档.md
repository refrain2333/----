# å¥¥æœ¯å­¦é™¢æ‰‘å…‹ - å¡ç‰Œå®ä¾‹åŒ–ä¸ç‰Œåº“ç³»ç»Ÿè¯¦ç»†æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [ç³»ç»Ÿæ¶æ„æ¦‚è¿°](#ç³»ç»Ÿæ¶æ„æ¦‚è¿°)
2. [æ ¸å¿ƒç»„ä»¶è¯¦è§£](#æ ¸å¿ƒç»„ä»¶è¯¦è§£)
3. [å¡ç‰Œå®ä¾‹åŒ–æµç¨‹](#å¡ç‰Œå®ä¾‹åŒ–æµç¨‹)
4. [ç‰Œåº“ç®¡ç†ç³»ç»Ÿ](#ç‰Œåº“ç®¡ç†ç³»ç»Ÿ)
5. [é¢„åˆ¶æ•°æ®ç³»ç»Ÿ](#é¢„åˆ¶æ•°æ®ç³»ç»Ÿ)
6. [æµ‹è¯•éªŒè¯æœºåˆ¶](#æµ‹è¯•éªŒè¯æœºåˆ¶)
7. [å®é™…åº”ç”¨ç¤ºä¾‹](#å®é™…åº”ç”¨ç¤ºä¾‹)
8. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è¿°

### æ•´ä½“æ¶æ„æ¨¡å¼ï¼šæ•°æ®é©±åŠ¨ + MVC

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¥¥æœ¯å­¦é™¢æ‰‘å…‹å¡ç‰Œç³»ç»Ÿ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å±‚ (Model)          â”‚  è§†å›¾å±‚ (View)         â”‚  æ§åˆ¶å±‚ (Controller) â”‚
â”‚                         â”‚                       â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   CardData      â”‚â—„â”€â”€â–ºâ”‚  â”‚   CardView      â”‚â—„â”€â”¤  â”‚  CardManager    â”‚ â”‚
â”‚  â”‚   (.tresæ–‡ä»¶)    â”‚    â”‚  â”‚   (Card.tscn)   â”‚  â”‚  â”‚                 â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚  â”‚                 â”‚  â”‚  â”‚ â€¢ ç‰Œåº“ç®¡ç†      â”‚ â”‚
â”‚  â”‚ â€¢ åŸºç¡€å±æ€§      â”‚    â”‚  â”‚ â€¢ è§†è§‰æ˜¾ç¤º      â”‚  â”‚  â”‚ â€¢ æ‰‹ç‰Œç®¡ç†      â”‚ â”‚
â”‚  â”‚ â€¢ å¼ºåŒ–æ•ˆæœ      â”‚    â”‚  â”‚ â€¢ ç”¨æˆ·äº¤äº’      â”‚  â”‚  â”‚ â€¢ æŠ½ç‰Œé€»è¾‘      â”‚ â”‚
â”‚  â”‚ â€¢ æ•°å€¼è®¡ç®—      â”‚    â”‚  â”‚ â€¢ åŠ¨ç”»æ•ˆæœ      â”‚  â”‚  â”‚ â€¢ å¼ƒç‰Œé€»è¾‘      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â”‚                       â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ResourcePaths   â”‚    â”‚  â”‚  HandDock       â”‚  â”‚  â”‚ EffectManager   â”‚ â”‚
â”‚  â”‚ (è·¯å¾„è®¡ç®—å·¥å…·)   â”‚    â”‚  â”‚  (æ‰‹ç‰Œå®¹å™¨)     â”‚  â”‚  â”‚ (æ•ˆæœå¤„ç†å™¨)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **æ•°æ®é©±åŠ¨**: æ‰€æœ‰å¡ç‰Œå±æ€§é€šè¿‡`.tres`èµ„æºæ–‡ä»¶å®šä¹‰ï¼Œæ”¯æŒçƒ­æ›´æ–°
2. **ç»„ä»¶åŒ–**: æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œé€šè¿‡ä¿¡å·ç³»ç»Ÿé€šä¿¡
3. **å¯æ‰©å±•æ€§**: æ”¯æŒåŠ¨æ€æ·»åŠ æ–°å¡ç‰Œã€æ–°æ•ˆæœã€æ–°å¼ºåŒ–ç±»å‹
4. **æ€§èƒ½ä¼˜åŒ–**: å¯¹è±¡æ± ã€å»¶è¿ŸåŠ è½½ã€æ‰¹é‡æ“ä½œç­‰ä¼˜åŒ–ç­–ç•¥
5. **æµ‹è¯•å‹å¥½**: å®Œæ•´çš„æµ‹è¯•æ¡†æ¶ï¼Œæ”¯æŒå•å…ƒæµ‹è¯•å’Œå¯è§†åŒ–æµ‹è¯•

---

## ğŸ§© æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. CardData - å¡ç‰Œæ•°æ®æ¨¡å‹

**æ–‡ä»¶ä½ç½®**: `cs/å¡ç‰Œç³»ç»Ÿ/æ•°æ®/CardData.gd`

**æ ¸å¿ƒèŒè´£**: å­˜å‚¨å’Œç®¡ç†å•å¼ å¡ç‰Œçš„æ‰€æœ‰æ•°æ®å±æ€§

```gdscript
class_name CardData extends Resource

# åŸºç¡€å±æ€§ - ç¬¦åˆv1.6è§„èŒƒ
@export var id: String = ""           # å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¦‚"H3"è¡¨ç¤ºçº¢æ¡ƒ3
@export var base_value: int = 0       # åŸºç¡€ç‚¹æ•° (1-13)
@export var suit: String = ""         # èŠ±è‰² ("hearts", "diamonds", "clubs", "spades")
@export var name: String = ""         # æ˜¾ç¤ºåç§°ï¼Œå¦‚"çº¢æ¡ƒ3"
@export var image_path: String = ""   # å›¾ç‰‡èµ„æºè·¯å¾„

# å¼ºåŒ–å±æ€§ - æ”¯æŒå¤šå±‚æ¬¡å¼ºåŒ–
@export var wax_seals: Array[String] = []    # èœ¡å°æ•ˆæœæ•°ç»„ï¼Œæ”¯æŒå¤šä¸ªèœ¡å°
@export var frame_type: String = ""          # ç‰Œæ¡†ç±»å‹ (STONE/SILVER/GOLD)
@export var material_type: String = ""       # æè´¨ç±»å‹ (GLASS/ROCK/METAL)

# æ¸¸æˆç‰¹å®šå±æ€§
@export var damage: int = 0           # ä¼¤å®³å€¼
@export var defense: int = 0          # é˜²å¾¡å€¼
@export var cost: int = 0             # ä½¿ç”¨æ¶ˆè€—
@export var rarity: String = "common" # ç¨€æœ‰åº¦
@export var description: String = ""  # å¡ç‰Œæè¿°

# åŠ¨æ€å±æ€§ç³»ç»Ÿ
var modifiers: Dictionary = {}        # å­˜å‚¨å„ç§ä¿®æ­£å€¼
var temporary_effects: Array[Dictionary] = []  # ä¸´æ—¶æ•ˆæœ
```

**å…³é”®æ–¹æ³•è§£æ**:

```gdscript
# è·å–ä¿®æ­£åçš„æ•°å€¼ï¼ˆè€ƒè™‘å¼ºåŒ–æ•ˆæœå’Œä¸´æ—¶ä¿®æ­£ï¼‰
func get_modified_value(effect_provider = null) -> int:
    var modified_val = base_value
    
    # åº”ç”¨ç‰Œæ¡†å¼ºåŒ–
    if has_frame_reinforcement():
        match frame_type:
            "STONE": modified_val += 2
            "SILVER": modified_val += 3
            "GOLD": modified_val += 5
    
    # åº”ç”¨èœ¡å°æ•ˆæœ
    for seal in wax_seals:
        match seal:
            "RED": modified_val += 1
            "BLUE": modified_val += 2
            "PURPLE": modified_val += 3
    
    # åº”ç”¨ä¸´æ—¶æ•ˆæœ
    for effect in temporary_effects:
        if effect.type == "VALUE_MODIFIER":
            modified_val += effect.value
    
    return modified_val

# æ·±æ‹·è´å¡ç‰Œå®ä¾‹ï¼ˆç”¨äºå¤åˆ¶ç‰Œï¼‰
func clone() -> CardData:
    var new_card = CardData.new()
    new_card.id = id + "_" + str(randi())  # å¤åˆ¶å“æœ‰æ–°ID
    new_card.base_value = base_value
    new_card.suit = suit
    new_card.name = name
    new_card.image_path = image_path
    new_card.wax_seals = wax_seals.duplicate()  # æ·±æ‹·è´æ•°ç»„
    new_card.frame_type = frame_type
    new_card.material_type = material_type
    return new_card
```

### 2. ResourcePaths - èµ„æºè·¯å¾„ç®¡ç†å™¨

**æ–‡ä»¶ä½ç½®**: `cs/å¡ç‰Œç³»ç»Ÿ/è§†å›¾/ResourcePaths.gd`

**æ ¸å¿ƒèŒè´£**: ç»Ÿä¸€ç®¡ç†æ‰€æœ‰èµ„æºæ–‡ä»¶çš„è·¯å¾„è®¡ç®—å’Œæ˜ å°„

```gdscript
class_name ResourcePaths extends RefCounted

# è·¯å¾„å¸¸é‡å®šä¹‰
const CARD_IMAGES_PATH = "res://assets/images/pokers/"
const CARD_DATA_PATH = "res://assets/data/cards/"

# 52å¼ æ ‡å‡†æ‰‘å…‹ç‰Œçš„ç´¢å¼•æ˜ å°„è§„åˆ™
static func get_card_image_path(card_id: String) -> String:
    var suit = card_id[0]  # ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯èŠ±è‰² (S/H/D/C)
    var value = card_id.substr(1)  # å‰©ä½™éƒ¨åˆ†æ˜¯ç‚¹æ•° (1-13)
    
    # èŠ±è‰²åç§»é‡æ˜ å°„
    var suit_offset = {
        "S": 0,    # é»‘æ¡ƒ (Spades):   1-13  (1.jpg  - 13.jpg)
        "H": 13,   # çº¢æ¡ƒ (Hearts):   14-26 (14.jpg - 26.jpg)
        "D": 26,   # æ–¹ç‰‡ (Diamonds): 27-39 (27.jpg - 39.jpg)
        "C": 39    # æ¢…èŠ± (Clubs):    40-52 (40.jpg - 52.jpg)
    }
    
    # è®¡ç®—æœ€ç»ˆå›¾ç‰‡ç´¢å¼•
    var index = suit_offset.get(suit, 0) + int(value)
    return CARD_IMAGES_PATH + str(index) + ".jpg"
```

**è·¯å¾„æ˜ å°„ç¤ºä¾‹**:
- è¾“å…¥: `"H3"` (çº¢æ¡ƒ3) â†’ è¾“å‡º: `"res://assets/images/pokers/16.jpg"`
- è¾“å…¥: `"S1"` (é»‘æ¡ƒA) â†’ è¾“å‡º: `"res://assets/images/pokers/1.jpg"`
- è¾“å…¥: `"C13"` (æ¢…èŠ±K) â†’ è¾“å‡º: `"res://assets/images/pokers/52.jpg"`

### 3. CardView - å¡ç‰Œè§†å›¾æ§åˆ¶å™¨

**æ–‡ä»¶ä½ç½®**: `cs/å¡ç‰Œç³»ç»Ÿ/è§†å›¾/CardView.gd`
**åœºæ™¯æ–‡ä»¶**: `cs/å¡ç‰Œç³»ç»Ÿ/è§†å›¾/Card.tscn`

**æ ¸å¿ƒèŒè´£**: ç®¡ç†å•å¼ å¡ç‰Œçš„è§†è§‰æ˜¾ç¤ºå’Œç”¨æˆ·äº¤äº’

```gdscript
# èŠ‚ç‚¹å¼•ç”¨
@onready var front_texture: TextureRect = $CardFront
@onready var back_texture: TextureRect = $CardBack
@onready var card_name_label: Label = $CardFront/NameLabel
@onready var card_power_label: Label = $CardFront/PowerLabel

# å¼ºåŒ–æ•ˆæœæ˜¾ç¤ºç»„ä»¶
@onready var frame_node: Node2D = $ReinforcementEffects/Frame
@onready var wax_seals_container: Node2D = $ReinforcementEffects/WaxSeals
@onready var material_effect: ColorRect = $ReinforcementEffects/Material

# ä¿¡å·ç³»ç»Ÿ
signal card_clicked(card_view)
signal card_dragged(card_view)
signal selection_changed(card_view, is_selected)
```

**åœºæ™¯èŠ‚ç‚¹ç»“æ„**:
```
Card (Control) - æ ¹èŠ‚ç‚¹
â”œâ”€â”€ CardFront (TextureRect) - æ­£é¢æ˜¾ç¤º
â”‚   â”œâ”€â”€ NameLabel (Label) - å¡ç‰‡åç§°
â”‚   â”œâ”€â”€ ElementLabel (Label) - èŠ±è‰²ç¬¦å·  
â”‚   â””â”€â”€ PowerLabel (Label) - ç‚¹æ•°æ˜¾ç¤º
â”œâ”€â”€ CardBack (TextureRect) - èƒŒé¢æ˜¾ç¤º
â”œâ”€â”€ Highlight (Panel) - é«˜äº®æ•ˆæœ
â”œâ”€â”€ ReinforcementEffects (Node2D) - å¼ºåŒ–æ•ˆæœå®¹å™¨
â”‚   â”œâ”€â”€ Frame (Node2D) - ç‰Œæ¡†æ•ˆæœ
â”‚   â”œâ”€â”€ WaxSeals (Node2D) - èœ¡å°æ•ˆæœ
â”‚   â””â”€â”€ Material (ColorRect) - æè´¨æ•ˆæœ
â””â”€â”€ AnimationPlayer - åŠ¨ç”»æ’­æ”¾å™¨
```

### 4. CardManager - ç‰Œåº“ç®¡ç†æ ¸å¿ƒ

**æ–‡ä»¶ä½ç½®**: `cs/å¡ç‰Œç³»ç»Ÿ/æ•°æ®/ç®¡ç†å™¨/CardManager.gd`

**æ ¸å¿ƒèŒè´£**: ç®¡ç†ç‰Œåº“ã€æ‰‹ç‰Œã€å¼ƒç‰Œå †ã€é”€æ¯å †çš„æ‰€æœ‰é€»è¾‘

```gdscript
class_name CardManager extends Node

# æ ¸å¿ƒæ•°æ®ç»“æ„
var deck: Array[CardData] = []          # ç‰Œåº“ï¼ˆä¸»æŠ½ç‰Œå †ï¼‰
var hand: Array[CardData] = []          # ç©å®¶æ‰‹ç‰Œ
var discard_pile: Array[CardData] = []  # å¼ƒç‰Œå †
var destroyed_pile: Array[CardData] = [] # é”€æ¯å †ï¼ˆæ°¸ä¹…ç§»å‡ºæ¸¸æˆï¼‰
var all_base_cards: Array[CardData] = [] # æ‰€æœ‰åŸå§‹å¡ç‰Œèµ„æº

# é…ç½®å‚æ•°
var max_hand_size: int = 5
var base_draw_count: int = 1

# ä¿¡å·ç³»ç»Ÿ - ç”¨äºUIåŒæ­¥
signal hand_changed(hand_cards)
signal deck_changed(deck_size)
signal discard_pile_changed(discard_size)
signal destroyed_pile_changed(destroyed_size)
signal card_played(card_data)
signal cards_played(played_cards, score_gained)
signal card_drawn(card_data)
signal card_discarded(card_data)
signal card_reinforced(card_data, reinforcement_type, reinforcement_effect)
```

---

## ğŸ”„ å¡ç‰Œå®ä¾‹åŒ–æµç¨‹

### å®Œæ•´å®ä¾‹åŒ–æµç¨‹å›¾

```
å¼€å§‹
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. æ•°æ®å‡†å¤‡     â”‚ â† ä».tresæ–‡ä»¶æˆ–ä»£ç åˆ›å»ºCardData
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. è·¯å¾„è®¡ç®—     â”‚ â† ResourcePathsè®¡ç®—å›¾ç‰‡è·¯å¾„
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. æ•°æ®éªŒè¯     â”‚ â† éªŒè¯æ•°æ®å®Œæ•´æ€§å’Œèµ„æºå­˜åœ¨æ€§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. è§†å›¾åˆ›å»º     â”‚ â† å®ä¾‹åŒ–Card.tscnåœºæ™¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. æ•°æ®ç»‘å®š     â”‚ â† CardView.setup(card_data)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. è§†è§‰æ›´æ–°     â”‚ â† æ›´æ–°å›¾ç‰‡ã€æ–‡æœ¬ã€å¼ºåŒ–æ•ˆæœ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. ä¿¡å·è¿æ¥     â”‚ â† è¿æ¥ç”¨æˆ·äº¤äº’ä¿¡å·
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. åœºæ™¯é›†æˆ     â”‚ â† æ·»åŠ åˆ°æ‰‹ç‰Œå®¹å™¨æˆ–å…¶ä»–UI
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
å®Œæˆ
```

### é˜¶æ®µä¸€ï¼šæ•°æ®å‡†å¤‡

```gdscript
# æ–¹å¼1ï¼šä»é¢„åˆ¶.tresæ–‡ä»¶åŠ è½½
func load_card_from_preset(card_id: String) -> CardData:
    var file_path = "res://assets/data/cards/" + card_id + ".tres"
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if not ResourceLoader.exists(file_path):
        push_error("å¡ç‰Œæ–‡ä»¶ä¸å­˜åœ¨: " + file_path)
        return null
    
    # åŠ è½½èµ„æº
    var card_data = load(file_path) as CardData
    if not card_data:
        push_error("æ— æ³•åŠ è½½CardData: " + file_path)
        return null
    
    print("æˆåŠŸåŠ è½½é¢„åˆ¶å¡ç‰Œ: %s" % card_data.name)
    return card_data

# æ–¹å¼2ï¼šä»£ç åŠ¨æ€åˆ›å»º
func create_card_data_programmatically(card_id: String, value: int, suit: String, name: String) -> CardData:
    var card_data = CardData.new()
    card_data.id = card_id
    card_data.base_value = value
    card_data.suit = suit
    card_data.name = name
    card_data.image_path = ResourcePaths.get_card_image_path(card_id)
    
    return card_data
```

### é˜¶æ®µäºŒï¼šæ•°æ®éªŒè¯

```gdscript
func validate_card_data(card_data: CardData) -> bool:
    var issues = []
    
    # åŸºç¡€å±æ€§éªŒè¯
    if card_data.id.is_empty():
        issues.append("IDä¸ºç©º")
    
    if card_data.name.is_empty():
        issues.append("åç§°ä¸ºç©º")
    
    if card_data.base_value < 1 or card_data.base_value > 13:
        issues.append("æ•°å€¼è¶…å‡ºèŒƒå›´(1-13): " + str(card_data.base_value))
    
    if not card_data.suit in ["hearts", "diamonds", "clubs", "spades"]:
        issues.append("æ— æ•ˆèŠ±è‰²: " + card_data.suit)
    
    # èµ„æºæ–‡ä»¶éªŒè¯
    if card_data.image_path.is_empty():
        issues.append("å›¾ç‰‡è·¯å¾„ä¸ºç©º")
    elif not ResourceLoader.exists(card_data.image_path):
        issues.append("å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨: " + card_data.image_path)
    
    # è¾“å‡ºéªŒè¯ç»“æœ
    if issues.size() > 0:
        push_error("å¡ç‰Œæ•°æ®éªŒè¯å¤±è´¥: " + str(issues))
        return false
    
    return true
```

### é˜¶æ®µä¸‰ï¼šè§†å›¾åˆ›å»ºä¸ç»‘å®š

```gdscript
func create_card_view(card_data: CardData) -> Control:
    # 1. åŠ è½½å¡ç‰Œåœºæ™¯
    var CardScene = preload("res://cs/å¡ç‰Œç³»ç»Ÿ/è§†å›¾/Card.tscn")
    var card_view = CardScene.instantiate()
    
    if not card_view:
        push_error("æ— æ³•å®ä¾‹åŒ–Cardåœºæ™¯")
        return null
    
    # 2. ç»‘å®šæ•°æ®åˆ°è§†å›¾
    card_view.setup(card_data)
    
    # 3. é…ç½®è§†å›¾å±æ€§
    card_view.scale = Vector2(0.8, 0.8)
    card_view.set_draggable(true)
    
    # 4. è¿æ¥ä¿¡å·
    _connect_card_signals(card_view)
    
    return card_view

func _connect_card_signals(card_view: Control):
    # è¿æ¥ç”¨æˆ·äº¤äº’ä¿¡å·
    if card_view.has_signal("card_clicked"):
        card_view.card_clicked.connect(_on_card_clicked)
    if card_view.has_signal("card_dragged"):
        card_view.card_dragged.connect(_on_card_dragged)
    if card_view.has_signal("selection_changed"):
        card_view.selection_changed.connect(_on_card_selection_changed)
```

---

## ğŸ—ƒï¸ ç‰Œåº“ç®¡ç†ç³»ç»Ÿ

### ç‰Œåº“åˆå§‹åŒ–æµç¨‹

```gdscript
# CardManagerä¸­çš„ç‰Œåº“åˆå§‹åŒ–
func initialize_deck(card_pool: Array = []):
    # 1. æ¸…ç©ºæ‰€æœ‰å¡å †
    deck.clear()
    hand.clear()
    discard_pile.clear()
    destroyed_pile.clear()
    
    # 2. ç¡®å®šå¡ç‰Œæ¥æº
    var source_cards = []
    if card_pool.size() > 0:
        source_cards = card_pool  # ä½¿ç”¨æŒ‡å®šå¡æ± 
    else:
        if all_base_cards.is_empty():
            _load_all_card_resources()  # åŠ è½½æ‰€æœ‰é¢„åˆ¶å¡ç‰Œ
        source_cards = all_base_cards
    
    # 3. å…‹éš†å¡ç‰Œåˆ°ç‰Œåº“ï¼ˆé¿å…ä¿®æ”¹åŸå§‹æ•°æ®ï¼‰
    for card_resource in source_cards:
        if card_resource != null:
            var card_clone = card_resource.clone()
            deck.append(card_clone)
    
    # 4. æ´—ç‰Œ
    shuffle_deck()
    
    # 5. å‘å‡ºåˆå§‹åŒ–ä¿¡å·
    emit_signal("deck_changed", deck.size())
    emit_signal("hand_changed", hand)
    
    print("ç‰Œåº“å·²åˆå§‹åŒ–ï¼Œå…± %d å¼ ç‰Œ" % deck.size())
```

### æ ¸å¿ƒç‰Œåº“æ“ä½œ

```gdscript
# æŠ½ç‰Œé€»è¾‘
func draw(count: int = 1) -> Array[CardData]:
    var drawn_cards: Array[CardData] = []
    
    for i in range(count):
        # æ£€æŸ¥ç‰Œåº“æ˜¯å¦ä¸ºç©º
        if deck.is_empty():
            _reshuffle_discard_pile()  # å°†å¼ƒç‰Œå †æ´—å…¥ç‰Œåº“
            if deck.is_empty():
                break  # æ²¡æœ‰æ›´å¤šç‰Œå¯æŠ½
        
        # ä»ç‰Œåº“é¡¶éƒ¨æŠ½ç‰Œ
        var card = deck.pop_front()
        hand.append(card)
        drawn_cards.append(card)
        
        # æ£€æŸ¥æ‰‹ç‰Œä¸Šé™
        if hand.size() >= max_hand_size:
            break
    
    # å‘å‡ºä¿¡å·
    if drawn_cards.size() > 0:
        emit_signal("cards_drawn", drawn_cards)
        emit_signal("hand_changed", hand)
        emit_signal("deck_changed", deck.size())
    
    return drawn_cards

# å¼ƒç‰Œé€»è¾‘
func discard(card_index: int) -> bool:
    if card_index < 0 or card_index >= hand.size():
        return false
    
    var card = hand[card_index]
    hand.remove_at(card_index)
    discard_pile.append(card)
    
    # å‘å‡ºä¿¡å·
    emit_signal("card_discarded", card)
    emit_signal("hand_changed", hand)
    emit_signal("discard_pile_changed", discard_pile.size())
    
    return true

# æ‰“å‡ºå¡ç‰Œé€»è¾‘
func play_cards(cards_to_play: Array[CardData]) -> bool:
    if cards_to_play.is_empty():
        return false
    
    var played_cards = []
    
    # ä»æ‰‹ç‰Œä¸­ç§»é™¤è¦æ‰“å‡ºçš„å¡ç‰Œ
    for card in cards_to_play:
        var index = hand.find(card)
        if index != -1:
            hand.remove_at(index)
            played_cards.append(card)
    
    if played_cards.is_empty():
        return false
    
    # è®¡ç®—å¾—åˆ†ï¼ˆé€šè¿‡ScoreCalculatorï¼‰
    var score_gained = 0
    if score_calculator:
        score_gained = score_calculator.calculate_score(played_cards, GameManager)
    
    # å°†æ‰“å‡ºçš„ç‰Œæ”¾å…¥å¼ƒç‰Œå †
    for card in played_cards:
        discard_pile.append(card)
    
    # å‘å‡ºä¿¡å·
    emit_signal("cards_played", played_cards, score_gained)
    emit_signal("hand_changed", hand)
    emit_signal("discard_pile_changed", discard_pile.size())
    
    return true
```

### æ´—ç‰Œç®—æ³•

```gdscript
# Fisher-Yatesæ´—ç‰Œç®—æ³•
func shuffle_deck():
    if deck.is_empty():
        _reshuffle_discard_pile()
        if deck.is_empty():
            return
    
    # éšæœºæ‰“ä¹±å¡ç‰Œé¡ºåº
    for i in range(deck.size() - 1, 0, -1):
        var j = randi() % (i + 1)
        var temp = deck[i]
        deck[i] = deck[j]
        deck[j] = temp
    
    print("ç‰Œåº“å·²æ´—ç‰Œï¼Œå…± %d å¼ ç‰Œ" % deck.size())

# å°†å¼ƒç‰Œå †é‡æ–°æ´—å…¥ç‰Œåº“
func _reshuffle_discard_pile():
    if discard_pile.is_empty():
        return
    
    # å°†å¼ƒç‰Œå †çš„ç‰Œç§»å›ç‰Œåº“
    deck.append_array(discard_pile)
    discard_pile.clear()
    
    # æ´—ç‰Œ
    shuffle_deck()
    
    # å‘å‡ºä¿¡å·
    emit_signal("discard_pile_shuffled")
    emit_signal("deck_changed", deck.size())
    emit_signal("discard_pile_changed", 0)
    
    print("å¼ƒç‰Œå †å·²é‡æ–°æ´—å…¥ç‰Œåº“")
```

---

## ğŸ“ é¢„åˆ¶æ•°æ®ç³»ç»Ÿ

### é¢„åˆ¶æ•°æ®æ–‡ä»¶ç»“æ„

```
assets/data/cards/
â”œâ”€â”€ æ ‡å‡†å¡ç‰Œ
â”‚   â”œâ”€â”€ H1.tres              # çº¢æ¡ƒA (base_value: 1)
â”‚   â”œâ”€â”€ H2.tres              # çº¢æ¡ƒ2 (base_value: 2)
â”‚   â”œâ”€â”€ H3.tres              # çº¢æ¡ƒ3 (base_value: 3)
â”‚   â””â”€â”€ ...                  # å…¶ä»–æ ‡å‡†å¡ç‰Œ
â”œâ”€â”€ å¼ºåŒ–å˜ä½“
â”‚   â”œâ”€â”€ H3_Enhanced.tres     # å¼ºåŒ–çº¢æ¡ƒ3 (base_value: 5)
â”‚   â”œâ”€â”€ C1_Weak.tres         # è™šå¼±æ¢…èŠ±A (base_value: 1)
â”‚   â””â”€â”€ spade_7.tres         # ç‰¹æ®Šé»‘æ¡ƒ7
â””â”€â”€ æµ‹è¯•å¡ç‰Œ
    â”œâ”€â”€ test_card_1.tres
    â””â”€â”€ test_card_2.tres
```

### é¢„åˆ¶æ•°æ®æ–‡ä»¶ç¤ºä¾‹

**æ ‡å‡†å¡ç‰Œ** (`H3.tres`):
```gdscript
[gd_resource type="Resource" script_class="CardData" load_steps=2 format=3]

[ext_resource type="Script" path="res://cs/å¡ç‰Œç³»ç»Ÿ/æ•°æ®/CardData.gd" id="1_eyyd7"]

[resource]
script = ExtResource("1_eyyd7")
id = "H3"
base_value = 3
suit = "hearts"
name = "çº¢æ¡ƒ3"
image_path = "res://assets/images/pokers/16.jpg"
wax_seals = Array[String]([])
frame_type = ""
material_type = ""
```

**å¼ºåŒ–å˜ä½“** (`H3_Enhanced.tres`):
```gdscript
[gd_resource type="Resource" script_class="CardData" load_steps=2 format=3]

[ext_resource type="Script" path="res://cs/å¡ç‰Œç³»ç»Ÿ/æ•°æ®/CardData.gd" id="1_eyyd7"]

[resource]
script = ExtResource("1_eyyd7")
id = "H3_Enhanced"
base_value = 5                    # å¼ºåŒ–åæ•°å€¼æ›´é«˜
suit = "hearts"
name = "å¼ºåŒ–çº¢æ¡ƒ3"
image_path = "res://assets/images/pokers/16.jpg"
wax_seals = Array[String](["RED"])  # æ·»åŠ çº¢è‰²èœ¡å°
frame_type = "SILVER"             # é“¶è´¨ç‰Œæ¡†
material_type = ""
damage = 8                        # æ›´é«˜çš„ä¼¤å®³å€¼
cost = 4                          # æ›´é«˜çš„ä½¿ç”¨æˆæœ¬
rarity = "rare"                   # ç¨€æœ‰åº¦æå‡
description = "ç»è¿‡å¼ºåŒ–çš„çº¢æ¡ƒ3ï¼Œæ‹¥æœ‰æ›´å¼ºçš„å¨åŠ›"
```

### é¢„åˆ¶æ•°æ®åŠ è½½ç³»ç»Ÿ

```gdscript
# CardManagerä¸­çš„èµ„æºåŠ è½½
func _load_all_card_resources():
    var cards_dir = "res://assets/data/cards/"
    var dir = DirAccess.open(cards_dir)
    
    if not dir:
        push_error("æ— æ³•æ‰“å¼€å¡ç‰Œç›®å½•: " + cards_dir)
        return
    
    all_base_cards.clear()
    
    # æ‰«æç›®å½•ä¸­çš„æ‰€æœ‰.tresæ–‡ä»¶
    dir.list_dir_begin()
    var file_name = dir.get_next()
    
    while file_name != "":
        if file_name.ends_with(".tres"):
            var card_path = cards_dir + file_name
            
            # éªŒè¯å¹¶åŠ è½½å¡ç‰Œèµ„æº
            if _validate_card_file(card_path):
                var card_data = load(card_path) as CardData
                if card_data:
                    all_base_cards.append(card_data)
                    print("åŠ è½½å¡ç‰Œ: %s (%s)" % [card_data.name, card_data.id])
        
        file_name = dir.get_next()
    
    dir.list_dir_end()
    print("å…±åŠ è½½ %d å¼ é¢„åˆ¶å¡ç‰Œ" % all_base_cards.size())

func _validate_card_file(file_path: String) -> bool:
    if not ResourceLoader.exists(file_path):
        return false
    
    var resource = load(file_path)
    if not resource or not resource is CardData:
        push_warning("æ— æ•ˆçš„CardDataèµ„æº: " + file_path)
        return false
    
    return true
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯æœºåˆ¶

### æµ‹è¯•ç³»ç»Ÿæ¶æ„

é¡¹ç›®åŒ…å«å®Œæ•´çš„æµ‹è¯•æ¡†æ¶ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªå±‚æ¬¡ï¼š

1. **å•å…ƒæµ‹è¯•**: éªŒè¯å„ä¸ªç»„ä»¶çš„åŸºæœ¬åŠŸèƒ½
2. **é›†æˆæµ‹è¯•**: éªŒè¯ç»„ä»¶é—´çš„åä½œ
3. **å¯è§†åŒ–æµ‹è¯•**: æä¾›ç›´è§‚çš„åŠŸèƒ½æ¼”ç¤º
4. **æ€§èƒ½æµ‹è¯•**: éªŒè¯ç³»ç»Ÿæ€§èƒ½è¡¨ç°

### PresetCardLoader - é¢„åˆ¶å¡ç‰ŒåŠ è½½æµ‹è¯•

**æ–‡ä»¶ä½ç½®**: `cs/tests/åˆå§‹åŒ–æ‰‹ç‰Œ/PresetCardLoader.gd`

**æµ‹è¯•ç›®æ ‡**: éªŒè¯é¢„åˆ¶å¡ç‰Œæ•°æ®çš„åŠ è½½ã€éªŒè¯å’Œæ˜¾ç¤ºåŠŸèƒ½

```gdscript
# æ ¸å¿ƒæµ‹è¯•æµç¨‹
func _on_load_button_pressed():
    var selected_indices = get_selected_card_indices()
    
    if selected_indices.size() == 0:
        show_error("è¯·å…ˆé€‰æ‹©è¦åŠ è½½çš„å¡ç‰Œ")
        return
    
    print("å¼€å§‹åŠ è½½ %d å¼ å¡ç‰Œ" % selected_indices.size())
    clear_current_hand()
    
    # é€ä¸ªåŠ è½½é€‰ä¸­çš„å¡ç‰Œ
    for index in selected_indices:
        load_card_from_file(index)
    
    update_info_display()

# å•å¼ å¡ç‰ŒåŠ è½½æµ‹è¯•
func load_card_from_file(index: int):
    var card_path = available_cards[index]
    var card_name = card_path.get_file().get_basename()
    
    print("åŠ è½½å¡ç‰Œæ–‡ä»¶: %s" % card_path)
    
    # æ­¥éª¤1: ä»æ–‡ä»¶åŠ è½½CardData
    var card_data = load_card_data(card_path)
    if not card_data:
        print("âŒ æ•°æ®åŠ è½½å¤±è´¥")
        return
    
    # æ­¥éª¤2: åˆ›å»ºå¡ç‰Œè§†å›¾
    var card_view = create_card_view(card_data)
    if not card_view:
        print("âŒ è§†å›¾åˆ›å»ºå¤±è´¥")
        return
    
    # æ­¥éª¤3: æ·»åŠ åˆ°æ‰‹ç‰Œæ˜¾ç¤º
    add_to_hand(card_data, card_view)
    
    print("âœ… å¡ç‰ŒåŠ è½½æˆåŠŸ: %s" % card_data.name)
```

### HandBuildingExample - æ‰‹ç‰Œæ„å»ºæµ‹è¯•

**æ–‡ä»¶ä½ç½®**: `cs/tests/åˆå§‹åŒ–æ‰‹ç‰Œ/HandBuildingExample.gd`

**æµ‹è¯•ç›®æ ‡**: æ¼”ç¤ºå®Œæ•´çš„æ‰‹ç‰Œæ„å»ºæµç¨‹

```gdscript
# æ„å»ºç¤ºä¾‹æ‰‹ç‰Œ
func build_sample_hand():
    var sample_card_ids = ["H3", "S7", "D11", "C1", "H13"]
    
    print("ä»é¢„åˆ¶æ•°æ®æ„å»º %d å¼ å¡ç‰Œ" % sample_card_ids.size())
    
    for i in range(sample_card_ids.size()):
        var card_id = sample_card_ids[i]
        create_and_add_card_from_data(card_id, i)
    
    update_info_display()

# ä»é¢„åˆ¶æ•°æ®åˆ›å»ºå¡ç‰Œ
func create_and_add_card_from_data(card_id: String, index: int):
    # ç¬¬ä¸€æ­¥ï¼šä»é¢„åˆ¶æ•°æ®è·å–å¡ç‰‡
    var card_data = load_card_from_presets(card_id)
    if not card_data:
        print("âŒ æœªæ‰¾åˆ°å¡ç‰Œæ•°æ®: %s" % card_id)
        return
    
    # ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå¡ç‰‡è§†å›¾
    var card_view = create_card_view(card_data)
    
    # ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ åˆ°æ‰‹ç‰Œå®¹å™¨
    add_card_to_hand(card_data, card_view, index)
```

### DeckWidgetTest - ç‰Œåº“æ˜¾ç¤ºæµ‹è¯•

**æ–‡ä»¶ä½ç½®**: `cs/tests/ç‰Œåº“/DeckWidgetTest.gd`

**æµ‹è¯•ç›®æ ‡**: éªŒè¯ç‰Œåº“æµè§ˆå’Œæ˜¾ç¤ºåŠŸèƒ½

```gdscript
# æµ‹è¯•ç‰Œåº“æ˜¾ç¤ºåŠŸèƒ½
func test_deck_display():
    # 1. åŠ è½½æ‰€æœ‰52å¼ æ ‡å‡†æ‰‘å…‹ç‰Œ
    var all_cards = load_standard_deck()
    
    # 2. æŒ‰èŠ±è‰²åˆ†ç»„æ˜¾ç¤º
    display_cards_by_suit(all_cards)
    
    # 3. æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
    show_deck_statistics(all_cards)
    
    # 4. æµ‹è¯•éšæœºé€‰æ‹©åŠŸèƒ½
    test_random_selection(all_cards)

func display_cards_by_suit(cards: Array[CardData]):
    var suits = ["spades", "hearts", "diamonds", "clubs"]
    var suit_names = ["é»‘æ¡ƒ", "çº¢æ¡ƒ", "æ–¹ç‰‡", "æ¢…èŠ±"]
    
    for i in range(suits.size()):
        var suit = suits[i]
        var suit_name = suit_names[i]
        
        # ç­›é€‰å½“å‰èŠ±è‰²çš„å¡ç‰Œ
        var suit_cards = cards.filter(func(card): return card.suit == suit)
        
        # æŒ‰ç‚¹æ•°æ’åº
        suit_cards.sort_custom(func(a, b): return a.base_value < b.base_value)
        
        # åˆ›å»ºæ˜¾ç¤ºå®¹å™¨
        create_suit_display(suit_name, suit_cards)
```

### æµ‹è¯•ç»“æœéªŒè¯

**éªŒè¯æ–‡ä»¶**: `cs/tests/åˆå§‹åŒ–æ‰‹ç‰Œ/éªŒè¯ç»“æœ.md`

```markdown
# æµ‹è¯•éªŒè¯ç»“æœ

## PresetCardLoaderæµ‹è¯•ç»“æœ
âœ… æˆåŠŸæ‰«æ52å¼ é¢„åˆ¶å¡ç‰Œæ–‡ä»¶
âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯é€šè¿‡
âœ… å›¾ç‰‡èµ„æºè·¯å¾„éªŒè¯é€šè¿‡
âœ… å¡ç‰Œè§†å›¾åˆ›å»ºæˆåŠŸ
âœ… å¼ºåŒ–æ•ˆæœæ˜¾ç¤ºæ­£å¸¸

## HandBuildingExampleæµ‹è¯•ç»“æœ  
âœ… æ‰‹ç‰Œæ„å»ºæµç¨‹å®Œæ•´
âœ… å¡ç‰Œæ’åˆ—å¸ƒå±€æ­£ç¡®
âœ… ç”¨æˆ·äº¤äº’å“åº”æ­£å¸¸
âœ… ä¿¡å·ç³»ç»Ÿå·¥ä½œæ­£å¸¸

## DeckWidgetTestæµ‹è¯•ç»“æœ
âœ… 52å¼ å¡ç‰Œå…¨éƒ¨æ˜¾ç¤º
âœ… èŠ±è‰²åˆ†ç»„æ­£ç¡®
âœ… ç»Ÿè®¡ä¿¡æ¯å‡†ç¡®
âœ… æ»šåŠ¨åŠŸèƒ½æ­£å¸¸
```

---

## ğŸ’¡ å®é™…åº”ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šåˆ›å»ºæ ‡å‡†52å¼ ç‰Œåº“

```gdscript
func create_standard_deck() -> Array[CardData]:
    var deck: Array[CardData] = []
    var suits = ["S", "H", "D", "C"]  # é»‘æ¡ƒã€çº¢æ¡ƒã€æ–¹ç‰‡ã€æ¢…èŠ±
    var suit_names = ["spades", "hearts", "diamonds", "clubs"]
    var suit_display_names = ["é»‘æ¡ƒ", "çº¢æ¡ƒ", "æ–¹ç‰‡", "æ¢…èŠ±"]
    
    for suit_index in range(suits.size()):
        var suit_code = suits[suit_index]
        var suit_name = suit_names[suit_index]
        var suit_display = suit_display_names[suit_index]
        
        for value in range(1, 14):  # Aåˆ°K
            var card_data = CardData.new()
            card_data.id = suit_code + str(value)
            card_data.base_value = value
            card_data.suit = suit_name
            card_data.name = suit_display + get_value_display_name(value)
            card_data.image_path = ResourcePaths.get_card_image_path(card_data.id)
            
            deck.append(card_data)
    
    return deck

func get_value_display_name(value: int) -> String:
    match value:
        1: return "A"
        11: return "J"
        12: return "Q"
        13: return "K"
        _: return str(value)
```

### ç¤ºä¾‹2ï¼šåŠ¨æ€ç‰Œåº“ç®¡ç†

```gdscript
# æ ¹æ®éš¾åº¦åŠ¨æ€è°ƒæ•´ç‰Œåº“
func create_difficulty_based_deck(difficulty: String) -> Array[CardData]:
    var base_cards = load_all_preset_cards()
    var filtered_cards = []
    
    match difficulty:
        "easy":
            # ç®€å•æ¨¡å¼ï¼šä½¿ç”¨å¼ºåŒ–ç‰ˆæœ¬çš„å¡ç‰Œ
            for card in base_cards:
                if "_Enhanced" in card.id or card.base_value >= 5:
                    filtered_cards.append(card)
        
        "normal":
            # æ™®é€šæ¨¡å¼ï¼šä½¿ç”¨æ ‡å‡†å¡ç‰Œ
            for card in base_cards:
                if not "_Enhanced" in card.id and not "_Weak" in card.id:
                    filtered_cards.append(card)
        
        "hard":
            # å›°éš¾æ¨¡å¼ï¼šä½¿ç”¨å‰Šå¼±ç‰ˆæœ¬çš„å¡ç‰Œ
            for card in base_cards:
                if "_Weak" in card.id or card.base_value <= 3:
                    filtered_cards.append(card)
    
    return filtered_cards

# åŠ¨æ€æ·»åŠ æ–°å¡ç‰Œåˆ°æ¸¸æˆä¸­
func add_new_card_to_game(card_data: CardData):
    # 1. éªŒè¯å¡ç‰Œæ•°æ®
    if not validate_card_data(card_data):
        push_error("æ— æ•ˆçš„å¡ç‰Œæ•°æ®")
        return false
    
    # 2. æ·»åŠ åˆ°åŸºç¡€å¡ç‰Œæ± 
    all_base_cards.append(card_data)
    
    # 3. å¦‚æœæ¸¸æˆæ­£åœ¨è¿›è¡Œï¼Œæ·»åŠ åˆ°å½“å‰ç‰Œåº“
    if deck.size() > 0:
        var card_clone = card_data.clone()
        deck.append(card_clone)
        shuffle_deck()
    
    # 4. å‘å‡ºä¿¡å·é€šçŸ¥UIæ›´æ–°
    emit_signal("deck_updated")
    
    print("æ–°å¡ç‰Œå·²æ·»åŠ : %s" % card_data.name)
    return true
```

### ç¤ºä¾‹3ï¼šå¡ç‰Œå¼ºåŒ–ç³»ç»Ÿ

```gdscript
# ä¸ºæ‰‹ç‰Œä¸­çš„å¡ç‰Œæ·»åŠ å¼ºåŒ–
func add_reinforcement_to_hand_card(card_index: int, reinforcement_type: String, reinforcement_effect: String) -> bool:
    if card_index < 0 or card_index >= hand.size():
        return false
    
    var card = hand[card_index]
    
    # åº”ç”¨å¼ºåŒ–æ•ˆæœ
    match reinforcement_type:
        "WAX_SEAL":
            if not reinforcement_effect in card.wax_seals:
                card.wax_seals.append(reinforcement_effect)
        
        "FRAME":
            card.frame_type = reinforcement_effect
        
        "MATERIAL":
            card.material_type = reinforcement_effect
    
    # å‘å‡ºå¼ºåŒ–ä¿¡å·
    emit_signal("card_reinforced", card, reinforcement_type, reinforcement_effect)
    emit_signal("hand_changed", hand)
    
    print("å¡ç‰Œå¼ºåŒ–æˆåŠŸ: %s è·å¾— %s %s" % [card.name, reinforcement_type, reinforcement_effect])
    return true

# æ‰¹é‡å¼ºåŒ–å¤šå¼ å¡ç‰Œ
func batch_reinforce_cards(card_indices: Array[int], reinforcement_type: String, reinforcement_effect: String):
    var reinforced_count = 0
    
    for index in card_indices:
        if add_reinforcement_to_hand_card(index, reinforcement_type, reinforcement_effect):
            reinforced_count += 1
    
    print("æ‰¹é‡å¼ºåŒ–å®Œæˆ: %d å¼ å¡ç‰Œè·å¾—å¼ºåŒ–" % reinforced_count)
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. å¯¹è±¡æ± æ¨¡å¼

```gdscript
# å¡ç‰Œè§†å›¾å¯¹è±¡æ± 
class CardViewPool:
    var pool: Array[Control] = []
    var max_pool_size: int = 50
    var CardScene = preload("res://cs/å¡ç‰Œç³»ç»Ÿ/è§†å›¾/Card.tscn")
    
    func get_card_view() -> Control:
        if pool.size() > 0:
            var card_view = pool.pop_back()
            card_view.visible = true
            return card_view
        else:
            return CardScene.instantiate()
    
    func return_card_view(card_view: Control):
        if pool.size() < max_pool_size:
            card_view.visible = false
            if card_view.get_parent():
                card_view.get_parent().remove_child(card_view)
            pool.append(card_view)
        else:
            card_view.queue_free()
```

### 2. å»¶è¿ŸåŠ è½½ç­–ç•¥

```gdscript
# å¼‚æ­¥åŠ è½½å¡ç‰Œå›¾ç‰‡
func load_card_texture_async(card_data: CardData, card_view: Control):
    var path = card_data.image_path
    
    # æ£€æŸ¥èµ„æºæ˜¯å¦å·²åœ¨ç¼“å­˜ä¸­
    if ResourceLoader.has_cached(path):
        var texture = ResourceLoader.load(path)
        card_view.front_texture.texture = texture
        return
    
    # å¼‚æ­¥åŠ è½½
    ResourceLoader.load_threaded_request(path)
    
    # ç­‰å¾…åŠ è½½å®Œæˆ
    while ResourceLoader.load_threaded_get_status(path) != ResourceLoader.THREAD_LOAD_LOADED:
        await get_tree().process_frame
    
    var texture = ResourceLoader.load_threaded_get(path)
    if texture and is_instance_valid(card_view):
        card_view.front_texture.texture = texture
```

### 3. æ‰¹é‡æ“ä½œä¼˜åŒ–

```gdscript
# æ‰¹é‡æ›´æ–°æ‰‹ç‰Œæ˜¾ç¤º
func update_hand_display_batch(new_hand: Array[CardData]):
    # æš‚åœä¿¡å·å‘é€
    set_block_signals(true)
    
    # æ‰¹é‡æ›´æ–°æ“ä½œ
    for i in range(new_hand.size()):
        var card_data = new_hand[i]
        if i < hand_views.size():
            # æ›´æ–°ç°æœ‰è§†å›¾
            hand_views[i].setup(card_data)
        else:
            # åˆ›å»ºæ–°è§†å›¾
            var card_view = create_card_view(card_data)
            hand_container.add_child(card_view)
            hand_views.append(card_view)
    
    # ç§»é™¤å¤šä½™çš„è§†å›¾
    while hand_views.size() > new_hand.size():
        var excess_view = hand_views.pop_back()
        excess_view.queue_free()
    
    # æ¢å¤ä¿¡å·å‘é€å¹¶è§¦å‘æ›´æ–°
    set_block_signals(false)
    emit_signal("hand_changed", new_hand)
```

### 4. å†…å­˜ç®¡ç†ä¼˜åŒ–

```gdscript
# æ™ºèƒ½å†…å­˜æ¸…ç†
func cleanup_unused_resources():
    # æ¸…ç†æœªä½¿ç”¨çš„å¡ç‰Œè§†å›¾
    for i in range(hand_views.size() - 1, -1, -1):
        var view = hand_views[i]
        if not is_instance_valid(view) or not view.get_parent():
            hand_views.remove_at(i)
    
    # æ¸…ç†ä¸´æ—¶æ•ˆæœ
    for card in hand:
        card.temporary_effects = card.temporary_effects.filter(
            func(effect): return effect.duration > 0
        )
    
    # å¼ºåˆ¶åƒåœ¾å›æ”¶
    if hand_views.size() == 0 and deck.size() == 0:
        print("æ‰§è¡Œæ·±åº¦å†…å­˜æ¸…ç†")
        # å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œæ›´æ·±åº¦çš„æ¸…ç†æ“ä½œ
```

---

## ğŸ“Š æ€»ç»“

å¥¥æœ¯å­¦é™¢æ‰‘å…‹çš„å¡ç‰Œå®ä¾‹åŒ–ä¸ç‰Œåº“ç³»ç»Ÿé‡‡ç”¨äº†ä»¥ä¸‹æ ¸å¿ƒè®¾è®¡ï¼š

### ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

1. **æ•°æ®é©±åŠ¨**: é€šè¿‡`.tres`æ–‡ä»¶ç®¡ç†å¡ç‰Œæ•°æ®ï¼Œæ”¯æŒçƒ­æ›´æ–°å’Œå¯è§†åŒ–ç¼–è¾‘
2. **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„MVCæ¶æ„ï¼Œç»„ä»¶é—´æ¾æ•£è€¦åˆ
3. **å®Œæ•´æµ‹è¯•**: å¤šå±‚æ¬¡æµ‹è¯•æ¡†æ¶ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§
4. **æ€§èƒ½ä¼˜åŒ–**: å¯¹è±¡æ± ã€å»¶è¿ŸåŠ è½½ç­‰ä¼˜åŒ–ç­–ç•¥
5. **æ‰©å±•æ€§å¼º**: æ”¯æŒåŠ¨æ€æ·»åŠ æ–°å¡ç‰Œã€æ–°æ•ˆæœã€æ–°å¼ºåŒ–ç±»å‹

### ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹

- **ResourcePaths**: ç»Ÿä¸€çš„èµ„æºè·¯å¾„ç®¡ç†
- **CardData**: åŠŸèƒ½å®Œæ•´çš„æ•°æ®æ¨¡å‹ï¼Œæ”¯æŒå¼ºåŒ–å’Œä¿®æ­£
- **CardView**: å“åº”å¼è§†å›¾ç³»ç»Ÿï¼Œæ”¯æŒåŠ¨ç”»å’Œäº¤äº’
- **CardManager**: å®Œæ•´çš„ç‰Œåº“ç®¡ç†é€»è¾‘
- **ä¿¡å·ç³»ç»Ÿ**: æ¾æ•£è€¦åˆçš„ç»„ä»¶é€šä¿¡

### ğŸš€ å®é™…åº”ç”¨

è¯¥ç³»ç»Ÿå·²æˆåŠŸåº”ç”¨äºå¥¥æœ¯å­¦é™¢æ‰‘å…‹é¡¹ç›®ä¸­ï¼Œæ”¯æŒï¼š
- 52å¼ æ ‡å‡†æ‰‘å…‹ç‰Œçš„å®Œæ•´ç®¡ç†
- å¤šç§å¼ºåŒ–æ•ˆæœï¼ˆèœ¡å°ã€ç‰Œæ¡†ã€æè´¨ï¼‰
- åŠ¨æ€éš¾åº¦è°ƒæ•´
- å®æ—¶æ•°å€¼å¹³è¡¡
- ä¸°å¯Œçš„è§†è§‰æ•ˆæœ

è¿™å¥—ç³»ç»Ÿä¸ºå¡ç‰Œæ¸¸æˆå¼€å‘æä¾›äº†ä¸€ä¸ªç¨³å®šã€é«˜æ•ˆã€å¯æ‰©å±•çš„åŸºç¡€æ¶æ„ã€‚

---

## ğŸ” æ·±å…¥æŠ€æœ¯ç»†èŠ‚

### CardView.setup() æ–¹æ³•è¯¦è§£

CardViewçš„setupæ–¹æ³•æ˜¯æ•´ä¸ªè§†å›¾ç»‘å®šçš„æ ¸å¿ƒï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£å…¶å®ç°ï¼š

```gdscript
# CardView.gd ä¸­çš„æ ¸å¿ƒæ–¹æ³•
func setup(new_card_data: CardData):
    if not new_card_data:
        push_error("CardView.setup: ä¼ å…¥çš„å¡ç‰Œæ•°æ®ä¸ºç©º")
        return

    card_data = new_card_data
    _update_visual_display()
    _update_reinforcement_effects()
    _setup_interaction_handlers()

func _update_visual_display():
    # 1. æ›´æ–°å¡ç‰Œå›¾ç‰‡
    if card_data.image_path.is_empty():
        push_warning("å¡ç‰Œå›¾ç‰‡è·¯å¾„ä¸ºç©º: " + card_data.id)
        _use_default_image()
    else:
        _load_card_image()

    # 2. æ›´æ–°æ–‡æœ¬æ ‡ç­¾
    if card_name_label:
        card_name_label.text = card_data.name

    if card_power_label:
        var display_value = card_data.get_modified_value()
        card_power_label.text = str(display_value)

        # å¦‚æœæ•°å€¼è¢«ä¿®æ­£ï¼Œæ”¹å˜é¢œè‰²æç¤º
        if display_value != card_data.base_value:
            card_power_label.modulate = Color.YELLOW
        else:
            card_power_label.modulate = Color.WHITE

    # 3. æ›´æ–°èŠ±è‰²æ˜¾ç¤º
    if card_element_label:
        card_element_label.text = _get_suit_symbol(card_data.suit)
        card_element_label.modulate = _get_suit_color(card_data.suit)

func _load_card_image():
    # åŒæ­¥åŠ è½½ï¼ˆé€‚ç”¨äºé¢„åŠ è½½çš„èµ„æºï¼‰
    if ResourceLoader.has_cached(card_data.image_path):
        var texture = ResourceLoader.load(card_data.image_path)
        front_texture.texture = texture
    else:
        # å¼‚æ­¥åŠ è½½ï¼ˆé€‚ç”¨äºå¤§é‡å¡ç‰Œï¼‰
        _load_image_async()

func _load_image_async():
    # æ˜¾ç¤ºåŠ è½½å ä½ç¬¦
    front_texture.texture = preload("res://assets/images/card_loading.png")

    # å¼‚æ­¥åŠ è½½å®é™…å›¾ç‰‡
    ResourceLoader.load_threaded_request(card_data.image_path)

    # ç­‰å¾…åŠ è½½å®Œæˆ
    while ResourceLoader.load_threaded_get_status(card_data.image_path) != ResourceLoader.THREAD_LOAD_LOADED:
        await get_tree().process_frame

    var texture = ResourceLoader.load_threaded_get(card_data.image_path)
    if texture and is_instance_valid(self):
        front_texture.texture = texture
```

### å¼ºåŒ–æ•ˆæœè§†è§‰ç³»ç»Ÿ

```gdscript
func _update_reinforcement_effects():
    _update_wax_seals()
    _update_frame_effect()
    _update_material_effect()

func _update_wax_seals():
    # æ¸…é™¤ç°æœ‰èœ¡å°æ˜¾ç¤º
    for child in wax_seals_container.get_children():
        child.queue_free()

    # ä¸ºæ¯ä¸ªèœ¡å°åˆ›å»ºè§†è§‰æ•ˆæœ
    for i in range(card_data.wax_seals.size()):
        var seal_type = card_data.wax_seals[i]
        var seal_node = _create_wax_seal_visual(seal_type, i)
        wax_seals_container.add_child(seal_node)

func _create_wax_seal_visual(seal_type: String, index: int) -> Node2D:
    var seal_node = Node2D.new()
    var seal_sprite = Sprite2D.new()

    # åŠ è½½èœ¡å°å›¾ç‰‡
    var seal_texture_path = ResourcePaths.get_wax_seal_path(seal_type)
    if ResourceLoader.exists(seal_texture_path):
        seal_sprite.texture = load(seal_texture_path)
    else:
        # ä½¿ç”¨é¢œè‰²ä»£æ›¿å›¾ç‰‡ï¼ˆå¼€å‘é˜¶æ®µï¼‰
        var color_rect = ColorRect.new()
        color_rect.size = Vector2(20, 20)
        color_rect.color = _get_wax_seal_color(seal_type)
        seal_node.add_child(color_rect)
        return seal_node

    # è®¾ç½®èœ¡å°ä½ç½®ï¼ˆå¤šä¸ªèœ¡å°æ—¶çš„æ’åˆ—ï¼‰
    var position_offset = Vector2(index * 25, 0)
    seal_node.position = Vector2(10, 10) + position_offset

    seal_node.add_child(seal_sprite)
    return seal_node

func _update_frame_effect():
    if card_data.frame_type.is_empty():
        frame_node.visible = false
        return

    frame_node.visible = true

    # æ ¹æ®ç‰Œæ¡†ç±»å‹åº”ç”¨ä¸åŒæ•ˆæœ
    match card_data.frame_type:
        "STONE":
            _apply_stone_frame_effect()
        "SILVER":
            _apply_silver_frame_effect()
        "GOLD":
            _apply_gold_frame_effect()

func _apply_gold_frame_effect():
    # é‡‘è‰²ç‰Œæ¡†ï¼šæ·»åŠ å‘å…‰æ•ˆæœ
    var glow_effect = preload("res://effects/GoldGlow.tscn").instantiate()
    frame_node.add_child(glow_effect)

    # æ”¹å˜è¾¹æ¡†é¢œè‰²
    if has_node("Border"):
        get_node("Border").modulate = Color.GOLD
```

### ä¿¡å·ç³»ç»Ÿè¯¦è§£

```gdscript
# CardViewä¸­çš„ä¿¡å·å¤„ç†
func _setup_interaction_handlers():
    # é¼ æ ‡ç‚¹å‡»å¤„ç†
    if not gui_input.is_connected(_on_gui_input):
        gui_input.connect(_on_gui_input)

    # é¼ æ ‡æ‚¬åœå¤„ç†
    if not mouse_entered.is_connected(_on_mouse_entered):
        mouse_entered.connect(_on_mouse_entered)
        mouse_exited.connect(_on_mouse_exited)

func _on_gui_input(event: InputEvent):
    if event is InputEventMouseButton:
        if event.button_index == MOUSE_BUTTON_LEFT and event.pressed:
            _handle_left_click()
        elif event.button_index == MOUSE_BUTTON_RIGHT and event.pressed:
            _handle_right_click()

    elif event is InputEventMouseMotion and _is_dragging:
        _handle_drag(event)

func _handle_left_click():
    # åˆ‡æ¢é€‰ä¸­çŠ¶æ€
    is_selected = not is_selected
    _update_selection_visual()

    # å‘å‡ºä¿¡å·
    emit_signal("card_clicked", self)
    emit_signal("selection_changed", self, is_selected)

func _handle_right_click():
    # æ˜¾ç¤ºå¡ç‰Œè¯¦æƒ…èœå•
    _show_context_menu()

func _handle_drag(event: InputEventMouseMotion):
    if _is_dragging:
        global_position += event.relative
        emit_signal("card_dragged", self)

func _update_selection_visual():
    if highlight_panel:
        highlight_panel.visible = is_selected
        if is_selected:
            highlight_panel.modulate = Color.CYAN
            # æ·»åŠ é€‰ä¸­åŠ¨ç”»
            var tween = create_tween()
            tween.tween_property(self, "scale", Vector2(1.1, 1.1), 0.2)
        else:
            var tween = create_tween()
            tween.tween_property(self, "scale", Vector2(1.0, 1.0), 0.2)
```

---

## ğŸ® å®æˆ˜åº”ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ„å»ºèµ·å§‹æ‰‹ç‰Œ

```gdscript
# æ¸¸æˆå¼€å§‹æ—¶æ„å»ºç©å®¶èµ·å§‹æ‰‹ç‰Œ
func setup_starting_hand():
    # 1. åˆå§‹åŒ–ç‰Œåº“
    var starting_deck = create_starting_deck_for_player()
    card_manager.initialize_deck(starting_deck)

    # 2. æŠ½å–èµ·å§‹æ‰‹ç‰Œ
    var starting_hand_size = GameManager.get_current_hand_size()  # è€ƒè™‘å­¦å¹´ä¿®æ­£
    var drawn_cards = card_manager.draw(starting_hand_size)

    # 3. åœ¨UIä¸­æ˜¾ç¤ºæ‰‹ç‰Œ
    for card_data in drawn_cards:
        var card_view = create_card_view(card_data)
        hand_dock.add_card_view(card_view)

    print("èµ·å§‹æ‰‹ç‰Œæ„å»ºå®Œæˆ: %d å¼ å¡ç‰Œ" % drawn_cards.size())

func create_starting_deck_for_player() -> Array[CardData]:
    # æ ¹æ®ç©å®¶è¿›åº¦å’Œè®¾ç½®åˆ›å»ºä¸ªæ€§åŒ–ç‰Œåº“
    var deck = []

    # åŸºç¡€å¡ç‰Œï¼ˆæ‰€æœ‰ç©å®¶éƒ½æœ‰ï¼‰
    deck.append_array(load_basic_cards())

    # è§£é”çš„å¡ç‰Œï¼ˆæ ¹æ®ç©å®¶è¿›åº¦ï¼‰
    var unlocked_cards = GameManager.get_unlocked_cards()
    deck.append_array(unlocked_cards)

    # å¼ºåŒ–å¡ç‰Œï¼ˆæ ¹æ®ç©å®¶æ”¶é›†çš„å¼ºåŒ–ææ–™ï¼‰
    var enhanced_cards = create_enhanced_variants()
    deck.append_array(enhanced_cards)

    return deck
```

### åœºæ™¯2ï¼šå•†åº—è´­ä¹°æ–°å¡ç‰Œ

```gdscript
# åœ¨æ™ºæ…§æ®¿å ‚è´­ä¹°æ–°å¡ç‰Œ
func purchase_card_from_shop(card_id: String, cost: int) -> bool:
    # 1. æ£€æŸ¥ç©å®¶èµ„æº
    if GameManager.lore_points < cost:
        show_error("ä¼ è¯´ç‚¹æ•°ä¸è¶³")
        return false

    # 2. åŠ è½½å¡ç‰Œæ•°æ®
    var card_data = load_card_from_preset(card_id)
    if not card_data:
        show_error("å¡ç‰Œæ•°æ®åŠ è½½å¤±è´¥")
        return false

    # 3. æ‰£é™¤è´¹ç”¨
    GameManager.add_lore(-cost)

    # 4. å°†å¡ç‰Œæ·»åŠ åˆ°ç©å®¶ç‰Œåº“
    card_manager.add_card_to_deck(card_data)

    # 5. æ˜¾ç¤ºè´­ä¹°æˆåŠŸæ•ˆæœ
    show_purchase_success_effect(card_data)

    print("æˆåŠŸè´­ä¹°å¡ç‰Œ: %s" % card_data.name)
    return true

func show_purchase_success_effect(card_data: CardData):
    # åˆ›å»ºä¸´æ—¶å¡ç‰Œè§†å›¾ç”¨äºåŠ¨ç”»
    var temp_card_view = create_card_view(card_data)
    get_tree().current_scene.add_child(temp_card_view)

    # æ’­æ”¾é£å‘ç‰Œåº“çš„åŠ¨ç”»
    var tween = create_tween()
    var start_pos = shop_card_position
    var end_pos = deck_widget_position

    temp_card_view.global_position = start_pos
    tween.tween_property(temp_card_view, "global_position", end_pos, 1.0)
    tween.tween_property(temp_card_view, "scale", Vector2(0.1, 0.1), 1.0)

    # åŠ¨ç”»ç»“æŸåæ¸…ç†
    tween.tween_callback(func(): temp_card_view.queue_free())
```

### åœºæ™¯3ï¼šå¡ç‰Œå¼ºåŒ–å·¥ä½œå°

```gdscript
# å¡ç‰Œå¼ºåŒ–å·¥ä½œå°åŠŸèƒ½
class CardEnhancementWorkbench:
    var selected_card: CardData = null
    var available_materials: Dictionary = {}

    func setup_workbench():
        # 1. æ˜¾ç¤ºç©å®¶æ‰‹ç‰Œä¾›é€‰æ‹©
        display_player_hand_for_selection()

        # 2. æ˜¾ç¤ºå¯ç”¨å¼ºåŒ–ææ–™
        display_available_materials()

        # 3. è®¾ç½®å¼ºåŒ–é¢„è§ˆ
        setup_enhancement_preview()

    func select_card_for_enhancement(card_data: CardData):
        selected_card = card_data
        update_enhancement_preview()

        # é«˜äº®æ˜¾ç¤ºé€‰ä¸­çš„å¡ç‰Œ
        highlight_selected_card(card_data)

    func apply_enhancement(enhancement_type: String, enhancement_value: String):
        if not selected_card:
            show_error("è¯·å…ˆé€‰æ‹©è¦å¼ºåŒ–çš„å¡ç‰Œ")
            return false

        # 1. æ£€æŸ¥ææ–™æ˜¯å¦è¶³å¤Ÿ
        if not check_material_availability(enhancement_type, enhancement_value):
            show_error("å¼ºåŒ–ææ–™ä¸è¶³")
            return false

        # 2. æ¶ˆè€—ææ–™
        consume_materials(enhancement_type, enhancement_value)

        # 3. åº”ç”¨å¼ºåŒ–æ•ˆæœ
        match enhancement_type:
            "WAX_SEAL":
                selected_card.wax_seals.append(enhancement_value)
            "FRAME":
                selected_card.frame_type = enhancement_value
            "MATERIAL":
                selected_card.material_type = enhancement_value

        # 4. æ›´æ–°è§†å›¾æ˜¾ç¤º
        update_card_visual_effects(selected_card)

        # 5. æ’­æ”¾å¼ºåŒ–æˆåŠŸåŠ¨ç”»
        play_enhancement_success_animation()

        print("å¡ç‰Œå¼ºåŒ–æˆåŠŸ: %s è·å¾— %s" % [selected_card.name, enhancement_value])
        return true

    func update_enhancement_preview():
        if not selected_card:
            return

        # åˆ›å»ºé¢„è§ˆå¡ç‰Œï¼ˆä¸ä¿®æ”¹åŸå¡ç‰Œï¼‰
        var preview_card = selected_card.clone()

        # åº”ç”¨é¢„è§ˆå¼ºåŒ–æ•ˆæœ
        var preview_enhancement = get_selected_enhancement()
        if preview_enhancement:
            apply_preview_enhancement(preview_card, preview_enhancement)

        # æ˜¾ç¤ºé¢„è§ˆ
        display_preview_card(preview_card)

        # æ˜¾ç¤ºæ•°å€¼å˜åŒ–
        show_stat_comparison(selected_card, preview_card)
```

### åœºæ™¯4ï¼šç‰Œå‹è¯†åˆ«ä¸å¾—åˆ†è®¡ç®—

```gdscript
# ä¸ScoreCalculatoré…åˆçš„ç‰Œå‹è¯†åˆ«
func analyze_played_cards(played_cards: Array[CardData]) -> Dictionary:
    var analysis = {
        "card_type": "",
        "base_score": 0,
        "multiplier": 1.0,
        "bonus_effects": [],
        "final_score": 0
    }

    # 1. åŸºç¡€ç‰Œå‹è¯†åˆ«
    analysis.card_type = identify_poker_hand_type(played_cards)
    analysis.base_score = GameManager.game_config.card_type_base_scores[analysis.card_type]

    # 2. è®¡ç®—ç­‰çº§å€ç‡
    var card_type_level = GameManager.get_card_type_level(analysis.card_type)
    analysis.multiplier = GameManager.game_config.card_type_level_multipliers[analysis.card_type][card_type_level - 1]

    # 3. åˆ†æå¼ºåŒ–æ•ˆæœ
    for card in played_cards:
        # èœ¡å°æ•ˆæœ
        for seal in card.wax_seals:
            match seal:
                "RED":
                    analysis.bonus_effects.append({"type": "FIXED_BONUS", "value": 10})
                "PURPLE":
                    analysis.bonus_effects.append({"type": "FIXED_BONUS", "value": 20})
                "GOLD":
                    analysis.bonus_effects.append({"type": "COPY_CARD", "card": card})

        # ç‰Œæ¡†æ•ˆæœ
        if card.frame_type == "GOLD":
            analysis.bonus_effects.append({"type": "MULTIPLIER", "value": 1.5})

    # 4. è®¡ç®—æœ€ç»ˆå¾—åˆ†
    var score = analysis.base_score * analysis.multiplier

    # åº”ç”¨å›ºå®šåŠ æˆ
    for effect in analysis.bonus_effects:
        if effect.type == "FIXED_BONUS":
            score += effect.value

    # åº”ç”¨å€ç‡åŠ æˆ
    for effect in analysis.bonus_effects:
        if effect.type == "MULTIPLIER":
            score *= effect.value

    analysis.final_score = int(score)
    return analysis

func identify_poker_hand_type(cards: Array[CardData]) -> String:
    if cards.size() != 5:
        return "INVALID"

    # æŒ‰æ•°å€¼æ’åº
    var sorted_cards = cards.duplicate()
    sorted_cards.sort_custom(func(a, b): return a.get_modified_value() < b.get_modified_value())

    # ç»Ÿè®¡æ•°å€¼å’ŒèŠ±è‰²
    var value_counts = {}
    var suit_counts = {}

    for card in sorted_cards:
        var value = card.get_modified_value()
        var suit = card.suit

        value_counts[value] = value_counts.get(value, 0) + 1
        suit_counts[suit] = suit_counts.get(suit, 0) + 1

    # åˆ¤æ–­ç‰Œå‹
    var counts = value_counts.values()
    counts.sort()

    var is_flush = suit_counts.size() == 1
    var is_straight = _check_straight(sorted_cards)

    if is_straight and is_flush:
        if sorted_cards[0].get_modified_value() == 1 and sorted_cards[4].get_modified_value() == 13:
            return "ROYAL_FLUSH"
        else:
            return "STRAIGHT_FLUSH"
    elif counts == [1, 4]:
        return "FOUR_OF_KIND"
    elif counts == [2, 3]:
        return "FULL_HOUSE"
    elif is_flush:
        return "FLUSH"
    elif is_straight:
        return "STRAIGHT"
    elif counts == [1, 1, 3]:
        return "THREE_OF_KIND"
    elif counts == [1, 2, 2]:
        return "TWO_PAIR"
    elif counts == [1, 1, 1, 2]:
        return "PAIR"
    else:
        return "HIGH_CARD"
```

---

## ğŸ› ï¸ è°ƒè¯•ä¸å¼€å‘å·¥å…·

### å¡ç‰Œæ•°æ®æ£€æŸ¥å™¨

```gdscript
# å¼€å‘é˜¶æ®µçš„è°ƒè¯•å·¥å…·
class CardDataInspector:
    static func inspect_card(card_data: CardData):
        print("=== å¡ç‰Œæ•°æ®æ£€æŸ¥ ===")
        print("ID: %s" % card_data.id)
        print("åç§°: %s" % card_data.name)
        print("åŸºç¡€æ•°å€¼: %d" % card_data.base_value)
        print("ä¿®æ­£æ•°å€¼: %d" % card_data.get_modified_value())
        print("èŠ±è‰²: %s" % card_data.suit)
        print("å›¾ç‰‡è·¯å¾„: %s" % card_data.image_path)
        print("å›¾ç‰‡å­˜åœ¨: %s" % ResourceLoader.exists(card_data.image_path))

        if card_data.wax_seals.size() > 0:
            print("èœ¡å°: %s" % str(card_data.wax_seals))
        if card_data.frame_type != "":
            print("ç‰Œæ¡†: %s" % card_data.frame_type)
        if card_data.material_type != "":
            print("æè´¨: %s" % card_data.material_type)

        print("==================")

    static func validate_all_preset_cards():
        var cards_dir = "res://assets/data/cards/"
        var dir = DirAccess.open(cards_dir)
        var validation_results = []

        if not dir:
            push_error("æ— æ³•æ‰“å¼€å¡ç‰Œç›®å½•")
            return

        dir.list_dir_begin()
        var file_name = dir.get_next()

        while file_name != "":
            if file_name.ends_with(".tres"):
                var card_path = cards_dir + file_name
                var result = validate_single_card_file(card_path)
                validation_results.append(result)

            file_name = dir.get_next()

        # è¾“å‡ºéªŒè¯æŠ¥å‘Š
        print_validation_report(validation_results)

    static func validate_single_card_file(file_path: String) -> Dictionary:
        var result = {
            "file_path": file_path,
            "file_name": file_path.get_file(),
            "valid": true,
            "errors": [],
            "warnings": []
        }

        # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        if not ResourceLoader.exists(file_path):
            result.valid = false
            result.errors.append("æ–‡ä»¶ä¸å­˜åœ¨")
            return result

        # å°è¯•åŠ è½½èµ„æº
        var card_data = load(file_path) as CardData
        if not card_data:
            result.valid = false
            result.errors.append("æ— æ³•åŠ è½½ä¸ºCardData")
            return result

        # éªŒè¯æ•°æ®å®Œæ•´æ€§
        if card_data.id.is_empty():
            result.errors.append("IDä¸ºç©º")

        if card_data.name.is_empty():
            result.errors.append("åç§°ä¸ºç©º")

        if card_data.base_value < 1 or card_data.base_value > 13:
            result.errors.append("æ•°å€¼è¶…å‡ºèŒƒå›´: " + str(card_data.base_value))

        if not card_data.suit in ["hearts", "diamonds", "clubs", "spades"]:
            result.errors.append("æ— æ•ˆèŠ±è‰²: " + card_data.suit)

        if card_data.image_path.is_empty():
            result.warnings.append("å›¾ç‰‡è·¯å¾„ä¸ºç©º")
        elif not ResourceLoader.exists(card_data.image_path):
            result.warnings.append("å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨: " + card_data.image_path)

        if result.errors.size() > 0:
            result.valid = false

        return result
```

### æ€§èƒ½ç›‘æ§å·¥å…·

```gdscript
# æ€§èƒ½ç›‘æ§å’Œåˆ†æå·¥å…·
class CardSystemProfiler:
    var creation_times: Array[float] = []
    var memory_usage: Array[int] = []
    var frame_times: Array[float] = []

    func start_profiling():
        creation_times.clear()
        memory_usage.clear()
        frame_times.clear()
        print("å¼€å§‹æ€§èƒ½ç›‘æ§")

    func record_card_creation_time(start_time: float, end_time: float):
        creation_times.append(end_time - start_time)

    func record_memory_usage():
        var current_memory = OS.get_static_memory_usage_by_type()
        memory_usage.append(current_memory.get("Object", 0))

    func record_frame_time():
        frame_times.append(get_process_delta_time())

    func generate_performance_report():
        print("=== æ€§èƒ½åˆ†ææŠ¥å‘Š ===")

        if creation_times.size() > 0:
            var avg_creation_time = creation_times.reduce(func(a, b): return a + b) / creation_times.size()
            var max_creation_time = creation_times.max()
            print("å¡ç‰Œåˆ›å»ºæ—¶é—´ - å¹³å‡: %.3fms, æœ€å¤§: %.3fms" % [avg_creation_time * 1000, max_creation_time * 1000])

        if memory_usage.size() > 0:
            var avg_memory = memory_usage.reduce(func(a, b): return a + b) / memory_usage.size()
            var max_memory = memory_usage.max()
            print("å†…å­˜ä½¿ç”¨ - å¹³å‡: %d bytes, å³°å€¼: %d bytes" % [avg_memory, max_memory])

        if frame_times.size() > 0:
            var avg_frame_time = frame_times.reduce(func(a, b): return a + b) / frame_times.size()
            var fps = 1.0 / avg_frame_time
            print("å¸§ç‡ - å¹³å‡: %.1f FPS" % fps)

        print("==================")
```

---

## ğŸ“ˆ æ‰©å±•åŠŸèƒ½ç¤ºä¾‹

### å¡ç‰ŒåŠ¨ç”»ç³»ç»Ÿ

```gdscript
# ä¸°å¯Œçš„å¡ç‰ŒåŠ¨ç”»æ•ˆæœ
class CardAnimationManager:

    # å‘ç‰ŒåŠ¨ç”»
    static func animate_deal_card(card_view: Control, target_position: Vector2, delay: float = 0.0):
        # è®¾ç½®åˆå§‹çŠ¶æ€
        card_view.position = Vector2(-200, -100)  # ç‰Œå †ä½ç½®
        card_view.rotation_degrees = 0
        card_view.scale = Vector2(0.5, 0.5)
        card_view.modulate.a = 0.8

        var tween = card_view.create_tween()

        # å»¶è¿Ÿå¼€å§‹
        if delay > 0:
            tween.tween_delay(delay)

        # å¹¶è¡ŒåŠ¨ç”»
        tween.parallel().tween_property(card_view, "position", target_position, 0.6)
        tween.parallel().tween_property(card_view, "scale", Vector2(0.8, 0.8), 0.6)
        tween.parallel().tween_property(card_view, "rotation_degrees", randf_range(-5, 5), 0.6)
        tween.parallel().tween_property(card_view, "modulate:a", 1.0, 0.6)

        # è®¾ç½®ç¼“åŠ¨æ•ˆæœ
        tween.set_ease(Tween.EASE_OUT)
        tween.set_trans(Tween.TRANS_BACK)

        # åˆ°è¾¾åçš„å°å¹…å¼¹è·³
        tween.tween_property(card_view, "scale", Vector2(0.85, 0.85), 0.1)
        tween.tween_property(card_view, "scale", Vector2(0.8, 0.8), 0.1)

    # å¡ç‰Œç¿»è½¬åŠ¨ç”»
    static func animate_card_flip(card_view: Control, show_front: bool = true):
        var tween = card_view.create_tween()

        # ç¬¬ä¸€é˜¶æ®µï¼šç¼©æ”¾åˆ°0ï¼ˆéšè—ï¼‰
        tween.tween_property(card_view, "scale:x", 0.0, 0.15)

        # ä¸­é—´ï¼šåˆ‡æ¢æ­£åé¢
        tween.tween_callback(func():
            if card_view.has_method("set_face_up"):
                card_view.set_face_up(show_front)
        )

        # ç¬¬äºŒé˜¶æ®µï¼šæ¢å¤ç¼©æ”¾ï¼ˆæ˜¾ç¤ºï¼‰
        tween.tween_property(card_view, "scale:x", 0.8, 0.15)

    # å¡ç‰Œå¼ºåŒ–é—ªå…‰æ•ˆæœ
    static func animate_enhancement_effect(card_view: Control, enhancement_type: String):
        var flash_effect = preload("res://effects/EnhancementFlash.tscn").instantiate()
        card_view.add_child(flash_effect)

        # æ ¹æ®å¼ºåŒ–ç±»å‹é€‰æ‹©ä¸åŒé¢œè‰²
        var flash_color = Color.WHITE
        match enhancement_type:
            "WAX_SEAL":
                flash_color = Color.GOLD
            "FRAME":
                flash_color = Color.SILVER
            "MATERIAL":
                flash_color = Color.CYAN

        flash_effect.modulate = flash_color

        # é—ªå…‰åŠ¨ç”»
        var tween = card_view.create_tween()
        tween.tween_property(flash_effect, "modulate:a", 0.0, 1.0)
        tween.tween_callback(func(): flash_effect.queue_free())

    # å¡ç‰Œé”€æ¯åŠ¨ç”»
    static func animate_card_destroy(card_view: Control, callback: Callable = Callable()):
        var tween = card_view.create_tween()

        # æ—‹è½¬å¹¶ç¼©å°
        tween.parallel().tween_property(card_view, "rotation_degrees", 720, 0.8)
        tween.parallel().tween_property(card_view, "scale", Vector2.ZERO, 0.8)
        tween.parallel().tween_property(card_view, "modulate:a", 0.0, 0.8)

        # è®¾ç½®ç¼“åŠ¨
        tween.set_ease(Tween.EASE_IN)
        tween.set_trans(Tween.TRANS_BACK)

        # å®Œæˆåå›è°ƒ
        if callback.is_valid():
            tween.tween_callback(callback)
        else:
            tween.tween_callback(func(): card_view.queue_free())
```

### å¡ç‰Œæœç´¢ä¸è¿‡æ»¤ç³»ç»Ÿ

```gdscript
# é«˜çº§å¡ç‰Œæœç´¢å’Œè¿‡æ»¤åŠŸèƒ½
class CardSearchSystem:

    # æœç´¢æ¡ä»¶ç»“æ„
    class SearchCriteria:
        var name_filter: String = ""
        var suit_filter: Array[String] = []
        var value_range: Vector2i = Vector2i(1, 13)
        var has_wax_seals: Array[String] = []
        var frame_type: String = ""
        var material_type: String = ""
        var rarity_filter: Array[String] = []
        var sort_by: String = "name"  # name, value, rarity
        var sort_ascending: bool = true

    static func search_cards(all_cards: Array[CardData], criteria: SearchCriteria) -> Array[CardData]:
        var results = all_cards.duplicate()

        # åº”ç”¨å„ç§è¿‡æ»¤æ¡ä»¶
        results = _filter_by_name(results, criteria.name_filter)
        results = _filter_by_suit(results, criteria.suit_filter)
        results = _filter_by_value_range(results, criteria.value_range)
        results = _filter_by_wax_seals(results, criteria.has_wax_seals)
        results = _filter_by_frame_type(results, criteria.frame_type)
        results = _filter_by_material_type(results, criteria.material_type)
        results = _filter_by_rarity(results, criteria.rarity_filter)

        # æ’åº
        results = _sort_cards(results, criteria.sort_by, criteria.sort_ascending)

        return results

    static func _filter_by_name(cards: Array[CardData], name_filter: String) -> Array[CardData]:
        if name_filter.is_empty():
            return cards

        return cards.filter(func(card):
            return card.name.to_lower().contains(name_filter.to_lower())
        )

    static func _filter_by_suit(cards: Array[CardData], suit_filter: Array[String]) -> Array[CardData]:
        if suit_filter.is_empty():
            return cards

        return cards.filter(func(card):
            return card.suit in suit_filter
        )

    static func _filter_by_value_range(cards: Array[CardData], value_range: Vector2i) -> Array[CardData]:
        return cards.filter(func(card):
            var value = card.get_modified_value()
            return value >= value_range.x and value <= value_range.y
        )

    static func _filter_by_wax_seals(cards: Array[CardData], required_seals: Array[String]) -> Array[CardData]:
        if required_seals.is_empty():
            return cards

        return cards.filter(func(card):
            for seal in required_seals:
                if not seal in card.wax_seals:
                    return false
            return true
        )

    static func _sort_cards(cards: Array[CardData], sort_by: String, ascending: bool) -> Array[CardData]:
        var sorted_cards = cards.duplicate()

        match sort_by:
            "name":
                sorted_cards.sort_custom(func(a, b):
                    return a.name < b.name if ascending else a.name > b.name
                )
            "value":
                sorted_cards.sort_custom(func(a, b):
                    var val_a = a.get_modified_value()
                    var val_b = b.get_modified_value()
                    return val_a < val_b if ascending else val_a > val_b
                )
            "rarity":
                var rarity_order = {"common": 0, "rare": 1, "epic": 2, "legendary": 3}
                sorted_cards.sort_custom(func(a, b):
                    var rarity_a = rarity_order.get(a.rarity, 0)
                    var rarity_b = rarity_order.get(b.rarity, 0)
                    return rarity_a < rarity_b if ascending else rarity_a > rarity_b
                )

        return sorted_cards

    # å¿«é€Ÿæœç´¢é¢„è®¾
    static func search_enhanced_cards(all_cards: Array[CardData]) -> Array[CardData]:
        return all_cards.filter(func(card):
            return card.wax_seals.size() > 0 or card.frame_type != "" or card.material_type != ""
        )

    static func search_high_value_cards(all_cards: Array[CardData], min_value: int = 10) -> Array[CardData]:
        return all_cards.filter(func(card):
            return card.get_modified_value() >= min_value
        )

    static func search_cards_by_suit(all_cards: Array[CardData], suit: String) -> Array[CardData]:
        return all_cards.filter(func(card):
            return card.suit == suit
        )
```

è¿™ä»½è¯¦ç»†çš„æŠ€æœ¯æ–‡æ¡£ç°åœ¨åŒ…å«äº†å¥¥æœ¯å­¦é™¢æ‰‘å…‹å¡ç‰Œç³»ç»Ÿçš„æ‰€æœ‰æ ¸å¿ƒæŠ€æœ¯ç»†èŠ‚ï¼Œä»åŸºç¡€æ¶æ„åˆ°é«˜çº§åŠŸèƒ½ï¼Œä»å®æˆ˜åº”ç”¨åˆ°è°ƒè¯•å·¥å…·ï¼Œä¸ºå¼€å‘è€…æä¾›äº†å®Œæ•´çš„å‚è€ƒæŒ‡å—ã€‚
