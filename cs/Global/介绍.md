# `cs/Global/` 模块说明

`cs/Global/` 存放 **全局单例与核心配置**，确保全项目统一访问，并符合《奥术学院扑克——分阶段实现指南 (v1.6)》中“单例职责”理念。

---

## 1. 主要脚本与职责
| 文件 | 类 | 关键职责 |
|------|----|-----------|
| `GlobalEnums.gd` | `GlobalEnums` | 定义所有枚举：`Rarity`, `TermType`, `CardType`, `WaxSealType`, `FrameType`, `MaterialType`, `SpellType`, `BuffType`…；**Autoload** 名称 `GlobalEnums` |
| `GameConfig.gd` | `GameConfig` *(Resource)* | 全局数值配置：胜利分数、牌型基础分、倍率、商店概率等。实例文件 `assets/data/game_config.tres` |
| `GameManager.gd` | `GameManager` | 全局流程与玩家状态：学年/学期、分数、学识点、牌型等级、能力列表；**信号**驱动 UI 场景 |
| `EventManager.gd` | `EventManager` | 随机事件与 Buff/Debuff 管理：添加、清理、触发事件，监听 `GameManager` 信号 |
| `ScoreCalculator.gd` | `ScoreCalculator` | 纯函数式得分计算：输入牌组 & GameManager 状态，输出整数分数，不修改状态 |
| 其它单例 | （可选）`AudioManager`, `SaveManager` | 管理音效播放、存档等跨场景功能 |

> 所有脚本通过 **Project Settings → Autoload** 注册为单例，脚本名即访问名。

---

## 2. 信号与依赖关系
```
GlobalEnums  (常量)          
       ↑  preload            
GameConfig (Resource)        
       ↑  preload            
GameManager  <—— ScoreCalculator (查询状态, 纯函数)
    ↑  ↑  ↑
    |  |  |
 EventManager  UI(MainGame, Sidebar, HandDock)
```
- `GameManager` 发出：`new_year_started`, `term_started`, `game_state_changed`, `lore_changed`, `card_type_levels_changed` …
- `EventManager` 发出：`buff_applied`, `random_event_triggered`；订阅 `GameManager` 的 `start_new_year`, `term_started`, `term_ended`。
- `ScoreCalculator` 仅**读取** `GameConfig` 与 `GameManager` 状态，保持无副作用。

---

## 3. 设计原则摘要（来自 v1.6 指南）
1. **单例不混用职责**：每个脚本只负责一类全局数据或流程，避免臃肿。  
2. **信号通信**：模块间不直接访问彼此字段，通过信号或公开 getter 方法。  
3. **数据驱动**：所有数值来源 `GameConfig.tres`；调整平衡无需改代码。  
4. **可测试性**：`ScoreCalculator` 纯函数，可在 GUT 中单元测试。  
5. **热更新友好**：枚举与配置集中，便于新内容快速接入。

---

## 4. 后续任务关联
- **阶段二**：精简 `GameManager`，实现学年/学期流程；实现 `EventManager` Buff 系统。  
- **阶段三**：扩展 `ScoreCalculator` 牌型等级倍率；`GameManager.trigger_effect_logic` 调度能力效果。  
- **阶段四**：UI 侧边栏等场景监听 `GameManager` & `EventManager` 信号实时刷新。  
- **阶段五**：流程整合测试，确认信号触达全 UI。  

本文件将随阶段推进持续更新，保持对 **全局模块** 行为与接口的最新描述。
