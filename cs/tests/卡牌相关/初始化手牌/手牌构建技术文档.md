# æ‰‹ç‰Œæ„å»ºæŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [ç³»ç»Ÿæ¶æ„æ¦‚è¿°](#ç³»ç»Ÿæ¶æ„æ¦‚è¿°)
2. [æ ¸å¿ƒç»„ä»¶è¯¦è§£](#æ ¸å¿ƒç»„ä»¶è¯¦è§£)
3. [æ„å»ºæµç¨‹è¯¦è§£](#æ„å»ºæµç¨‹è¯¦è§£)
4. [ä»£ç å®ç°ç¤ºä¾‹](#ä»£ç å®ç°ç¤ºä¾‹)
5. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
6. [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#æ€§èƒ½ä¼˜åŒ–å»ºè®®)

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è¿°

### æ¶æ„æ¨¡å¼ï¼šMVC (Model-View-Controller)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CardData      â”‚    â”‚   CardView      â”‚    â”‚ HandManager     â”‚
â”‚   (Model)       â”‚â—„â”€â”€â–ºâ”‚   (View)        â”‚â—„â”€â”€â–ºâ”‚ (Controller)    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ æ•°æ®å­˜å‚¨      â”‚    â”‚ â€¢ è§†è§‰æ˜¾ç¤º      â”‚    â”‚ â€¢ é€»è¾‘æ§åˆ¶      â”‚
â”‚ â€¢ å±æ€§ç®¡ç†      â”‚    â”‚ â€¢ ç”¨æˆ·äº¤äº’      â”‚    â”‚ â€¢ äº‹ä»¶å¤„ç†      â”‚
â”‚ â€¢ çŠ¶æ€ç»´æŠ¤      â”‚    â”‚ â€¢ åŠ¨ç”»æ•ˆæœ      â”‚    â”‚ â€¢ çŠ¶æ€ç®¡ç†      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾èµ–å…³ç³»å›¾

```
ResourcePaths.gd (é™æ€å·¥å…·ç±»)
	â†“
CardData.gd (æ•°æ®æ¨¡å‹)
	â†“
CardView.gd (è§†å›¾æ§åˆ¶å™¨)
	â†“
Card.tscn (åœºæ™¯æ–‡ä»¶)
	â†“
HandManager (æ‰‹ç‰Œç®¡ç†å™¨)
```

---

## ğŸ§© æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. CardData.gd - å¡ç‰‡æ•°æ®æ¨¡å‹

**èŒè´£**: å­˜å‚¨å’Œç®¡ç†å•å¼ å¡ç‰‡çš„æ‰€æœ‰æ•°æ®

**æ ¸å¿ƒå±æ€§**:
```gdscript
class_name CardData extends Resource

# åŸºç¡€å±æ€§
@export var id: String = ""           # å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¦‚"H3"è¡¨ç¤ºçº¢æ¡ƒ3
@export var base_value: int = 0       # åŸºç¡€ç‚¹æ•° (1-13)
@export var suit: String = ""         # èŠ±è‰² ("hearts", "diamonds", "clubs", "spades")
@export var name: String = ""         # æ˜¾ç¤ºåç§°ï¼Œå¦‚"çº¢æ¡ƒ3"
@export var image_path: String = ""   # å›¾ç‰‡èµ„æºè·¯å¾„

# å¼ºåŒ–å±æ€§
@export var wax_seals: Array[String] = []    # èœ¡å°æ•ˆæœæ•°ç»„
@export var frame_type: String = ""          # ç‰Œæ¡†ç±»å‹
@export var material_type: String = ""       # æè´¨ç±»å‹
```

**å…³é”®æ–¹æ³•**:
```gdscript
# è·å–ä¿®æ­£åçš„æ•°å€¼ï¼ˆè€ƒè™‘å¼ºåŒ–æ•ˆæœï¼‰
func get_modified_value(effect_provider = null) -> int

# è·å–èŠ±è‰²æ˜¾ç¤ºåç§°
func get_suit_display_name() -> String

# è·å–æ•°å€¼æ˜¾ç¤ºåç§°
func get_value_display_name() -> String

# æ£€æŸ¥æ˜¯å¦æœ‰ç‰¹å®šå¼ºåŒ–
func has_wax_seal(seal_type: String) -> bool
func has_frame_reinforcement() -> bool
```

### 2. ResourcePaths.gd - èµ„æºè·¯å¾„ç®¡ç†

**èŒè´£**: ç»Ÿä¸€ç®¡ç†æ‰€æœ‰èµ„æºæ–‡ä»¶çš„è·¯å¾„è®¡ç®—

**å›¾ç‰‡ç´¢å¼•æ˜ å°„è§„åˆ™**:
```gdscript
# 52å¼ æ ‡å‡†æ‰‘å…‹ç‰Œçš„ç´¢å¼•æ˜ å°„
var suit_offset = {
	"S": 0,    # é»‘æ¡ƒ (Spades):   1-13  (1.jpg  - 13.jpg)
	"H": 13,   # çº¢æ¡ƒ (Hearts):   14-26 (14.jpg - 26.jpg)
	"D": 26,   # æ–¹ç‰‡ (Diamonds): 27-39 (27.jpg - 39.jpg)
	"C": 39    # æ¢…èŠ± (Clubs):    40-52 (40.jpg - 52.jpg)
}

# è®¡ç®—å…¬å¼: å›¾ç‰‡ç´¢å¼• = èŠ±è‰²åç§»é‡ + å¡ç‰‡æ•°å€¼
# ä¾‹å¦‚: çº¢æ¡ƒ3 = 13 + 3 = 16.jpg
```

**è·¯å¾„ç”Ÿæˆç¤ºä¾‹**:
```gdscript
# è¾“å…¥: "H3" (çº¢æ¡ƒ3)
# è¾“å‡º: "res://assets/images/pokers/16.jpg"

static func get_card_image_path(card_id: String) -> String:
	var suit = card_id[0]              # "H"
	var value = card_id.substr(1)      # "3"
	var index = suit_offset[suit] + int(value)  # 13 + 3 = 16
	return CARD_IMAGES_PATH + str(index) + ".jpg"
```

### 3. CardView.gd - å¡ç‰‡è§†å›¾æ§åˆ¶å™¨

**èŒè´£**: ç®¡ç†å•å¼ å¡ç‰‡çš„è§†è§‰æ˜¾ç¤ºå’Œç”¨æˆ·äº¤äº’

**æ ¸å¿ƒç»„ä»¶å¼•ç”¨**:
```gdscript
# è§†è§‰ç»„ä»¶
@onready var front_texture: TextureRect = $CardFront
@onready var back_texture: TextureRect = $CardBack
@onready var card_name_label: Label = $CardFront/NameLabel
@onready var card_element_label: Label = $CardFront/ElementLabel
@onready var card_power_label: Label = $CardFront/PowerLabel

# å¼ºåŒ–æ•ˆæœç»„ä»¶
@onready var frame_node: Node2D = $ReinforcementEffects/Frame
@onready var wax_seals_container: Node2D = $ReinforcementEffects/WaxSeals
@onready var material_effect: ColorRect = $ReinforcementEffects/Material
```

**ä¿¡å·ç³»ç»Ÿ**:
```gdscript
# ç”¨æˆ·äº¤äº’ä¿¡å·
signal card_clicked(card_view)
signal card_dragged(card_view)
signal card_dropped(card_view, drop_position)
signal card_hovered(card_view)
signal card_unhovered(card_view)
signal selection_changed(card_view, is_selected)
```

### 4. Card.tscn - å¡ç‰‡åœºæ™¯ç»“æ„

**èŠ‚ç‚¹å±‚æ¬¡ç»“æ„**:
```
Card (Control) - æ ¹èŠ‚ç‚¹
â”œâ”€â”€ CardFront (TextureRect) - æ­£é¢æ˜¾ç¤º
â”‚   â”œâ”€â”€ NameLabel (Label) - å¡ç‰‡åç§°
â”‚   â”œâ”€â”€ ElementLabel (Label) - èŠ±è‰²ç¬¦å·
â”‚   â””â”€â”€ PowerLabel (Label) - ç‚¹æ•°æ˜¾ç¤º
â”œâ”€â”€ CardBack (TextureRect) - èƒŒé¢æ˜¾ç¤º
â”œâ”€â”€ Highlight (Panel) - é«˜äº®æ•ˆæœ
â”œâ”€â”€ ReinforcementEffects (Node2D) - å¼ºåŒ–æ•ˆæœå®¹å™¨
â”‚   â”œâ”€â”€ Frame (Node2D) - ç‰Œæ¡†æ•ˆæœ
â”‚   â”œâ”€â”€ WaxSeals (Node2D) - èœ¡å°æ•ˆæœ
â”‚   â””â”€â”€ Material (ColorRect) - æè´¨æ•ˆæœ
â””â”€â”€ AnimationPlayer - åŠ¨ç”»æ’­æ”¾å™¨
```

---

## ğŸ”„ æ„å»ºæµç¨‹è¯¦è§£

### é˜¶æ®µä¸€: æ•°æ®å‡†å¤‡

```gdscript
# 1.1 åˆ›å»ºå¡ç‰‡æ•°æ®å®ä¾‹
var card_data = CardData.new()

# 1.2 è®¾ç½®åŸºç¡€å±æ€§
card_data.id = "H3"                    # è®¾ç½®å”¯ä¸€ID
card_data.base_value = 3               # è®¾ç½®åŸºç¡€ç‚¹æ•°
card_data.suit = "hearts"              # è®¾ç½®èŠ±è‰²
card_data.name = "çº¢æ¡ƒ3"               # è®¾ç½®æ˜¾ç¤ºåç§°

# 1.3 è®¡ç®—å¹¶è®¾ç½®å›¾ç‰‡è·¯å¾„
card_data.image_path = ResourcePaths.get_card_image_path("H3")
# ç»“æœ: "res://assets/images/pokers/16.jpg"

# 1.4 æ•°æ®éªŒè¯
if not validate_card_data(card_data):
	push_error("å¡ç‰‡æ•°æ®éªŒè¯å¤±è´¥")
	return null
```

### é˜¶æ®µäºŒ: è§†å›¾åˆ›å»º

```gdscript
# 2.1 åŠ è½½å¡ç‰‡åœºæ™¯
var CardScene = preload("res://cs/å¡ç‰Œç³»ç»Ÿ/è§†å›¾/Card.tscn")

# 2.2 å®ä¾‹åŒ–åœºæ™¯
var card_view = CardScene.instantiate()
if not card_view:
	push_error("å¡ç‰‡è§†å›¾åˆ›å»ºå¤±è´¥")
	return null

# 2.3 ç»‘å®šæ•°æ®åˆ°è§†å›¾
card_view.setup(card_data)

# 2.4 é…ç½®è§†å›¾å±æ€§
card_view.scale = Vector2(0.8, 0.8)    # è®¾ç½®ç¼©æ”¾
card_view.set_draggable(true)          # å¯ç”¨æ‹–æ‹½
```

### é˜¶æ®µä¸‰: æ•°æ®ç»‘å®š

```gdscript
# 3.1 setupæ–¹æ³•å†…éƒ¨æµç¨‹
func setup(new_card_data: CardData):
	card_data = new_card_data          # ä¿å­˜æ•°æ®å¼•ç”¨
	update_view()                      # æ›´æ–°è§†å›¾æ˜¾ç¤º

# 3.2 update_viewæ–¹æ³•è¯¦è§£
func update_view():
	# 3.2.1 åŠ è½½å¡ç‰‡å›¾ç‰‡
	var texture = load(card_data.image_path)
	front_texture.texture = texture
	
	# 3.2.2 æ›´æ–°æ–‡æœ¬æ ‡ç­¾
	card_name_label.text = card_data.name
	card_element_label.text = card_data.get_suit_display_name()
	card_power_label.text = card_data.get_value_display_name()
	
	# 3.2.3 åº”ç”¨å¼ºåŒ–æ•ˆæœ
	update_reinforcement_effects()
```

### é˜¶æ®µå››: é›†æˆåˆ°æ‰‹ç‰Œ

```gdscript
# 4.1 æ·»åŠ åˆ°åœºæ™¯æ ‘
hand_container.add_child(card_view)

# 4.2 æ·»åŠ åˆ°æ•°æ®ç®¡ç†
hand_cards.append(card_data)
hand_views.append(card_view)

# 4.3 è®¾ç½®ä½ç½®å’Œå¸ƒå±€
arrange_hand_layout()

# 4.4 è¿æ¥ä¿¡å·å¤„ç†
card_view.card_clicked.connect(_on_card_clicked)
card_view.card_dragged.connect(_on_card_dragged)
```

---

## ğŸ’» ä»£ç å®ç°ç¤ºä¾‹

### å®Œæ•´çš„å•å¡æ„å»ºå‡½æ•°

```gdscript
func create_card(card_id: String, value: int, suit: String, name: String) -> Control:
	"""
	åˆ›å»ºå•å¼ å¡ç‰‡çš„å®Œæ•´æµç¨‹
	
	å‚æ•°:
		card_id: å¡ç‰‡IDï¼Œå¦‚"H3"
		value: å¡ç‰‡æ•°å€¼ï¼Œ1-13
		suit: èŠ±è‰²ï¼Œ"hearts"/"diamonds"/"clubs"/"spades"
		name: æ˜¾ç¤ºåç§°ï¼Œå¦‚"çº¢æ¡ƒ3"
	
	è¿”å›:
		Control: åˆ›å»ºå¥½çš„å¡ç‰‡è§†å›¾ï¼Œå¤±è´¥è¿”å›null
	"""
	
	# æ­¥éª¤1: åˆ›å»ºå¹¶éªŒè¯æ•°æ®
	var card_data = CardData.new()
	card_data.id = card_id
	card_data.base_value = value
	card_data.suit = suit
	card_data.name = name
	card_data.image_path = ResourcePaths.get_card_image_path(card_id)
	
	if not _validate_card_data(card_data):
		push_error("å¡ç‰‡æ•°æ®éªŒè¯å¤±è´¥: " + card_id)
		return null
	
	# æ­¥éª¤2: åˆ›å»ºè§†å›¾
	var CardScene = preload("res://cs/å¡ç‰Œç³»ç»Ÿ/è§†å›¾/Card.tscn")
	var card_view = CardScene.instantiate()
	
	if not card_view:
		push_error("å¡ç‰‡è§†å›¾åˆ›å»ºå¤±è´¥: " + card_id)
		return null
	
	# æ­¥éª¤3: ç»‘å®šæ•°æ®
	card_view.setup(card_data)
	
	# æ­¥éª¤4: é…ç½®å±æ€§
	card_view.scale = Vector2(0.8, 0.8)
	card_view.set_draggable(true)
	
	# æ­¥éª¤5: è¿æ¥ä¿¡å·
	_connect_card_signals(card_view)
	
	print("å¡ç‰‡åˆ›å»ºæˆåŠŸ: %s" % name)
	return card_view

func _validate_card_data(card_data: CardData) -> bool:
	"""éªŒè¯å¡ç‰‡æ•°æ®çš„å®Œæ•´æ€§"""
	if card_data.id.is_empty(): return false
	if card_data.base_value < 1 or card_data.base_value > 13: return false
	if not card_data.suit in ["hearts", "diamonds", "clubs", "spades"]: return false
	if not ResourceLoader.exists(card_data.image_path): return false
	return true

func _connect_card_signals(card_view: Control):
	"""è¿æ¥å¡ç‰‡ä¿¡å·"""
	if card_view.has_signal("card_clicked"):
		card_view.card_clicked.connect(_on_card_clicked)
	if card_view.has_signal("card_dragged"):
		card_view.card_dragged.connect(_on_card_dragged)
```

### æ‰¹é‡æ„å»ºæ‰‹ç‰Œ

```gdscript
func build_hand_from_data(cards_data: Array[Dictionary]) -> Array[Control]:
	"""
	ä»æ•°æ®æ•°ç»„æ‰¹é‡æ„å»ºæ‰‹ç‰Œ
	
	å‚æ•°:
		cards_data: å¡ç‰‡æ•°æ®æ•°ç»„ï¼Œæ ¼å¼å¦‚ä¸‹:
		[
			{"id": "H3", "value": 3, "suit": "hearts", "name": "çº¢æ¡ƒ3"},
			{"id": "S7", "value": 7, "suit": "spades", "name": "é»‘æ¡ƒ7"},
			...
		]
	
	è¿”å›:
		Array[Control]: åˆ›å»ºå¥½çš„å¡ç‰‡è§†å›¾æ•°ç»„
	"""
	
	var hand_views: Array[Control] = []
	
	for i in range(cards_data.size()):
		var card_info = cards_data[i]
		
		# åˆ›å»ºå•å¼ å¡ç‰‡
		var card_view = create_card(
			card_info.id,
			card_info.value,
			card_info.suit,
			card_info.name
		)
		
		if card_view:
			# æ·»åŠ åˆ°å®¹å™¨
			hand_container.add_child(card_view)
			hand_views.append(card_view)
			
			# è®¾ç½®æ‰‹ç‰Œä½ç½®ï¼ˆæ‰‡å½¢æ’åˆ—ï¼‰
			_set_hand_position(card_view, i, cards_data.size())
		else:
			push_error("åˆ›å»ºå¡ç‰‡å¤±è´¥: " + str(card_info))
	
	print("æ‰‹ç‰Œæ„å»ºå®Œæˆï¼Œå…± %d å¼ å¡ç‰‡" % hand_views.size())
	return hand_views

func _set_hand_position(card_view: Control, index: int, total: int):
	"""è®¾ç½®æ‰‹ç‰Œä¸­å¡ç‰‡çš„ä½ç½®ï¼ˆæ‰‡å½¢æ’åˆ—æ•ˆæœï¼‰"""
	var angle_step = 8.0  # æ¯å¼ ç‰Œä¹‹é—´çš„è§’åº¦
	var start_angle = -(total - 1) * angle_step / 2
	var card_angle = start_angle + index * angle_step
	
	# åº”ç”¨æ—‹è½¬
	card_view.rotation_degrees = card_angle * 0.4
	
	# è®¾ç½®å‚ç›´åç§»ï¼ˆä¸­é—´çš„ç‰Œç¨å¾®å‘ä¸Šï¼‰
	var center_index = total / 2.0
	var distance_from_center = abs(index - center_index)
	var vertical_offset = distance_from_center * 5
	card_view.position.y += vertical_offset
```

---

## â— å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: å¡ç‰‡å›¾ç‰‡ä¸æ˜¾ç¤º

**åŸå› åˆ†æ**:
- å›¾ç‰‡è·¯å¾„è®¡ç®—é”™è¯¯
- å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨
- èµ„æºåŠ è½½å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```gdscript
func debug_card_image(card_id: String):
	var path = ResourcePaths.get_card_image_path(card_id)
	print("è®¡ç®—è·¯å¾„: %s" % path)
	print("æ–‡ä»¶å­˜åœ¨: %s" % ResourceLoader.exists(path))
	
	if ResourceLoader.exists(path):
		var texture = load(path)
		print("åŠ è½½æˆåŠŸ: %s" % (texture != null))
	else:
		print("ä½¿ç”¨é»˜è®¤å›¾ç‰‡")
```

### é—®é¢˜2: å¡ç‰‡ä½ç½®ä¸å±…ä¸­

**åŸå› åˆ†æ**:
- é”šç‚¹è®¾ç½®é”™è¯¯
- å®¹å™¨å¤§å°è®¡ç®—é”™è¯¯
- ç¼©æ”¾å½±å“ä½ç½®è®¡ç®—

**è§£å†³æ–¹æ¡ˆ**:
```gdscript
func center_card_in_container(card_view: Control, container: Control):
	# ç­‰å¾…ä¸€å¸§ç¡®ä¿å°ºå¯¸è®¡ç®—å®Œæˆ
	await get_tree().process_frame
	
	# ä½¿ç”¨é”šç‚¹å±…ä¸­
	card_view.anchor_left = 0.5
	card_view.anchor_top = 0.5
	card_view.anchor_right = 0.5
	card_view.anchor_bottom = 0.5
	
	# è€ƒè™‘ç¼©æ”¾çš„åç§»
	var scale_factor = card_view.scale.x
	card_view.offset_left = -card_view.size.x * scale_factor / 2
	card_view.offset_top = -card_view.size.y * scale_factor / 2
```

### é—®é¢˜3: å†…å­˜æ³„æ¼

**åŸå› åˆ†æ**:
- å¡ç‰‡è§†å›¾æœªæ­£ç¡®é‡Šæ”¾
- ä¿¡å·è¿æ¥æœªæ–­å¼€
- å¾ªç¯å¼•ç”¨

**è§£å†³æ–¹æ¡ˆ**:
```gdscript
func cleanup_hand():
	# æ–­å¼€æ‰€æœ‰ä¿¡å·è¿æ¥
	for card_view in hand_views:
		if is_instance_valid(card_view):
			# æ–­å¼€ä¿¡å·
			if card_view.card_clicked.is_connected(_on_card_clicked):
				card_view.card_clicked.disconnect(_on_card_clicked)
			
			# ä»åœºæ™¯æ ‘ç§»é™¤å¹¶é‡Šæ”¾
			card_view.queue_free()
	
	# æ¸…ç©ºæ•°ç»„
	hand_views.clear()
	hand_cards.clear()
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¯¹è±¡æ± æ¨¡å¼

```gdscript
# å¡ç‰‡å¯¹è±¡æ± ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯
var card_pool: Array[Control] = []
var pool_size: int = 20

func get_card_from_pool() -> Control:
	if card_pool.size() > 0:
		return card_pool.pop_back()
	else:
		return CardScene.instantiate()

func return_card_to_pool(card_view: Control):
	card_view.visible = false
	card_view.get_parent().remove_child(card_view)
	card_pool.append(card_view)
```

### 2. å»¶è¿ŸåŠ è½½

```gdscript
# åªåœ¨éœ€è¦æ—¶åŠ è½½å›¾ç‰‡èµ„æº
func load_card_texture_async(card_data: CardData, card_view: Control):
	var path = card_data.image_path
	
	# å¼‚æ­¥åŠ è½½
	ResourceLoader.load_threaded_request(path)
	
	# ç­‰å¾…åŠ è½½å®Œæˆ
	while ResourceLoader.load_threaded_get_status(path) != ResourceLoader.THREAD_LOAD_LOADED:
		await get_tree().process_frame
	
	var texture = ResourceLoader.load_threaded_get(path)
	if texture and is_instance_valid(card_view):
		card_view.front_texture.texture = texture
```

### 3. æ‰¹é‡æ“ä½œä¼˜åŒ–

```gdscript
# æ‰¹é‡æ›´æ–°ï¼Œå‡å°‘é‡ç»˜æ¬¡æ•°
func update_hand_batch(cards_data: Array):
	# æš‚åœè‡ªåŠ¨é‡ç»˜
	set_process(false)
	
	for card_data in cards_data:
		# æ‰¹é‡æ›´æ–°æ“ä½œ
		update_single_card(card_data)
	
	# æ¢å¤è‡ªåŠ¨é‡ç»˜ï¼Œè§¦å‘ä¸€æ¬¡æ€§é‡ç»˜
	set_process(true)
	queue_redraw()
```

---

## ğŸ“ æ€»ç»“

æ‰‹ç‰Œæ„å»ºç³»ç»Ÿé‡‡ç”¨äº†æ¸…æ™°çš„MVCæ¶æ„ï¼Œé€šè¿‡ä»¥ä¸‹å…³é”®ç»„ä»¶åä½œï¼š

1. **CardData**: è´Ÿè´£æ•°æ®å­˜å‚¨å’Œç®¡ç†
2. **ResourcePaths**: ç»Ÿä¸€èµ„æºè·¯å¾„è®¡ç®—
3. **CardView**: å¤„ç†è§†å›¾æ˜¾ç¤ºå’Œäº¤äº’
4. **Card.tscn**: å®šä¹‰è§†è§‰ç»“æ„

æ•´ä¸ªæµç¨‹éµå¾ª"æ•°æ®é©±åŠ¨è§†å›¾"çš„åŸåˆ™ï¼Œç¡®ä¿äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚é€šè¿‡åˆç†çš„é”™è¯¯å¤„ç†ã€æ€§èƒ½ä¼˜åŒ–å’Œå†…å­˜ç®¡ç†ï¼Œç³»ç»Ÿèƒ½å¤Ÿç¨³å®šé«˜æ•ˆåœ°è¿è¡Œã€‚

---

## ğŸ¯ å®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹1: åˆ›å»ºæ ‡å‡†52å¼ ç‰Œåº“

```gdscript
func create_standard_deck() -> Array[CardData]:
	"""åˆ›å»ºæ ‡å‡†52å¼ æ‰‘å…‹ç‰Œ"""
	var deck: Array[CardData] = []
	var suits = ["S", "H", "D", "C"]  # é»‘æ¡ƒã€çº¢æ¡ƒã€æ–¹ç‰‡ã€æ¢…èŠ±
	var suit_names = ["é»‘æ¡ƒ", "çº¢æ¡ƒ", "æ–¹ç‰‡", "æ¢…èŠ±"]

	for suit_index in range(suits.size()):
		var suit = suits[suit_index]
		var suit_name = suit_names[suit_index]

		for value in range(1, 14):  # Aåˆ°K
			var card_data = CardData.new()
			card_data.id = suit + str(value)
			card_data.base_value = value
			card_data.suit = _get_suit_name(suit)
			card_data.name = suit_name + _get_value_name(value)
			card_data.image_path = ResourcePaths.get_card_image_path(card_data.id)

			deck.append(card_data)

	return deck

func _get_suit_name(suit_code: String) -> String:
	match suit_code:
		"S": return "spades"
		"H": return "hearts"
		"D": return "diamonds"
		"C": return "clubs"
		_: return ""

func _get_value_name(value: int) -> String:
	match value:
		1: return "A"
		11: return "J"
		12: return "Q"
		13: return "K"
		_: return str(value)
```

### æ¡ˆä¾‹2: å®ç°æ´—ç‰Œç®—æ³•

```gdscript
func shuffle_deck(deck: Array[CardData]) -> Array[CardData]:
	"""Fisher-Yatesæ´—ç‰Œç®—æ³•"""
	var shuffled = deck.duplicate()

	for i in range(shuffled.size() - 1, 0, -1):
		var j = randi() % (i + 1)
		var temp = shuffled[i]
		shuffled[i] = shuffled[j]
		shuffled[j] = temp

	return shuffled
```

### æ¡ˆä¾‹3: å‘ç‰Œåˆ°å¤šä¸ªç©å®¶

```gdscript
func deal_cards_to_players(deck: Array[CardData], player_count: int, cards_per_player: int) -> Array[Array[CardData]]:
	"""å°†ç‰Œå‘ç»™å¤šä¸ªç©å®¶"""
	var players_hands: Array[Array[CardData]] = []

	# åˆå§‹åŒ–ç©å®¶æ‰‹ç‰Œ
	for i in range(player_count):
		players_hands.append([])

	# è½®æµå‘ç‰Œ
	var card_index = 0
	for round in range(cards_per_player):
		for player in range(player_count):
			if card_index < deck.size():
				players_hands[player].append(deck[card_index])
				card_index += 1

	return players_hands
```

---

## ğŸ”§ è°ƒè¯•å·¥å…·

### å¡ç‰‡ä¿¡æ¯æŸ¥çœ‹å™¨

```gdscript
func debug_card_info(card_data: CardData):
	"""æ‰“å°å¡ç‰‡è¯¦ç»†ä¿¡æ¯ç”¨äºè°ƒè¯•"""
	print("=== å¡ç‰‡ä¿¡æ¯ ===")
	print("ID: %s" % card_data.id)
	print("åç§°: %s" % card_data.name)
	print("æ•°å€¼: %d" % card_data.base_value)
	print("èŠ±è‰²: %s" % card_data.suit)
	print("å›¾ç‰‡è·¯å¾„: %s" % card_data.image_path)
	print("æ–‡ä»¶å­˜åœ¨: %s" % ResourceLoader.exists(card_data.image_path))

	if card_data.wax_seals.size() > 0:
		print("èœ¡å°: %s" % str(card_data.wax_seals))
	if card_data.frame_type != "":
		print("ç‰Œæ¡†: %s" % card_data.frame_type)

	print("===============")
```

### æ‰‹ç‰ŒçŠ¶æ€ç›‘æ§

```gdscript
func monitor_hand_state(hand_cards: Array[CardData], hand_views: Array[Control]):
	"""ç›‘æ§æ‰‹ç‰ŒçŠ¶æ€"""
	print("=== æ‰‹ç‰ŒçŠ¶æ€ ===")
	print("æ•°æ®æ•°é‡: %d" % hand_cards.size())
	print("è§†å›¾æ•°é‡: %d" % hand_views.size())

	for i in range(min(hand_cards.size(), hand_views.size())):
		var card = hand_cards[i]
		var view = hand_views[i]
		print("å¡ç‰‡ %d: %s - è§†å›¾æœ‰æ•ˆ: %s" % [i+1, card.name, is_instance_valid(view)])

	print("===============")
```

---

## ğŸ“š æ‰©å±•åŠŸèƒ½

### å¡ç‰‡åŠ¨ç”»ç³»ç»Ÿ

```gdscript
func animate_card_deal(card_view: Control, target_position: Vector2, delay: float = 0.0):
	"""å¡ç‰‡å‘ç‰ŒåŠ¨ç”»"""
	var tween = create_tween()

	# è®¾ç½®åˆå§‹ä½ç½®ï¼ˆç‰Œå †ä½ç½®ï¼‰
	card_view.position = Vector2(-200, -100)
	card_view.rotation_degrees = 0
	card_view.scale = Vector2(0.5, 0.5)

	# å»¶è¿Ÿå¼€å§‹
	if delay > 0:
		await get_tree().create_timer(delay).timeout

	# ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®
	tween.parallel().tween_property(card_view, "position", target_position, 0.5)
	tween.parallel().tween_property(card_view, "scale", Vector2(0.8, 0.8), 0.5)
	tween.parallel().tween_property(card_view, "rotation_degrees", randf_range(-5, 5), 0.5)

	# è®¾ç½®ç¼“åŠ¨æ•ˆæœ
	tween.set_ease(Tween.EASE_OUT)
	tween.set_trans(Tween.TRANS_BACK)

func animate_card_flip(card_view: Control):
	"""å¡ç‰‡ç¿»è½¬åŠ¨ç”»"""
	var tween = create_tween()

	# ç¬¬ä¸€é˜¶æ®µï¼šç¼©æ”¾åˆ°0ï¼ˆéšè—ï¼‰
	tween.tween_property(card_view, "scale:x", 0.0, 0.15)

	# ä¸­é—´ï¼šåˆ‡æ¢æ­£åé¢
	tween.tween_callback(func(): card_view.flip_card())

	# ç¬¬äºŒé˜¶æ®µï¼šæ¢å¤ç¼©æ”¾ï¼ˆæ˜¾ç¤ºï¼‰
	tween.tween_property(card_view, "scale:x", 0.8, 0.15)
```

### å¡ç‰‡é€‰æ‹©ç³»ç»Ÿ

```gdscript
class_name CardSelector extends RefCounted

var selected_cards: Array[Control] = []
var max_selection: int = 5
var selection_changed: Signal

func select_card(card_view: Control) -> bool:
	"""é€‰æ‹©å¡ç‰‡"""
	if card_view in selected_cards:
		return false  # å·²ç»é€‰ä¸­

	if selected_cards.size() >= max_selection:
		return false  # è¶…å‡ºé€‰æ‹©ä¸Šé™

	selected_cards.append(card_view)
	card_view.set_selected(true)
	selection_changed.emit(selected_cards)
	return true

func deselect_card(card_view: Control) -> bool:
	"""å–æ¶ˆé€‰æ‹©å¡ç‰‡"""
	var index = selected_cards.find(card_view)
	if index == -1:
		return false  # æœªé€‰ä¸­

	selected_cards.remove_at(index)
	card_view.set_selected(false)
	selection_changed.emit(selected_cards)
	return true

func clear_selection():
	"""æ¸…ç©ºé€‰æ‹©"""
	for card_view in selected_cards:
		card_view.set_selected(false)
	selected_cards.clear()
	selection_changed.emit(selected_cards)
```

---

## ğŸ¨ UIå¸ƒå±€ç­–ç•¥

### æ‰‹ç‰Œæ’åˆ—æ¨¡å¼

```gdscript
enum HandLayoutMode {
	LINEAR,      # çº¿æ€§æ’åˆ—
	FAN,         # æ‰‡å½¢æ’åˆ—
	GRID,        # ç½‘æ ¼æ’åˆ—
	CIRCULAR     # åœ†å½¢æ’åˆ—
}

func arrange_hand(cards: Array[Control], mode: HandLayoutMode, container: Control):
	"""æ ¹æ®æ¨¡å¼æ’åˆ—æ‰‹ç‰Œ"""
	match mode:
		HandLayoutMode.LINEAR:
			_arrange_linear(cards, container)
		HandLayoutMode.FAN:
			_arrange_fan(cards, container)
		HandLayoutMode.GRID:
			_arrange_grid(cards, container)
		HandLayoutMode.CIRCULAR:
			_arrange_circular(cards, container)

func _arrange_fan(cards: Array[Control], container: Control):
	"""æ‰‡å½¢æ’åˆ—"""
	var total = cards.size()
	if total == 0: return

	var angle_range = 60.0  # æ€»è§’åº¦èŒƒå›´
	var angle_step = angle_range / max(1, total - 1)
	var start_angle = -angle_range / 2

	var center = container.size / 2
	var radius = 100.0

	for i in range(total):
		var card = cards[i]
		var angle = start_angle + i * angle_step
		var angle_rad = deg_to_rad(angle)

		# è®¡ç®—ä½ç½®
		var pos = Vector2(
			center.x + sin(angle_rad) * radius,
			center.y + cos(angle_rad) * radius
		)

		card.position = pos
		card.rotation_degrees = angle * 0.5  # è½»å¾®æ—‹è½¬
```

è¿™ä»½æŠ€æœ¯æ–‡æ¡£ç°åœ¨åŒ…å«äº†ï¼š

1. **å®Œæ•´çš„ç³»ç»Ÿæ¶æ„è¯´æ˜**
2. **è¯¦ç»†çš„ç»„ä»¶åŠŸèƒ½è§£æ**
3. **æ­¥éª¤åŒ–çš„æ„å»ºæµç¨‹**
4. **å®ç”¨çš„ä»£ç ç¤ºä¾‹**
5. **å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ**
6. **æ€§èƒ½ä¼˜åŒ–å»ºè®®**
7. **å®æˆ˜æ¡ˆä¾‹æ¼”ç¤º**
8. **è°ƒè¯•å·¥å…·å’Œæ‰©å±•åŠŸèƒ½**

æ–‡æ¡£æ¶µç›–äº†ä»åŸºç¡€æ¦‚å¿µåˆ°é«˜çº§åº”ç”¨çš„æ‰€æœ‰å†…å®¹ï¼Œå¯ä»¥ä½œä¸ºå¼€å‘æ‰‹ç‰Œç³»ç»Ÿçš„å®Œæ•´å‚è€ƒæŒ‡å—ï¼
