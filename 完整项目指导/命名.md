# 奥术学院扑克——核心变量统一命名规范表 (v2.0)

## 1. 命名约定 (Naming Conventions)

在整个项目开发中，请**严格遵循**以下命名约定：

- **文件/文件夹名 (File/Folder Names)**：`PascalCase` (文件夹) 或 `snake_case.gd` (脚本)。

- **类名 (Class Names)**：`PascalCase`，例如 `GameManager`, `CardData`。

- **GDScript Resource 类名**：`PascalCase`，通常以 `Data` 结尾，如 `CardData`, `ArtifactData`。

- **方法名 (Method Names)**：`snake_case`。私有方法以 `_` 开头，例如 `initialize_game_state()`, `_update_ui()`, `_on_button_pressed()`。

- 变量名 (Variable Names)

  ：

  ```
  snake_case
  ```

  。

  - **全局单例 (Autoload)**：通过其类名直接访问，例如 `GameManager.player_lore_points`。
  - **节点引用 (通过 `@onready` 或 `$`)**：通常 `_node` 后缀或直接用节点名，例如 `@onready var play_button_node: Button = $PlayButton`。
  - **Resource 实例**：通常 `_data` 后缀，例如 `card_data`, `artifact_data`。
  - **`PackedScene` 引用**：通常 `_scene` 后缀，例如 `card_view_scene: PackedScene`。
  - **节点实例**：通常 `_instance` 或 `_view_instance` 后缀，例如 `card_view_instance: CardView`。
  - **数组/列表**：使用复数形式，例如 `player_hand_cards`, `equipped_artifacts`。

- **信号名 (Signal Names)**：`snake_case`。通常以 `[主体]_changed` (状态变化) 或 `[动作]_requested` (请求操作) 形式，例如 `game_state_changed`, `play_cards_requested`。

- **常量 (Constants)**：`SCREAMING_SNAKE_CASE` (全大写，单词间用下划线连接)，例如 `MAX_HAND_SIZE`, `VICTORY_SCORES`。

- **枚举值 (Enum Values)**：`SCREAMING_SNAKE_CASE`，例如 `TERM_SPRING`, `WAX_RED`。

- **类型提示 (Type Hints)**：在变量声明和函数参数/返回值中尽可能使用类型提示，例如 `var my_variable: int`, `func my_func(param_name: String) -> bool:`.

## 2. 核心变量统一对应表

本表列出游戏中所有关键的状态、数据和常见情境，为其指定在代码中应使用的**唯一变量名**，并明确其所属的**权威模块**、**数据类型**和**常见用法**。

------

### **A. 游戏全局状态与进度 (Authority: `GameManager`)**

| 概念描述               | 统一变量名                 | 类型                       | 备注                                                         |
| :--------------------- | :------------------------- | :------------------------- | :----------------------------------------------------------- |
| 当前学年               | `current_academic_year`    | `int`                      | 1-6 年级                                                     |
| 当前学期               | `current_academic_term`    | `GlobalEnums.TermType`     | `GlobalEnums.TermType.SPRING`, `SUMMER`, `AUTUMN`, `WINTER`  |
| 玩家学识点 (货币)      | `player_lore_points`       | `int`                      | 用于商店购买                                                 |
| 当前学年累计得分       | `current_year_total_score` | `int`                      | 每个学年开始清零，研习得分累加                               |
| 法器槽位上限           | `artifact_slot_capacity`   | `int`                      | 初始值由 `GameConfig` 定义，可动态增加                       |
| 瞬发法术背包容量       | `spell_bag_capacity`       | `int`                      | 初始值由 `GameConfig` 定义，可动态增加                       |
| 守护灵槽位上限         | `joker_slot_capacity`      | `int`                      | 初始值由 `GameConfig` 定义，可动态增加                       |
| 已装备法器列表         | `equipped_artifacts`       | `Array[ArtifactData]`      | 存储 `ArtifactData` 资源实例                                 |
| 瞬发法术库存列表       | `spell_inventory`          | `Array[SpellData]`         | 存储 `SpellData` 资源实例 (其内部 `current_charges` 表示数量) |
| 活跃守护灵列表         | `active_jokers`            | `Array[JokerData]`         | 存储 `JokerData` 资源实例                                    |
| 牌型等级               | `card_type_levels`         | `Dictionary` (String: int) | `{"Pair": 2, "Flush": 1}`，键为 `GlobalEnums` 中的牌型常量   |
| 手牌上限修正           | `hand_size_modifier`       | `int`                      | 动态修正值 (来自法器、学年限制、Debuff)。基础值由 `GameConfig` 提供。 |
| 每次研习已用主动法术数 | `spells_used_this_turn`    | `int`                      | 每回合开始时重置，用于限制每回合主动法术使用次数             |
| 本回合是否首次打牌     | `is_first_play_this_turn`  | `bool`                     | 每回合开始时设为 `true`，打出牌后设为 `false`                |

------

### **B. 牌库与卡牌管理 (Authority: `CardManager`)**

| 概念描述              | 统一变量名                | 类型                                        | 备注                                                         |
| :-------------------- | :------------------------ | :------------------------------------------ | :----------------------------------------------------------- |
| 牌库 (主抽牌堆)       | `card_deck`               | `Array[CardData]`                           | 存储 `CardData` 实例                                         |
| 玩家手牌              | `player_hand_cards`       | `Array[CardData]`                           | 存储 `CardData` 实例                                         |
| 弃牌堆                | `discard_pile_cards`      | `Array[CardData]`                           | 存储 `CardData` 实例                                         |
| 销毁堆 (永久移出游戏) | `destroyed_pile_cards`    | `Array[CardData]`                           | 存储 `CardData` 实例。牌从游戏中永久移除。                   |
| 所有原始符文牌资源    | `all_base_rune_resources` | `Array[PackedScene]` (或 `Array[CardData]`) | 存储 `CardData.tres` 文件路径或已加载的 Resource。用于初始化牌库。 |

------

### **C. 卡牌数据字段 (Authority: `CardData`)**

| 概念描述     | 统一变量名       | 类型            | 备注                                                         |
| :----------- | :--------------- | :-------------- | :----------------------------------------------------------- |
| 卡牌唯一ID   | `card_id`        | `String`        | "H1" (红桃A), "S13" (黑桃K)。复制品也应有唯一ID (`id + "_" + str(randi())`) |
| 卡牌基础点数 | `base_value`     | `int`           | 1-13 (A-K)，A可作1或14                                       |
| 卡牌花色     | `card_suit`      | `String`        | "hearts", "diamonds", "clubs", "spades"                      |
| 卡牌名称     | `card_name`      | `String`        | "红桃A"                                                      |
| 卡牌图像路径 | `image_path`     | `String`        | 用于加载 `Texture2D`                                         |
| 蜡封类型列表 | `wax_seal_types` | `Array[String]` | 存储 `GlobalEnums.WaxSealType` 字符串。可多重拥有。          |
| 牌框类型     | `frame_type`     | `String`        | 存储 `GlobalEnums.FrameType` 字符串。只能有一种。            |
| 材质类型     | `material_type`  | `String`        | 存储 `GlobalEnums.MaterialType` 字符串。只能有一种。         |

------

### **D. 能力数据字段 (Authority: `ArtifactData`, `SpellData`, `JokerData`)**

| 概念描述                       | 统一变量名             | 类型                              | 备注                                                        |
| :----------------------------- | :--------------------- | :-------------------------------- | :---------------------------------------------------------- |
| 物品唯一ID                     | `item_id`              | `String`                          | 例如 "ARTIFACT_MAGIC_CRYSTAL", "SPELL_FLASH_OF_INSIGHT"     |
| 物品名称                       | `item_name`            | `String`                          | 例如 "魔力水晶"                                             |
| 物品描述                       | `description_text`     | `String`                          | 用于UI显示                                                  |
| 稀有度                         | `rarity_type`          | `GlobalEnums.Rarity`              | COMMON, RARE, EPIC, LEGENDARY                               |
| 购买费用                       | `purchase_cost`        | `int`                             |                                                             |
| 效果类型标识符                 | `effect_type_id`       | `String`                          | 用于 `GameManager.trigger_effect_logic()` 调度              |
| 效果数值/参数                  | `effect_value_param`   | `Variant`                         | 配合 `effect_type_id` 使用，如 0.05 (5%) 或 1 (增加1点)     |
| *SpellData:* 法术施放类型      | `spell_cast_type`      | `GlobalEnums.SpellType`           | `GlobalEnums.SpellType.INSTANT_USE` 或 `ACTIVE_SKILL`       |
| *SpellData:* 当前使用次数/充能 | `current_charges`      | `int`                             | 技能区法术的剩余使用次数，`INSTANT_USE` 类型法术该值通常为1 |
| *JokerData:* 触发时机          | `trigger_event_timing` | `GlobalEnums.EffectTriggerTiming` | `GlobalEnums.EffectTriggerTiming.ON_TURN_START` 等          |

------

### **E. 全局配置 (Authority: `GameConfig` Resource)**

| 概念描述                 | 统一变量名                    | 类型                                | 备注                                                         |
| :----------------------- | :---------------------------- | :---------------------------------- | :----------------------------------------------------------- |
| 胜利目标分数 (按学年)    | `victory_score_by_year`       | `Dictionary` (int: int)             | `{1: 500, 2: 1200, ...}`                                     |
| 学期奖励 (按学期类型)    | `term_rewards_by_type`        | `Dictionary` (TermType: Dict)       | `{GlobalEnums.TermType.SPRING: {"lore_points": 20, "card_wax_type": GlobalEnums.WaxSealType.RED}, ...}` |
| 初始手牌大小             | `initial_player_hand_size`    | `int`                               | 默认8                                                        |
| 每回合最大技能法术使用数 | `max_active_spells_per_turn`  | `int`                               |                                                              |
| 最大弃牌重抽数量         | `max_discard_redraw_count`    | `int`                               |                                                              |
| 牌型基础得分             | `card_type_base_scores`       | `Dictionary` (String: int)          | `{"HighCard": 5, "Pair": 10, ...}`                           |
| 牌型等级倍率             | `card_type_level_multipliers` | `Dictionary` (String: Array[float]) | `{"HighCard": [1.0, 1.2, ...], "Pair": [1.5, 2.0, ...], ...}` |
| 商店商品刷新概率         | `shop_rarity_probabilities`   | `Dictionary` (String: float)        | `{"COMMON": 0.65, "RARE": 0.25, ...}`                        |
| 商店物品费用范围         | `shop_cost_ranges`            | `Dictionary` (String: Array[int])   | `{"COMMON": [8, 15], "RARE": [20, 35], ...}`                 |

------

### **F. 事件系统状态 (Authority: `EventManager`)**

| 概念描述                 | 统一变量名                      | 类型                | 备注                                                         |
| :----------------------- | :------------------------------ | :------------------ | :----------------------------------------------------------- |
| 活跃学年Buff列表         | `active_term_buffs`             | `Array[Dictionary]` | Buff字典结构如 `{"effect_type_id": "LORE_POINTS_PERCENT_BONUS", "value": 0.2}` |
| 活跃回合Buff列表         | `active_turn_buffs`             | `Array[Dictionary]` | 同上，但持续单回合                                           |
| 活跃Debuff列表           | `active_debuffs`                | `Array[Dictionary]` | Debuff字典结构如 `{"effect_type_id": "HAND_SIZE_PENALTY", "value": -1, "duration": 3}` |
| 奥术直觉考验激活状态     | `is_arcane_intuition_active`    | `bool`              |                                                              |
| 奥术直觉考验目标分数     | `arcane_intuition_target_score` | `int`               | 由 `ScoreCalculator` 计算出的最高理论分                      |
| 奥术直觉考验游戏状态快照 | `arcane_intuition_snapshot`     | `Dictionary`        | 存储考验触发时的 `GameManager` 状态副本，供 `ScoreCalculator` 模拟 |

------

### **G. UI特定状态与交互变量**

| 概念描述                        | 统一变量名                    | 类型              | 权威所属模块        | 备注                                                         |
| :------------------------------ | :---------------------------- | :---------------- | :------------------ | :----------------------------------------------------------- |
| (HandDock) 玩家选中手牌列表     | `selected_hand_cards`         | `Array[CardData]` | `HandDock`          | 玩家在UI中点击选中的牌的 `CardData` 实例。                   |
| (HandDock) 玩家选中法术         | `selected_spell_data`         | `SpellData`       | `HandDock`          | 玩家在UI中点击选中的技能区法术。                             |
| (WisdomHall) 商店当前商品列表   | `current_shop_offers`         | `Array[Resource]` | `WisdomHallManager` | 存储 `ArtifactData`, `SpellData`, `JokerData` 实例           |
| (WisdomHall) 商店商品UI场景原型 | `shop_item_view_scene`        | `PackedScene`     | `WisdomHallManager` | 用于实例化商店商品的UI节点 (例如，一个展示商品信息的自定义控件) |
| (Assessment) 考核目标分数       | `assessment_target_score`     | `int`             | `AssessmentManager` | 来自 `GameConfig.victory_score_by_year`                      |
| (Assessment) 考核剩余回合数     | `assessment_remaining_rounds` | `int`             | `AssessmentManager` |                                                              |
| (UI) 通用弹窗标题               | `popup_title_text`            | `String`          | `EventPopup`        |                                                              |
| (UI) 通用弹窗描述               | `popup_description_text`      | `String`          | `EventPopup`        |                                                              |

------

### **H. 常见局部/临时变量命名模式**

这些变量通常只存在于单个函数或代码块的生命周期内，但保持命名一致性仍然重要。

| 概念描述         | 统一变量名          | 常见类型        | 示例用法                                           |
| :--------------- | :------------------ | :-------------- | :------------------------------------------------- |
| 循环计数器       | `i`, `j`, `k`       | `int`           | `for i in range(count):`                           |
| 迭代器/当前项    | `current_item`      | `Variant`       | `for current_item in my_array:`                    |
| 索引             | `idx`               | `int`           | `my_array[idx]`                                    |
| 循环中的卡牌     | `card_data_iter`    | `CardData`      | `for card_data_iter in player_hand_cards:`         |
| 循环中的能力     | `ability_data_iter` | `Resource`      | `for ability_data_iter in equipped_artifacts:`     |
| 临时分数         | `temp_score`        | `int` / `float` | `var temp_score = base_score * multiplier`         |
| 临时点数         | `temp_value`        | `int`           | `var temp_value = card_data.base_value + modifier` |
| 乘数/因子        | `multiplier_value`  | `float`         | `var multiplier_value = 1.0 + percent_bonus`       |
| 布尔标记         | `is_condition_met`  | `bool`          | `if is_condition_met:`                             |
| 结果存储         | `calculated_result` | `Variant`       | `var calculated_result = _perform_calculation()`   |
| 传递给函数的参数 | `param_name`        | (根据参数类型)  | `func my_function(param_name: String):`            |

------

### **I. 信号参数命名规范**

当发出信号时，参数的命名应清晰，并带有类型提示。监听信号的方法应使用相同的参数名称。

| 信号名称                    | 示例参数列表与类型                                           | 备注                                                  |
| :-------------------------- | :----------------------------------------------------------- | :---------------------------------------------------- |
| `game_state_changed`        | `(p_current_year: int, p_current_term: GlobalEnums.TermType, p_player_score: int, p_lore_points: int)` | `p_` 前缀表示参数 (parameter)，避免与成员变量名冲突。 |
| `player_abilities_changed`  | `(p_equipped_artifacts: Array[ArtifactData], p_spell_inventory: Array[SpellData], p_active_jokers: Array[JokerData])` |                                                       |
| `card_type_levels_changed`  | `(p_card_type_levels: Dictionary)`                           |                                                       |
| `lore_changed`              | `(p_new_lore_points: int)`                                   |                                                       |
| `hand_changed`              | `(p_current_hand_cards: Array[CardData])`                    |                                                       |
| `deck_changed`              | `(p_deck_size: int, p_discard_size: int, p_destroyed_size: int)` |                                                       |
| `play_cards_requested`      | `(p_selected_cards: Array[CardData])`                        | 由UI发出，请求卡牌管理器处理打牌                      |
| `discard_cards_requested`   | `(p_selected_cards: Array[CardData])`                        | 由UI发出，请求卡牌管理器处理弃牌                      |
| `spell_used`                | `(p_spell_id: String)`                                       |                                                       |
| `cards_played`              | `(p_played_cards: Array[CardData], p_score_gained: int)`     | 卡牌管理器发出，通知其他模块有牌被打出及获得分数      |
| `arcane_intuition_finished` | `(p_succeeded: bool)`                                        |                                                       |
| `random_event_triggered`    | `(p_event_id: String, p_event_description: String)`          |                                                       |
| `rewards_claimed`           | `()`                                                         |                                                       |
| `card_clicked`              | `(p_card_view_instance: CardView)`                           | `CardView` 发出，通知 `HandDock` 某张牌被点击         |

------

这份详尽的变量命名规范表应能满足您构建项目时对统一性和清晰度的最高要求。在实际编写代码时，请经常查阅它，确保每行代码都符合这些约定。