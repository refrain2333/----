# ğŸ¯ å¥¥æœ¯å­¦é™¢æ‰‘å…‹ - ç‰Œå‹è¯†åˆ«ç³»ç»ŸæŠ€æœ¯è¯¦è§£

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

å¥¥æœ¯å­¦é™¢æ‰‘å…‹çš„ç‰Œå‹è¯†åˆ«ç³»ç»Ÿé‡‡ç”¨**V2.1æ¶æ„**ï¼Œå®ç°äº†å®Œæ•´çš„æ‰‘å…‹ç‰Œå‹è¯†åˆ«ã€å¾—åˆ†è®¡ç®—å’ŒåŠ¨æ€ç­‰çº§ç®¡ç†ã€‚ç³»ç»Ÿè®¾è®¡éµå¾ª**æ•°æ®éš”ç¦»**å’Œ**èŒè´£åˆ†ç¦»**åŸåˆ™ï¼Œå°†ç‰Œå‹è¯†åˆ«ä¸å¾—åˆ†è®¡ç®—å®Œå…¨åˆ†ç¦»ï¼Œç¡®ä¿é«˜å†…èšã€ä½è€¦åˆçš„æ¶æ„è®¾è®¡ã€‚

### ğŸ—ï¸ æ ¸å¿ƒæ¶æ„

```
HandTypeSystemV2 (ç»Ÿä¸€æ¥å£)
â”œâ”€â”€ SmartHandAnalyzerV2 (ç‰Œå‹è¯†åˆ«)
â”‚   â””â”€â”€ PokerHandAnalyzer (5å¼ ç‰Œåˆ†æå™¨)
â”œâ”€â”€ PreciseScoreCalculator (å¾—åˆ†è®¡ç®—)
â””â”€â”€ HandTypeRankingManager (ç­‰çº§ç®¡ç†)
```

## ğŸ¯ æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. HandTypeSystemV2 - ç»Ÿä¸€æ¥å£å±‚

**èŒè´£**: æä¾›ç»Ÿä¸€çš„ç‰Œå‹è¯†åˆ«å’Œå¾—åˆ†è®¡ç®—æ¥å£

**æ ¸å¿ƒæ–¹æ³•**:
```gdscript
# å®Œæ•´åˆ†ææ¥å£ï¼ˆç‰Œå‹è¯†åˆ« + å¾—åˆ†è®¡ç®—ï¼‰
static func analyze_and_score(cards: Array, ranking_manager = null, bonus_score: int = 0) -> Dictionary

# ä»…ç‰Œå‹è¯†åˆ«æ¥å£
static func analyze_hand_type(cards: Array) -> HandResult

# ä»…å¾—åˆ†è®¡ç®—æ¥å£
static func calculate_score(hand_result: HandResult, ranking_manager = null, bonus_score: int = 0) -> ScoreResult

# å¿«é€Ÿå¾—åˆ†æ¥å£
static func quick_score(cards: Array, level: int = 1, bonus_score: int = 0) -> int
```

**è¿”å›ç»“æœç»“æ„**:
```gdscript
{
    "hand_result": HandResult,      # ç‰Œå‹è¯†åˆ«ç»“æœ
    "score_result": ScoreResult,    # å¾—åˆ†è®¡ç®—ç»“æœ
    "total_analysis_time": int,     # æ€»åˆ†æè€—æ—¶(ms)
    "is_valid": bool               # ç»“æœæœ‰æ•ˆæ€§
}
```

### 2. SmartHandAnalyzerV2 - æ™ºèƒ½ç‰Œå‹åˆ†æå™¨

**èŒè´£**: æ™ºèƒ½åˆ†æ1-Nå¼ ç‰Œçš„æœ€ä½³ç‰Œå‹

**æ ¸å¿ƒç®—æ³•**:
```gdscript
static func find_best_hand(cards: Array) -> HandResult:
    if cards.size() < 5:
        # å°‘äº5å¼ ç‰Œï¼šåˆ†æéƒ¨åˆ†æ‰‹ç‰Œ
        return _analyze_partial_hand(cards)
    elif cards.size() == 5:
        # æ­£å¥½5å¼ ç‰Œï¼šç›´æ¥åˆ†æ
        return PokerHandAnalyzer.analyze(cards)
    else:
        # è¶…è¿‡5å¼ ç‰Œï¼šæ‰¾æœ€ä½³ç»„åˆ
        return _find_best_combination(cards)
```

**åˆ†æç­–ç•¥**:
- **1-4å¼ ç‰Œ**: éƒ¨åˆ†æ‰‹ç‰Œåˆ†æï¼ˆå¯¹å­ã€ä¸‰æ¡ç­‰ï¼‰
- **5å¼ ç‰Œ**: ç›´æ¥ä½¿ç”¨PokerHandAnalyzeråˆ†æ
- **6-10å¼ ç‰Œ**: ç©·ä¸¾æ‰€æœ‰5å¼ ç‰Œç»„åˆ
- **11+å¼ ç‰Œ**: å¯å‘å¼ç®—æ³•ä¼˜åŒ–æ€§èƒ½

### 3. PokerHandAnalyzer - 5å¼ ç‰Œä¸“ä¸šåˆ†æå™¨

**èŒè´£**: ä¸“é—¨å¤„ç†æ ‡å‡†5å¼ ç‰Œçš„ç‰Œå‹è¯†åˆ«

**æ”¯æŒç‰Œå‹** (æŒ‰ä¼˜å…ˆçº§æ’åº):
1. **äº”æ¡** (FIVE_KIND) - 5å¼ ç›¸åŒæ•°å€¼
2. **çš‡å®¶åŒèŠ±é¡º** (ROYAL_FLUSH) - A-K-Q-J-10åŒèŠ±
3. **åŒèŠ±é¡º** (STRAIGHT_FLUSH) - è¿ç»­5å¼ åŒèŠ±
4. **å››æ¡** (FOUR_KIND) - 4å¼ ç›¸åŒæ•°å€¼
5. **è‘«èŠ¦** (FULL_HOUSE) - ä¸‰æ¡+ä¸€å¯¹
6. **åŒèŠ±** (FLUSH) - 5å¼ åŒèŠ±è‰²
7. **é¡ºå­** (STRAIGHT) - è¿ç»­5å¼ æ•°å€¼
8. **ä¸‰æ¡** (THREE_KIND) - 3å¼ ç›¸åŒæ•°å€¼
9. **ä¸¤å¯¹** (TWO_PAIR) - ä¸¤ä¸ªå¯¹å­
10. **ä¸€å¯¹** (PAIR) - 2å¼ ç›¸åŒæ•°å€¼
11. **é«˜ç‰Œ** (HIGH_CARD) - æ— ç‰¹æ®Šç‰Œå‹

**è¯„ä¼°å™¨æ¶æ„**:
```gdscript
var evaluators = [
    {"name": "äº”æ¡", "evaluator": _evaluate_five_kind},
    {"name": "çš‡å®¶åŒèŠ±é¡º", "evaluator": _evaluate_royal_flush},
    {"name": "åŒèŠ±é¡º", "evaluator": _evaluate_straight_flush},
    # ... å…¶ä»–è¯„ä¼°å™¨
]
```

### 4. PreciseScoreCalculator - ç²¾ç¡®å¾—åˆ†è®¡ç®—å™¨

**èŒè´£**: åŸºäºç‰Œå‹è¯†åˆ«ç»“æœè®¡ç®—ç²¾ç¡®å¾—åˆ†

**å¾—åˆ†å…¬å¼**:
```
æœ€ç»ˆå¾—åˆ† = ROUND((åŸºç¡€åˆ† + ç‰Œé¢åˆ† + é™„åŠ åˆ†) Ã— åŠ¨æ€å€ç‡)
```

**å¾—åˆ†ç»„æˆ**:
- **åŸºç¡€åˆ†**: ç‰Œå‹å›ºå®šåˆ†å€¼ (HandTypeEnums.BASE_SCORES)
- **ç‰Œé¢åˆ†**: æ ¹æ®ç‰Œå‹å’Œå¡ç‰Œæ•°å€¼è®¡ç®—
- **é™„åŠ åˆ†**: å¤–éƒ¨æ•ˆæœåŠ æˆ
- **åŠ¨æ€å€ç‡**: åŸºäºç‰Œå‹ç­‰çº§çš„å€ç‡

**ç‰Œé¢åˆ†è®¡ç®—è§„åˆ™**:
```gdscript
match hand_type:
    HandType.HIGH_CARD:    # æœ€é«˜ç‰Œä»·å€¼ Ã— 2
    HandType.PAIR:         # å¯¹å­ä»·å€¼ Ã— 4
    HandType.TWO_PAIR:     # å¤§å¯¹å­Ã—6 + å°å¯¹å­Ã—4
    HandType.THREE_KIND:   # ä¸‰æ¡ä»·å€¼ Ã— 8
    HandType.STRAIGHT:     # æ‰€æœ‰5å¼ ç‰Œä»·å€¼æ€»å’Œ
    HandType.FLUSH:        # (æ‰€æœ‰5å¼ ç‰Œä»·å€¼æ€»å’Œ) Ã— 1.2
    HandType.FULL_HOUSE:   # ä¸‰æ¡Ã—10 + å¯¹å­Ã—6
    HandType.FOUR_KIND:    # å››æ¡ä»·å€¼ Ã— 15
    # ... å…¶ä»–ç‰Œå‹
```

### 5. HandTypeRankingManager - åŠ¨æ€ç­‰çº§ç®¡ç†å™¨

**èŒè´£**: ç®¡ç†ç‰Œå‹çš„åŠ¨æ€ç­‰çº§ç³»ç»Ÿ (LV1-LV5)

**ç­‰çº§å€ç‡é…ç½®**:
```gdscript
const LEVEL_MULTIPLIERS = {
    HandType.HIGH_CARD: [1.0, 0.2],      # 1.0x â†’ 1.8x
    HandType.PAIR: [1.5, 0.3],           # 1.5x â†’ 2.7x
    HandType.TWO_PAIR: [2.0, 0.4],       # 2.0x â†’ 3.6x
    HandType.THREE_KIND: [3.0, 0.6],     # 3.0x â†’ 5.4x
    # ... å…¶ä»–ç‰Œå‹
}
```

**åŠ¨æ€å€ç‡è®¡ç®—**:
```gdscript
åŠ¨æ€å€ç‡ = åŸºç¡€å€ç‡ + (å½“å‰ç­‰çº§ - 1) Ã— ç­‰çº§å¢é‡
```

**æ ¸å¿ƒæ–¹æ³•**:
```gdscript
# è®¾ç½®ç‰Œå‹ç­‰çº§
func set_hand_type_level(hand_type: HandType, level: int) -> bool

# å‡çº§ç‰Œå‹ç­‰çº§
func level_up_hand_type(hand_type: HandType) -> bool

# è·å–åŠ¨æ€å€ç‡
func get_multiplier(hand_type: HandType) -> float
```

## ğŸ“Š æ•°æ®ç»“æ„è¯¦è§£

### HandResult - ç‰Œå‹è¯†åˆ«ç»“æœ

```gdscript
class HandResult:
    # åŸºç¡€ç‰Œå‹ä¿¡æ¯
    var hand_type: HandType                 # ç‰Œå‹æšä¸¾
    var hand_type_name: String             # ç‰Œå‹ä¸­æ–‡åç§°
    var description: String                # ç‰Œå‹æè¿°
    
    # æ ¸å¿ƒç‰Œå€¼ï¼ˆç”¨äºè®¡åˆ†ï¼‰
    var primary_value: int = 0             # ä¸»è¦ç‰Œå€¼
    var secondary_value: int = 0           # æ¬¡è¦ç‰Œå€¼
    
    # å¡ç‰Œç»„ç»‡
    var contributing_cards: Array = []      # æ„æˆç‰Œå‹çš„æ ¸å¿ƒå¡ç‰Œ
    var kickers: Array = []                # è¸¢è„šç‰Œæ•°å€¼
    var all_cards: Array = []              # æ‰€æœ‰å‚ä¸åˆ†æçš„å¡ç‰Œ
    
    # åˆ†æå…ƒæ•°æ®
    var combinations_tested: int = 0        # æµ‹è¯•çš„ç»„åˆæ•°é‡
    var analysis_method: String = ""       # åˆ†ææ–¹æ³•
```

### ScoreResult - å¾—åˆ†è®¡ç®—ç»“æœ

```gdscript
class ScoreResult:
    # æœ€ç»ˆå¾—åˆ†
    var final_score: int = 0               # æœ€ç»ˆå¾—åˆ† (å–æ•´å)
    var raw_score: float = 0.0             # åŸå§‹å¾—åˆ† (å–æ•´å‰)
    
    # å¾—åˆ†ç»„æˆéƒ¨åˆ†
    var base_score: int = 0                # åŸºç¡€ç‰Œå‹åˆ†
    var value_score: int = 0               # ç‰Œé¢ä»·å€¼åˆ†
    var bonus_score: int = 0               # é™„åŠ åˆ†
    var total_base: int = 0                # åŸºç¡€æ€»åˆ†
    
    # å€ç‡ä¿¡æ¯
    var dynamic_multiplier: float = 1.0    # åŠ¨æ€å€ç‡
    var hand_type_level: int = 1           # ç‰Œå‹ç­‰çº§
    
    # è®¡ç®—å…¬å¼
    var calculation_formula: String = ""    # ç®€åŒ–å…¬å¼
    var detailed_formula: String = ""       # è¯¦ç»†å…¬å¼
    var step_by_step: Array = []           # åˆ†æ­¥è®¡ç®—è¿‡ç¨‹
    
    # æ€§èƒ½æŒ‡æ ‡
    var calculation_time_ms: int = 0       # è®¡ç®—è€—æ—¶
```

## ğŸ® ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç‰Œå‹è¯†åˆ«

```gdscript
# 1. åˆ›å»ºå¡ç‰Œæ•°ç»„
var cards = [card1, card2, card3, card4, card5]

# 2. æ‰§è¡Œç‰Œå‹è¯†åˆ«
var hand_result = HandTypeSystemV2.analyze_hand_type(cards)

# 3. è·å–ç»“æœ
print("ç‰Œå‹: %s" % hand_result.hand_type_name)
print("æè¿°: %s" % hand_result.description)
print("æ„æˆå¡ç‰Œ: %då¼ " % hand_result.contributing_cards.size())
```

### å®Œæ•´å¾—åˆ†è®¡ç®—

```gdscript
# 1. åˆ›å»ºç­‰çº§ç®¡ç†å™¨
var ranking_manager = HandTypeRankingManager.new()
ranking_manager.set_hand_type_level(HandTypeEnums.HandType.PAIR, 3)  # è®¾ç½®ä¸€å¯¹ä¸ºLV3

# 2. æ‰§è¡Œå®Œæ•´åˆ†æ
var result = HandTypeSystemV2.analyze_and_score(cards, ranking_manager, 10)

# 3. è·å–è¯¦ç»†ç»“æœ
print("ç‰Œå‹: %s" % result.hand_result.hand_type_name)
print("æœ€ç»ˆå¾—åˆ†: %d" % result.score_result.final_score)
print("è®¡ç®—å…¬å¼: %s" % result.score_result.calculation_formula)
print("åˆ†æè€—æ—¶: %dms" % result.total_analysis_time)
```

### åŠ¨æ€ç­‰çº§ç®¡ç†

```gdscript
# åˆ›å»ºç­‰çº§ç®¡ç†å™¨
var ranking_manager = HandTypeRankingManager.new()

# è®¾ç½®ç‰Œå‹ç­‰çº§
ranking_manager.set_hand_type_level(HandTypeEnums.HandType.PAIR, 3)
ranking_manager.set_hand_type_level(HandTypeEnums.HandType.THREE_KIND, 2)

# å‡çº§ç‰Œå‹
ranking_manager.level_up_hand_type(HandTypeEnums.HandType.FLUSH)

# è·å–ç­‰çº§ä¿¡æ¯
var level = ranking_manager.get_hand_type_level(HandTypeEnums.HandType.PAIR)
var multiplier = ranking_manager.get_multiplier(HandTypeEnums.HandType.PAIR)
print("ä¸€å¯¹ç­‰çº§: LV%d, å€ç‡: %.1fx" % [level, multiplier])
```

## ğŸ”§ æ€§èƒ½ç‰¹æ€§

### ç®—æ³•å¤æ‚åº¦
- **1-5å¼ ç‰Œ**: O(1) - ç›´æ¥åˆ†æ
- **6-10å¼ ç‰Œ**: O(C(n,5)) - ç©·ä¸¾ç»„åˆ
- **11+å¼ ç‰Œ**: O(k) - å¯å‘å¼ç®—æ³•ï¼Œk << C(n,5)

### æ€§èƒ½ä¼˜åŒ–
- **é™æ€åˆå§‹åŒ–**: è¯„ä¼°å™¨åªåˆå§‹åŒ–ä¸€æ¬¡
- **æ™ºèƒ½ç»„åˆ**: è¶…è¿‡10å¼ ç‰Œæ—¶ä½¿ç”¨å¯å‘å¼ç®—æ³•
- **ç¼“å­˜æœºåˆ¶**: é‡å¤è®¡ç®—ç»“æœå¯ç¼“å­˜
- **å¹¶è¡Œå¤„ç†**: æ”¯æŒæ‰¹é‡åˆ†æ

### å†…å­˜ç®¡ç†
- **RefCounted**: æ‰€æœ‰æ ¸å¿ƒç±»ç»§æ‰¿RefCountedï¼Œè‡ªåŠ¨å†…å­˜ç®¡ç†
- **æ•°ç»„å¤åˆ¶**: å…³é”®æ•°æ®ä½¿ç”¨duplicate()é¿å…å¼•ç”¨é—®é¢˜
- **ä¸´æ—¶å¯¹è±¡**: åˆ†æè¿‡ç¨‹ä¸­çš„ä¸´æ—¶å¯¹è±¡åŠæ—¶é‡Šæ”¾

## ğŸ¯ æ‰©å±•æ€§è®¾è®¡

### æ–°ç‰Œå‹æ”¯æŒ
1. åœ¨`HandTypeEnums`ä¸­æ·»åŠ æ–°æšä¸¾å€¼
2. åœ¨`PokerHandAnalyzer`ä¸­æ·»åŠ å¯¹åº”è¯„ä¼°å™¨
3. åœ¨`PreciseScoreCalculator`ä¸­æ·»åŠ è®¡åˆ†è§„åˆ™
4. æ›´æ–°`LEVEL_MULTIPLIERS`é…ç½®

### è‡ªå®šä¹‰è®¡åˆ†è§„åˆ™
```gdscript
# ç»§æ‰¿PreciseScoreCalculatorå®ç°è‡ªå®šä¹‰è®¡åˆ†
class CustomScoreCalculator extends PreciseScoreCalculator:
    static func _calculate_value_score(hand_result: HandResult) -> int:
        # è‡ªå®šä¹‰è®¡åˆ†é€»è¾‘
        return custom_calculation(hand_result)
```

### æ’ä»¶åŒ–è¯„ä¼°å™¨
```gdscript
# æ³¨å†Œè‡ªå®šä¹‰è¯„ä¼°å™¨
PokerHandAnalyzer.register_evaluator("è‡ªå®šä¹‰ç‰Œå‹", custom_evaluator_function)
```

## ğŸ“ˆ ç³»ç»Ÿç›‘æ§

### æ€§èƒ½æŒ‡æ ‡
- **åˆ†æè€—æ—¶**: æ¯æ¬¡åˆ†æçš„æ—¶é—´æ¶ˆè€—
- **ç»„åˆæµ‹è¯•æ•°**: æµ‹è¯•çš„å¡ç‰Œç»„åˆæ•°é‡
- **å†…å­˜ä½¿ç”¨**: åˆ†æè¿‡ç¨‹ä¸­çš„å†…å­˜å ç”¨
- **ç¼“å­˜å‘½ä¸­ç‡**: ç¼“å­˜ç³»ç»Ÿçš„æ•ˆç‡

### è°ƒè¯•ä¿¡æ¯
- **è¯¦ç»†å…¬å¼**: å®Œæ•´çš„è®¡åˆ†å…¬å¼å’Œæ­¥éª¤
- **å¡ç‰Œè¿½è¸ª**: æ¯å¼ å¡ç‰Œåœ¨åˆ†æä¸­çš„ä½œç”¨
- **ç®—æ³•é€‰æ‹©**: ä½¿ç”¨çš„åˆ†æç®—æ³•ç±»å‹
- **é”™è¯¯å¤„ç†**: å¼‚å¸¸æƒ…å†µçš„å¤„ç†è®°å½•

## ğŸ” å…·ä½“ç‰Œå‹è¯†åˆ«ç®—æ³•

### äº”æ¡ (FIVE_KIND)
```gdscript
static func _evaluate_five_kind(card_data: Dictionary) -> HandResult:
    var value_counts = card_data.value_counts
    for value in value_counts:
        if value_counts[value] >= 5:
            var result = HandResult.new()
            result.set_hand_type_info(HandType.FIVE_KIND, "äº”æ¡", "äº”æ¡: %s" % _value_to_string(value))
            result.set_core_values(value)
            return result
    return null
```

### çš‡å®¶åŒèŠ±é¡º (ROYAL_FLUSH)
```gdscript
static func _evaluate_royal_flush(card_data: Dictionary) -> HandResult:
    var suits = card_data.suits
    var values = card_data.values

    # æ£€æŸ¥æ˜¯å¦æœ‰A-K-Q-J-10åŒèŠ±
    var royal_values = [14, 13, 12, 11, 10]  # A, K, Q, J, 10

    for suit in suits:
        if suits[suit].size() >= 5:
            var suit_values = suits[suit]
            var has_royal = true
            for royal_val in royal_values:
                if not suit_values.has(royal_val):
                    has_royal = false
                    break

            if has_royal:
                var result = HandResult.new()
                result.set_hand_type_info(HandType.ROYAL_FLUSH, "çš‡å®¶åŒèŠ±é¡º", "çš‡å®¶åŒèŠ±é¡º: %s" % _suit_to_string(suit))
                result.set_core_values(14)  # Aä¸ºæœ€é«˜ç‰Œ
                return result
    return null
```

### åŒèŠ±é¡º (STRAIGHT_FLUSH)
```gdscript
static func _evaluate_straight_flush(card_data: Dictionary) -> HandResult:
    var suits = card_data.suits

    for suit in suits:
        if suits[suit].size() >= 5:
            var suit_values = suits[suit]
            suit_values.sort()

            var straight_info = _find_straight_in_values(suit_values)
            if straight_info.is_straight:
                var result = HandResult.new()
                result.set_hand_type_info(HandType.STRAIGHT_FLUSH, "åŒèŠ±é¡º",
                    "åŒèŠ±é¡º: %s %s" % [_value_to_string(straight_info.high_card), _suit_to_string(suit)])
                result.set_core_values(straight_info.high_card)
                return result
    return null
```

### å››æ¡ (FOUR_KIND)
```gdscript
static func _evaluate_four_kind(card_data: Dictionary) -> HandResult:
    var value_counts = card_data.value_counts
    var values = card_data.values

    for value in value_counts:
        if value_counts[value] >= 4:
            # æ‰¾åˆ°è¸¢è„šç‰Œ
            var kickers = []
            for v in values:
                if v != value and kickers.size() < 1:
                    kickers.append(v)

            var result = HandResult.new()
            result.set_hand_type_info(HandType.FOUR_KIND, "å››æ¡", "å››æ¡: %s" % _value_to_string(value))
            result.set_core_values(value)
            result.kickers = kickers
            return result
    return null
```

### è‘«èŠ¦ (FULL_HOUSE)
```gdscript
static func _evaluate_full_house(card_data: Dictionary) -> HandResult:
    var value_counts = card_data.value_counts
    var three_kind_value = -1
    var pair_value = -1

    # æ‰¾ä¸‰æ¡
    for value in value_counts:
        if value_counts[value] >= 3:
            three_kind_value = value
            break

    # æ‰¾å¯¹å­ï¼ˆä¸èƒ½ä¸ä¸‰æ¡ç›¸åŒï¼‰
    for value in value_counts:
        if value != three_kind_value and value_counts[value] >= 2:
            pair_value = value
            break

    if three_kind_value != -1 and pair_value != -1:
        var result = HandResult.new()
        result.set_hand_type_info(HandType.FULL_HOUSE, "è‘«èŠ¦",
            "è‘«èŠ¦: %så¸¦%s" % [_value_to_string(three_kind_value), _value_to_string(pair_value)])
        result.set_core_values(three_kind_value, pair_value)
        return result

    return null
```

## âš ï¸ é”™è¯¯å¤„ç†æœºåˆ¶

### è¾“å…¥éªŒè¯
```gdscript
# å¡ç‰Œæ•°é‡æ£€æŸ¥
if cards.is_empty():
    return HandResult.create_empty()

# å¡ç‰Œæ•°æ®å®Œæ•´æ€§æ£€æŸ¥
for card in cards:
    if not card or not card.has_method("get"):
        push_error("æ— æ•ˆçš„å¡ç‰Œæ•°æ®")
        return HandResult.create_empty()
```

### å¼‚å¸¸æƒ…å†µå¤„ç†
```gdscript
# è¶…å¤§æ•°æ®é›†ä¿æŠ¤
if cards.size() > 20:
    push_warning("å¡ç‰Œæ•°é‡è¿‡å¤š(%då¼ )ï¼Œä½¿ç”¨å¯å‘å¼ç®—æ³•" % cards.size())
    return _find_best_combination_heuristic(cards)

# å†…å­˜ä¿æŠ¤
if combinations_count > 10000:
    push_warning("ç»„åˆæ•°é‡è¿‡å¤šï¼Œé™åˆ¶åˆ†æèŒƒå›´")
    return _limited_analysis(cards)
```

### æ€§èƒ½ç›‘æ§
```gdscript
# åˆ†ææ—¶é—´ç›‘æ§
var start_time = Time.get_ticks_msec()
var result = _perform_analysis(cards)
var analysis_time = Time.get_ticks_msec() - start_time

if analysis_time > 100:  # è¶…è¿‡100ms
    push_warning("ç‰Œå‹åˆ†æè€—æ—¶è¿‡é•¿: %dms" % analysis_time)
```

## ğŸ§ª æµ‹è¯•æ¡†æ¶

### å•å…ƒæµ‹è¯•
```gdscript
# æµ‹è¯•ç‰¹å®šç‰Œå‹è¯†åˆ«
func test_pair_recognition():
    var cards = [create_card("S", 7), create_card("H", 7), create_card("D", 3),
                 create_card("C", 9), create_card("S", 2)]
    var result = HandTypeSystemV2.analyze_hand_type(cards)
    assert(result.hand_type == HandTypeEnums.HandType.PAIR)
    assert(result.primary_value == 7)
```

### æ€§èƒ½æµ‹è¯•
```gdscript
# æ‰¹é‡æ€§èƒ½æµ‹è¯•
func performance_test_batch():
    var test_cases = generate_random_hands(1000)
    var start_time = Time.get_ticks_msec()

    for cards in test_cases:
        HandTypeSystemV2.analyze_hand_type(cards)

    var total_time = Time.get_ticks_msec() - start_time
    print("æ‰¹é‡æµ‹è¯•è€—æ—¶: %dms, å¹³å‡: %.2fms/æ‰‹" % [total_time, float(total_time) / 1000])
```

### è¾¹ç•Œæµ‹è¯•
```gdscript
# è¾¹ç•Œæ¡ä»¶æµ‹è¯•
func test_edge_cases():
    # ç©ºæ•°ç»„
    var empty_result = HandTypeSystemV2.analyze_hand_type([])
    assert(not empty_result.is_valid())

    # å•å¼ ç‰Œ
    var single_card = [create_card("S", 14)]
    var single_result = HandTypeSystemV2.analyze_hand_type(single_card)
    assert(single_result.hand_type == HandTypeEnums.HandType.HIGH_CARD)

    # å¤§é‡å¡ç‰Œ
    var many_cards = generate_cards(15)
    var many_result = HandTypeSystemV2.analyze_hand_type(many_cards)
    assert(many_result.is_valid())
```

## ğŸ“š é…ç½®æ–‡ä»¶

### åŸºç¡€åˆ†å€¼é…ç½®
```gdscript
# HandTypeEnums.gd
const BASE_SCORES = {
    HandType.HIGH_CARD: 1,
    HandType.PAIR: 2,
    HandType.TWO_PAIR: 3,
    HandType.THREE_KIND: 5,
    HandType.STRAIGHT: 8,
    HandType.FLUSH: 13,
    HandType.FULL_HOUSE: 21,
    HandType.FOUR_KIND: 34,
    HandType.STRAIGHT_FLUSH: 55,
    HandType.ROYAL_FLUSH: 89,
    HandType.FIVE_KIND: 144
}
```

### ç­‰çº§å€ç‡é…ç½®
```gdscript
# åŠ¨æ€å€ç‡é…ç½® [åŸºç¡€å€ç‡, æ¯çº§å¢é‡]
const LEVEL_MULTIPLIERS = {
    HandType.HIGH_CARD: [1.0, 0.2],      # LV1: 1.0x â†’ LV5: 1.8x
    HandType.PAIR: [1.5, 0.3],           # LV1: 1.5x â†’ LV5: 2.7x
    HandType.TWO_PAIR: [2.0, 0.4],       # LV1: 2.0x â†’ LV5: 3.6x
    HandType.THREE_KIND: [3.0, 0.6],     # LV1: 3.0x â†’ LV5: 5.4x
    HandType.STRAIGHT: [4.0, 0.8],       # LV1: 4.0x â†’ LV5: 7.2x
    HandType.FLUSH: [5.0, 1.0],          # LV1: 5.0x â†’ LV5: 9.0x
    HandType.FULL_HOUSE: [7.0, 1.4],     # LV1: 7.0x â†’ LV5: 12.6x
    HandType.FOUR_KIND: [10.0, 2.0],     # LV1: 10.0x â†’ LV5: 18.0x
    HandType.STRAIGHT_FLUSH: [15.0, 3.0], # LV1: 15.0x â†’ LV5: 27.0x
    HandType.ROYAL_FLUSH: [25.0, 5.0],   # LV1: 25.0x â†’ LV5: 45.0x
    HandType.FIVE_KIND: [50.0, 10.0]     # LV1: 50.0x â†’ LV5: 90.0x
}
```

## ğŸ”® æœªæ¥æ‰©å±•

### è®¡åˆ’åŠŸèƒ½
1. **AIè¾…åŠ©åˆ†æ**: æœºå™¨å­¦ä¹ ä¼˜åŒ–ç‰Œå‹è¯†åˆ«å‡†ç¡®æ€§
2. **å¹¶è¡Œå¤„ç†**: å¤šçº¿ç¨‹å¤„ç†å¤§é‡å¡ç‰Œç»„åˆ
3. **ç¼“å­˜ç³»ç»Ÿ**: æ™ºèƒ½ç¼“å­˜å¸¸è§ç‰Œå‹ç»„åˆ
4. **ç»Ÿè®¡åˆ†æ**: ç‰Œå‹å‡ºç°é¢‘ç‡å’Œæ¦‚ç‡åˆ†æ
5. **è‡ªå®šä¹‰è§„åˆ™**: æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰ç‰Œå‹å’Œè®¡åˆ†è§„åˆ™

### æ€§èƒ½ä¼˜åŒ–
1. **é¢„è®¡ç®—è¡¨**: é¢„è®¡ç®—å¸¸è§ç»„åˆçš„ç»“æœ
2. **ä½è¿ç®—ä¼˜åŒ–**: ä½¿ç”¨ä½è¿ç®—åŠ é€ŸèŠ±è‰²å’Œæ•°å€¼æ£€æŸ¥
3. **å†…å­˜æ± **: å¤ç”¨ä¸´æ—¶å¯¹è±¡å‡å°‘GCå‹åŠ›
4. **SIMDæŒ‡ä»¤**: åˆ©ç”¨SIMDæŒ‡ä»¤å¹¶è¡Œå¤„ç†æ•°æ®

---

*æœ¬æ–‡æ¡£åŸºäºå¥¥æœ¯å­¦é™¢æ‰‘å…‹V2.1ç‰Œå‹è¯†åˆ«ç³»ç»Ÿï¼Œè¯¦ç»†æè¿°äº†ç³»ç»Ÿçš„æ¶æ„è®¾è®¡ã€æ ¸å¿ƒç®—æ³•ã€æ•°æ®ç»“æ„ã€é”™è¯¯å¤„ç†ã€æµ‹è¯•æ¡†æ¶å’Œé…ç½®ç®¡ç†ã€‚ç³»ç»Ÿé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒçµæ´»æ‰©å±•å’Œè‡ªå®šä¹‰é…ç½®ã€‚*
