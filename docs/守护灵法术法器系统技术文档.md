# ğŸ­ å¥¥æœ¯å­¦é™¢æ‰‘å…‹ - å®ˆæŠ¤çµã€æ³•æœ¯ä¸æ³•å™¨ç³»ç»ŸæŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

å¥¥æœ¯å­¦é™¢æ‰‘å…‹çš„å®ˆæŠ¤çµã€æ³•æœ¯ä¸æ³•å™¨ç³»ç»Ÿæ˜¯æ¸¸æˆçš„æ ¸å¿ƒå¢å¼ºæœºåˆ¶ï¼Œä¸ºç©å®¶æä¾›å¤šæ ·åŒ–çš„ç­–ç•¥é€‰æ‹©å’Œæ¸¸æˆä½“éªŒã€‚è¿™ä¸‰ä¸ªç³»ç»Ÿé€šè¿‡**æ•°æ®é©±åŠ¨è®¾è®¡**å’Œ**æ¨¡å—åŒ–æ¶æ„**ï¼Œå®ç°äº†çµæ´»çš„æ•ˆæœé…ç½®å’Œæ‰©å±•èƒ½åŠ›ã€‚

### ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
èƒ½åŠ›ç³»ç»Ÿ (Abilities System)
â”œâ”€â”€ å®ˆæŠ¤çµç³»ç»Ÿ (Joker System)
â”‚   â”œâ”€â”€ JokerData.gd (æ•°æ®æ¨¡å‹)
â”‚   â”œâ”€â”€ JokerView.gd (è§†å›¾ç»„ä»¶)
â”‚   â””â”€â”€ JokerManager.gd (ç®¡ç†å™¨)
â”œâ”€â”€ æ³•æœ¯ç³»ç»Ÿ (Spell System)
â”‚   â”œâ”€â”€ SpellData.gd (æ•°æ®æ¨¡å‹)
â”‚   â”œâ”€â”€ SpellView.gd (è§†å›¾ç»„ä»¶)
â”‚   â””â”€â”€ SpellManager.gd (ç®¡ç†å™¨)
â””â”€â”€ æ³•å™¨ç³»ç»Ÿ (Artifact System)
    â”œâ”€â”€ ArtifactData.gd (æ•°æ®æ¨¡å‹)
    â”œâ”€â”€ ArtifactItem.gd (è§†å›¾ç»„ä»¶)
    â””â”€â”€ DiscoveryManager.gd (ç®¡ç†å™¨)
```

### ğŸ® æ ¸å¿ƒç‰¹æ€§

- **æ•°æ®é©±åŠ¨é…ç½®**: æ‰€æœ‰èƒ½åŠ›é€šè¿‡`.tres`æ–‡ä»¶é…ç½®ï¼Œæ”¯æŒçƒ­æ›´æ–°
- **æ•ˆæœè§¦å‘ç³»ç»Ÿ**: åŸºäºæ—¶æœºçš„çµæ´»è§¦å‘æœºåˆ¶
- **ç¨€æœ‰åº¦ç³»ç»Ÿ**: å››çº§ç¨€æœ‰åº¦ï¼ˆæ™®é€šã€ç¨€æœ‰ã€å²è¯—ã€ä¼ è¯´ï¼‰
- **å……èƒ½æœºåˆ¶**: æ³•æœ¯æ”¯æŒå¤šæ¬¡ä½¿ç”¨å’Œå……èƒ½ç®¡ç†
- **UIé›†æˆ**: å®Œæ•´çš„è§†å›¾ç»„ä»¶å’Œäº¤äº’ç³»ç»Ÿ

---

## ğŸ­ å®ˆæŠ¤çµç³»ç»Ÿ (Joker System)

### æ•°æ®æ¨¡å‹ - JokerData

å®ˆæŠ¤çµæ˜¯æä¾›è¢«åŠ¨æ•ˆæœçš„æ°¸ä¹…æ€§å¢å¼ºï¼Œåœ¨ç‰¹å®šæ—¶æœºè‡ªåŠ¨è§¦å‘ã€‚

<augment_code_snippet path="cs/å¡ç‰Œç³»ç»Ÿ/æ•°æ®/JokerData.gd" mode="EXCERPT">
````gdscript
class_name JokerData
extends Resource

# å®ˆæŠ¤çµåŸºæœ¬å±æ€§ï¼ˆç¬¦åˆv1.6è§„èŒƒï¼‰
@export var id: String = ""               # ä¾‹å¦‚ "JOKER_TIME_WIZARD"
@export var name: String = ""             # ä¾‹å¦‚ "æ—¶é—´æœ¯å£«"
@export var description: String = ""      # ç”¨äºUIæ˜¾ç¤ºçš„æè¿°æ–‡æœ¬
@export var cost: int = 0                 # è´­ä¹°è´¹ç”¨

# æ•ˆæœå±æ€§ï¼ˆç¬¦åˆv1.6è§„èŒƒï¼‰
@export var effect_type: String = ""      # ä¾‹å¦‚ "ADD_XP_PER_PAIR"
@export var effect_value = null           # æ•ˆæœå‚æ•°

# å®ˆæŠ¤çµç‰¹æœ‰å±æ€§ï¼ˆç¬¦åˆv1.6è§„èŒƒï¼‰
@export var trigger_timing: int = GlobalEnums.EffectTriggerTiming.ON_SCORE_CALCULATION # è§¦å‘æ—¶æœº
````
</augment_code_snippet>

### è§¦å‘æ—¶æœº

å®ˆæŠ¤çµæ”¯æŒå¤šç§è§¦å‘æ—¶æœºï¼š

| è§¦å‘æ—¶æœº | æšä¸¾å€¼ | æè¿° | ä½¿ç”¨åœºæ™¯ |
|----------|--------|------|----------|
| å›åˆå¼€å§‹ | ON_TURN_START | æ¯å›åˆå¼€å§‹æ—¶è§¦å‘ | èµ„æºç”Ÿæˆã€çŠ¶æ€é‡ç½® |
| æ‰“ç‰Œå‰ | BEFORE_PLAY | æ‰“å‡ºå¡ç‰Œå‰è§¦å‘ | å¡ç‰Œå¼ºåŒ–ã€é¢„å¤„ç† |
| å¾—åˆ†è®¡ç®— | ON_SCORE_CALCULATION | è®¡ç®—å¾—åˆ†æ—¶è§¦å‘ | åˆ†æ•°åŠ æˆã€å€ç‡ä¿®æ”¹ |
| å›åˆç»“æŸ | ON_TURN_END | æ¯å›åˆç»“æŸæ—¶è§¦å‘ | æ¸…ç†æ•ˆæœã€å»¶è¿Ÿè§¦å‘ |
| æŠ½ç‰Œæ—¶ | ON_DRAW | æŠ½å–å¡ç‰Œæ—¶è§¦å‘ | æŠ½ç‰Œå¢å¼ºã€å¡ç‰Œä¿®æ”¹ |
| å¼ƒç‰Œæ—¶ | ON_DISCARD | å¼ƒç½®å¡ç‰Œæ—¶è§¦å‘ | èµ„æºå›æ”¶ã€ç‰¹æ®Šæ•ˆæœ |

### ç¤ºä¾‹é…ç½®

<augment_code_snippet path="assets/data/jokers/pair_master.tres" mode="EXCERPT">
````tres
[gd_resource type="Resource" script_class="JokerData" load_steps=2 format=3]

[resource]
script = ExtResource("1_sjtcv")
item_id = "JOKER_PAIR_MASTER"
item_name = "å¯¹å­å¤§å¸ˆ"
description_text = "æ‰“å‡ºå¯¹å­æ—¶ï¼ŒåŸºç¡€åˆ†å€¼æé«˜30%ã€‚"
rarity_type = 1
purchase_cost = 35
effect_type_id = "CARD_TYPE_MULTIPLIER_PAIR"
effect_value_param = 0.3
trigger_event_timing = 3
````
</augment_code_snippet>

### ç®¡ç†å™¨ - JokerManager

<augment_code_snippet path="cs/å¡ç‰Œç³»ç»Ÿ/æ•°æ®/ç®¡ç†å™¨/JokerManager.gd" mode="EXCERPT">
````gdscript
class_name JokerManager
extends Node

# åˆå§‹åŒ–å®ˆæŠ¤çµåŒºåŸŸ
func initialize_jokers():
    joker_container.set_meta("max_jokers", GameManager.joker_slots)
    update_joker_count()

# æ›´æ–°å®ˆæŠ¤çµæ˜¾ç¤º
func update_joker_display():
    # æ¸…ç©ºå½“å‰å®ˆæŠ¤çµåŒºåŸŸ
    for child in joker_container.get_children():
        child.queue_free()
    
    # åˆ›å»ºå¹¶æ”¾ç½®å®ˆæŠ¤çµ
    for i in range(GameManager.active_jokers.size()):
        var joker_data = GameManager.active_jokers[i]
        var joker_instance = joker_card_scene.instantiate()
        joker_container.add_child(joker_instance)
        joker_instance.setup(joker_data)
````
</augment_code_snippet>

---

## ğŸ”® æ³•æœ¯ç³»ç»Ÿ (Spell System)

### æ•°æ®æ¨¡å‹ - SpellData

æ³•æœ¯æ˜¯å¯ä¸»åŠ¨ä½¿ç”¨çš„èƒ½åŠ›ï¼Œåˆ†ä¸ºç¬å‘æ³•æœ¯å’ŒæŠ€èƒ½åŒºæ³•æœ¯ä¸¤ç§ç±»å‹ã€‚

<augment_code_snippet path="cs/å¡ç‰Œç³»ç»Ÿ/æ•°æ®/SpellData.gd" mode="EXCERPT">
````gdscript
class_name SpellData
extends Resource

# æ³•æœ¯åŸºæœ¬å±æ€§ï¼ˆç¬¦åˆv1.6è§„èŒƒï¼‰
@export var id: String = ""               # ä¾‹å¦‚ "SPELL_FLASH_OF_INSIGHT"
@export var name: String = ""             # ä¾‹å¦‚ "çµå…‰ä¸€é—ª"
@export var description: String = ""      # ç”¨äºUIæ˜¾ç¤ºçš„æè¿°æ–‡æœ¬
@export var rarity: int = GlobalEnums.Rarity.COMMON # ç¨€æœ‰åº¦
@export var cost: int = 0                 # è´­ä¹°è´¹ç”¨

# æ•ˆæœå±æ€§ï¼ˆç¬¦åˆv1.6è§„èŒƒï¼‰
@export var effect_type: String = ""      # ä¾‹å¦‚ "DOUBLE_SCORE"
@export var effect_value = null           # æ•ˆæœå‚æ•°

# æ³•æœ¯ç‰¹æœ‰å±æ€§ï¼ˆç¬¦åˆv1.6è§„èŒƒï¼‰
@export var spell_type: int = GlobalEnums.SpellType.INSTANT_USE # æ³•æœ¯ç±»å‹
@export var charges: int = 1              # å½“å‰ä½¿ç”¨æ¬¡æ•°/å……èƒ½
````
</augment_code_snippet>

### æ³•æœ¯ç±»å‹

| ç±»å‹ | æšä¸¾å€¼ | æè¿° | ç‰¹ç‚¹ |
|------|--------|------|------|
| ç¬å‘æ³•æœ¯ | INSTANT_USE | ç«‹å³ä½¿ç”¨å¹¶æ¶ˆè€— | ä¸€æ¬¡æ€§æ•ˆæœï¼Œä½¿ç”¨åæ¶ˆå¤± |
| æŠ€èƒ½åŒºæ³•æœ¯ | ACTIVE_SKILL | æ”¾ç½®åœ¨æŠ€èƒ½åŒº | å¯å¤šæ¬¡ä½¿ç”¨ï¼Œæœ‰å……èƒ½é™åˆ¶ |

### å……èƒ½æœºåˆ¶

<augment_code_snippet path="cs/å¡ç‰Œç³»ç»Ÿ/æ•°æ®/SpellData.gd" mode="EXCERPT">
````gdscript
# ä½¿ç”¨æ³•æœ¯ï¼Œæ¶ˆè€—ä¸€æ¬¡å……èƒ½
func use() -> bool:
    if charges <= 0:
        return false
    
    charges -= 1
    return true

# å¢åŠ å……èƒ½
func add_charge(amount: int = 1) -> void:
    charges += amount
````
</augment_code_snippet>

### ç¤ºä¾‹é…ç½®

<augment_code_snippet path="assets/data/spells/flash_of_insight.tres" mode="EXCERPT">
````tres
[gd_resource type="Resource" script_class="SpellData" load_steps=2 format=3]

[resource]
script = ExtResource("1_e74wk")
id = "SPELL_FLASH_OF_INSIGHT"
name = "çµæ„Ÿé—ªç°"
description = "ç«‹å³æŠ½å–3å¼ ç‰Œã€‚"
rarity = 1
cost = 25
effect_type = "DRAW_CARDS"
effect_value = 3
spell_type = 0
charges = 1
````
</augment_code_snippet>

---

## âš”ï¸ æ³•å™¨ç³»ç»Ÿ (Artifact System)

### æ•°æ®æ¨¡å‹ - ArtifactData

æ³•å™¨æ˜¯æä¾›æŒç»­æ€§è¢«åŠ¨æ•ˆæœçš„è£…å¤‡ï¼Œé€šå¸¸å½±å“æ¸¸æˆçš„åŸºç¡€æœºåˆ¶ã€‚

<augment_code_snippet path="cs/å¡ç‰Œç³»ç»Ÿ/æ•°æ®/ArtifactData.gd" mode="EXCERPT">
````gdscript
class_name ArtifactData
extends Resource

# æ³•å™¨åŸºæœ¬å±æ€§ï¼ˆç¬¦åˆv1.6è§„èŒƒï¼‰
@export var id: String = ""               # ä¾‹å¦‚ "ARTIFACT_MAGIC_CRYSTAL"
@export var name: String = ""             # ä¾‹å¦‚ "é­”åŠ›æ°´æ™¶"
@export var description: String = ""      # ç”¨äºUIæ˜¾ç¤ºçš„æè¿°æ–‡æœ¬
@export var rarity: int = GlobalEnums.Rarity.COMMON # ç¨€æœ‰åº¦
@export var cost: int = 0                 # è´­ä¹°è´¹ç”¨

# æ•ˆæœå±æ€§ï¼ˆç¬¦åˆv1.6è§„èŒƒï¼‰
@export var effect_type: String = ""      # ä¾‹å¦‚ "LORE_POINTS_PERCENT_BONUS"
@export var effect_value = null           # æ•ˆæœå‚æ•°ï¼Œå¦‚ 0.05 (5%) æˆ– 1 (å¢åŠ 1ç‚¹)
````
</augment_code_snippet>

### ç¤ºä¾‹é…ç½®

<augment_code_snippet path="assets/data/artifacts/apprentice_notes.tres" mode="EXCERPT">
````tres
[gd_resource type="Resource" script_class="ArtifactData" load_steps=2 format=3]

[resource]
script = ExtResource("1_data")
id = "ARTIFACT_APPRENTICE_NOTES"
name = "å­¦å¾’ç¬”è®°"
description = "æ¯è·å¾—ä¸€å¼ ç‰Œï¼Œé¢å¤–è·å¾—5%ä¼ è¯´ç‚¹æ•°ã€‚"
rarity = 0
cost = 25
effect_type = "LORE_POINTS_PERCENT_BONUS"
effect_value = 0.05
````
</augment_code_snippet>

### ç®¡ç†å™¨ - DiscoveryManager

<augment_code_snippet path="cs/å¡ç‰Œç³»ç»Ÿ/æ•°æ®/ç®¡ç†å™¨/DiscoveryManager.gd" mode="EXCERPT">
````gdscript
# åˆå§‹åŒ–ä¼ å¥‡æ³•å™¨åŒºåŸŸ
func initialize_artifacts():
    # è®¾ç½®å®¹å™¨çš„å±æ€§ï¼Œä¸ºåç»­åŠ¨æ€æ·»åŠ æ³•å™¨åšå‡†å¤‡
    artifact_container.set_meta("max_artifacts", GameManager.max_artifacts)  # æœ€å¤šå¯æ·»åŠ 6ä¸ªæ³•å™¨
    artifact_container.set_meta("artifact_size", Vector2(135, 180))  # æ³•å™¨æ ‡å‡†å°ºå¯¸
    
    # æ›´æ–°è®¡æ•°å™¨æ˜¾ç¤º
    update_artifact_count()

# æ·»åŠ æ–°çš„ä¼ å¥‡æ³•å™¨
func add_artifact(artifact_data):
    # ä½¿ç”¨GameManageræ·»åŠ ä¼ å¥‡æ³•å™¨
    if not GameManager.add_artifact(artifact_data):
        print("è­¦å‘Šï¼šå·²è¾¾åˆ°æœ€å¤§ä¼ å¥‡æ³•å™¨æ•°é‡")
        return
````
</augment_code_snippet>

---

## ğŸ¯ æ•ˆæœç³»ç»Ÿ

### æ•ˆæœç±»å‹

ç³»ç»Ÿæ”¯æŒå¤šç§æ•ˆæœç±»å‹ï¼Œé€šè¿‡å­—ç¬¦ä¸²IDè¿›è¡Œæ ‡è¯†ï¼š

| æ•ˆæœç±»å‹ | ID | æè¿° | é€‚ç”¨ç³»ç»Ÿ |
|----------|----|----- |----------|
| åˆ†æ•°ç™¾åˆ†æ¯”åŠ æˆ | SCORE_PERCENT_BONUS | æœ€ç»ˆåˆ†æ•°å¢åŠ X% | å®ˆæŠ¤çµã€æ³•å™¨ |
| ä¼ è¯´ç‚¹æ•°åŠ æˆ | LORE_POINTS_PERCENT_BONUS | ä¼ è¯´ç‚¹æ•°è·å¾—å¢åŠ X% | æ³•å™¨ |
| æŠ½ç‰Œæ•ˆæœ | DRAW_CARDS | ç«‹å³æŠ½å–Xå¼ ç‰Œ | æ³•æœ¯ |
| ç‰Œå‹å€ç‡åŠ æˆ | CARD_TYPE_MULTIPLIER_X | ç‰¹å®šç‰Œå‹åˆ†æ•°å¢åŠ X% | å®ˆæŠ¤çµ |
| é‡‘å¸è·å¾— | GOLD_PER_CARD | æ¯å¼ ç‰Œé¢å¤–è·å¾—Xé‡‘å¸ | å®ˆæŠ¤çµ |
| åˆ†æ•°ç¿»å€ | DOUBLE_SCORE | æœ¬å›åˆåˆ†æ•°ç¿»å€ | æ³•æœ¯ |

### æ•ˆæœè§¦å‘æµç¨‹

```
1. äº‹ä»¶å‘ç”Ÿ (å¦‚ï¼šæ‰“å‡ºå¡ç‰Œ)
    â†“
2. æ£€æŸ¥è§¦å‘æ—¶æœºåŒ¹é…çš„èƒ½åŠ›
    â†“
3. æŒ‰ä¼˜å…ˆçº§æ‰§è¡Œæ•ˆæœ
    â†“
4. æ›´æ–°æ¸¸æˆçŠ¶æ€
    â†“
5. åˆ·æ–°UIæ˜¾ç¤º
```

---

## ğŸ® æ¸¸æˆé›†æˆ

### GameManageré›†æˆ

<augment_code_snippet path="cs/Global/GameManager.gd" mode="EXCERPT">
````gdscript
# ===== ç©å®¶èµ„æºï¼ˆç¬¦åˆv1.6è§„èŒƒï¼‰=====
var equipped_artifacts: Array[ArtifactData] = []  # è£…å¤‡çš„æ³•å™¨
var spell_inventory: Array[SpellData] = []        # æŒæœ‰çš„æ³•æœ¯
var active_jokers: Array[JokerData] = []          # æ¿€æ´»çš„å®ˆæŠ¤çµ

# æ·»åŠ æ³•æœ¯
func add_spell(spell: SpellData):
    # æ£€æŸ¥æ˜¯å¦å·²æœ‰åŒåæ³•æœ¯ï¼Œå¦‚æœæœ‰åˆ™å¢åŠ å……èƒ½
    for existing_spell in spell_inventory:
        if existing_spell.id == spell.id:
            existing_spell.charges += spell.charges
            return
    
    # å¦‚æœæ²¡æœ‰åŒåæ³•æœ¯ï¼Œåˆ™æ·»åŠ æ–°æ³•æœ¯
    spell_inventory.append(spell)

# æ¿€æ´»å®ˆæŠ¤çµ
func activate_joker(joker: JokerData, old_joker_index: int = -1):
    if old_joker_index >= 0 and old_joker_index < active_jokers.size():
        # æ›¿æ¢ç°æœ‰å®ˆæŠ¤çµ
        active_jokers[old_joker_index] = joker
    else:
        # æ·»åŠ æ–°å®ˆæŠ¤çµ
        active_jokers.append(joker)
````
</augment_code_snippet>

### ç¨€æœ‰åº¦ç³»ç»Ÿ

<augment_code_snippet path="cs/Global/GlobalEnums.gd" mode="EXCERPT">
````gdscript
# ç¨€æœ‰åº¦æšä¸¾
enum Rarity {
    COMMON,      # æ™®é€š - ç™½è‰²
    RARE,        # ç¨€æœ‰ - è“è‰²
    EPIC,        # å²è¯— - ç´«è‰²
    LEGENDARY    # ä¼ è¯´ - æ©™è‰²
}
````
</augment_code_snippet>

---

## ğŸ“Š æ•°æ®é…ç½®

### ç›®å½•ç»“æ„

```
assets/data/
â”œâ”€â”€ artifacts/          # æ³•å™¨é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ apprentice_notes.tres
â”œâ”€â”€ spells/            # æ³•æœ¯é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ flash_of_insight.tres
â”œâ”€â”€ jokers/            # å®ˆæŠ¤çµé…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ pair_master.tres
â””â”€â”€ game_config.tres   # å…¨å±€é…ç½®
```

### é…ç½®ç¤ºä¾‹

æ¯ä¸ªèƒ½åŠ›éƒ½é€šè¿‡ç‹¬ç«‹çš„`.tres`æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œæ”¯æŒï¼š
- åŸºç¡€å±æ€§ï¼ˆIDã€åç§°ã€æè¿°ã€ç¨€æœ‰åº¦ã€ä»·æ ¼ï¼‰
- æ•ˆæœå±æ€§ï¼ˆæ•ˆæœç±»å‹ã€æ•ˆæœæ•°å€¼ï¼‰
- ç‰¹æ®Šå±æ€§ï¼ˆè§¦å‘æ—¶æœºã€å……èƒ½æ•°é‡ç­‰ï¼‰

---

## ğŸ”§ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°å®ˆæŠ¤çµ

1. åˆ›å»ºæ–°çš„`.tres`æ–‡ä»¶åœ¨`assets/data/jokers/`
2. é…ç½®åŸºç¡€å±æ€§å’Œæ•ˆæœ
3. åœ¨æ•ˆæœç³»ç»Ÿä¸­å®ç°å¯¹åº”çš„æ•ˆæœé€»è¾‘
4. æµ‹è¯•è§¦å‘æ—¶æœºå’Œæ•ˆæœæ•°å€¼

### æ·»åŠ æ–°æ³•æœ¯

1. åˆ›å»ºæ–°çš„`.tres`æ–‡ä»¶åœ¨`assets/data/spells/`
2. é€‰æ‹©æ³•æœ¯ç±»å‹ï¼ˆç¬å‘/æŠ€èƒ½åŒºï¼‰
3. é…ç½®å……èƒ½æœºåˆ¶ï¼ˆå¦‚é€‚ç”¨ï¼‰
4. å®ç°æ³•æœ¯æ•ˆæœé€»è¾‘

### æ·»åŠ æ–°æ³•å™¨

1. åˆ›å»ºæ–°çš„`.tres`æ–‡ä»¶åœ¨`assets/data/artifacts/`
2. é…ç½®è¢«åŠ¨æ•ˆæœ
3. ç¡®ä¿æ•ˆæœä¸æ¸¸æˆæœºåˆ¶å…¼å®¹
4. å¹³è¡¡æµ‹è¯•æ•ˆæœå¼ºåº¦

---

## ğŸ› ï¸ è§†å›¾ç»„ä»¶

### å®ˆæŠ¤çµè§†å›¾ - JokerView

å®ˆæŠ¤çµçš„UIç»„ä»¶è´Ÿè´£æ˜¾ç¤ºå®ˆæŠ¤çµä¿¡æ¯å’Œå¤„ç†äº¤äº’ï¼š

```gdscript
# JokerView.gd - å®ˆæŠ¤çµè§†å›¾ç»„ä»¶
class_name JokerView
extends Control

signal joker_clicked(joker_data)

var joker_data: JokerData
var joker_image: TextureRect
var joker_name_label: Label
var joker_description_label: Label

func setup(data: JokerData):
    joker_data = data
    update_display()

func update_display():
    if joker_data:
        joker_name_label.text = joker_data.name
        joker_description_label.text = joker_data.get_description()
        # æ ¹æ®ç¨€æœ‰åº¦è®¾ç½®è¾¹æ¡†é¢œè‰²
        set_rarity_border(joker_data.rarity)
```

### æ³•æœ¯è§†å›¾ - SpellView

æ³•æœ¯çš„UIç»„ä»¶æ”¯æŒå……èƒ½æ˜¾ç¤ºå’Œä½¿ç”¨äº¤äº’ï¼š

```gdscript
# SpellView.gd - æ³•æœ¯è§†å›¾ç»„ä»¶
class_name SpellView
extends Control

signal spell_used(spell_data)

var spell_data: SpellData
var charges_label: Label
var use_button: Button

func setup(data: SpellData):
    spell_data = data
    update_display()

    # è¿æ¥ä½¿ç”¨æŒ‰é’®
    use_button.pressed.connect(_on_use_pressed)

func update_display():
    if spell_data:
        charges_label.text = str(spell_data.charges)
        use_button.disabled = spell_data.charges <= 0

func _on_use_pressed():
    if spell_data.use():
        spell_used.emit(spell_data)
        update_display()
```

### æ³•å™¨è§†å›¾ - ArtifactItem

æ³•å™¨çš„UIç»„ä»¶æ˜¾ç¤ºæ³•å™¨ä¿¡æ¯å’Œæ•ˆæœï¼š

```gdscript
# ArtifactItem.gd - æ³•å™¨è§†å›¾ç»„ä»¶
class_name ArtifactItem
extends BaseItemView

var artifact_data: ArtifactData

func setup_item(data: ArtifactData):
    artifact_data = data
    item_name_label.text = data.name
    item_description_label.text = data.get_description()

    # è®¾ç½®ç¨€æœ‰åº¦æ ·å¼
    apply_rarity_style(data.rarity)
```

---

## ğŸ¨ UIé›†æˆ

### å®¹å™¨å¸ƒå±€

æ¸¸æˆä¸»ç•Œé¢ä¸­å„ç³»ç»Ÿçš„UIå¸ƒå±€ï¼š

```
MainGame Scene
â”œâ”€â”€ UIContainer
â”‚   â”œâ”€â”€ TopDock
â”‚   â”‚   â”œâ”€â”€ MagicDiscoveryPanel (é­”æ³•å‘ç°)
â”‚   â”‚   â””â”€â”€ ArtifactPanel (ä¼ å¥‡æ³•å™¨)
â”‚   â”œâ”€â”€ BottomDock
â”‚   â”‚   â”œâ”€â”€ HandContainer (æ‰‹ç‰ŒåŒº)
â”‚   â”‚   â””â”€â”€ JokerContainer (å®ˆæŠ¤çµåŒº)
â”‚   â””â”€â”€ SidePanel
â”‚       â””â”€â”€ SpellContainer (æ³•æœ¯æŠ€èƒ½åŒº)
```

### äº¤äº’æµç¨‹

1. **å®ˆæŠ¤çµäº¤äº’**ï¼š
   - ç‚¹å‡»å®ˆæŠ¤çµæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
   - æ‹–æ‹½æ›¿æ¢å®ˆæŠ¤çµä½ç½®
   - å³é”®èœå•è¿›è¡Œç®¡ç†æ“ä½œ

2. **æ³•æœ¯äº¤äº’**ï¼š
   - ç‚¹å‡»æ³•æœ¯å›¾æ ‡ä½¿ç”¨æ³•æœ¯
   - å……èƒ½æ•°é‡å®æ—¶æ˜¾ç¤º
   - å†·å´çŠ¶æ€è§†è§‰åé¦ˆ

3. **æ³•å™¨äº¤äº’**ï¼š
   - é¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦ç»†æ•ˆæœ
   - æ³•å™¨æ•ˆæœåœ¨æ¸¸æˆä¸­æŒç»­ç”Ÿæ•ˆ
   - æ³•å™¨æ•°é‡é™åˆ¶æç¤º

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å¯¹è±¡æ± ç®¡ç†

ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œç³»ç»Ÿä½¿ç”¨å¯¹è±¡æ± ç®¡ç†è§†å›¾ç»„ä»¶ï¼š

```gdscript
# ViewPool.gd - è§†å›¾å¯¹è±¡æ± 
class_name ViewPool
extends Node

var joker_view_pool: Array[JokerView] = []
var spell_view_pool: Array[SpellView] = []
var artifact_view_pool: Array[ArtifactItem] = []

func get_joker_view() -> JokerView:
    if joker_view_pool.size() > 0:
        return joker_view_pool.pop_back()
    else:
        return joker_view_scene.instantiate()

func return_joker_view(view: JokerView):
    view.reset()
    joker_view_pool.append(view)
```

### äº‹ä»¶ç³»ç»Ÿä¼˜åŒ–

ä½¿ç”¨ä¿¡å·ç³»ç»Ÿå‡å°‘è€¦åˆï¼Œæé«˜æ€§èƒ½ï¼š

```gdscript
# å…¨å±€äº‹ä»¶æ€»çº¿
signal ability_triggered(ability_type, ability_data, effect_result)
signal ui_update_required(system_type)
signal resource_changed(resource_type, old_value, new_value)
```

---

## ğŸ§ª æµ‹è¯•æ¡†æ¶

### å•å…ƒæµ‹è¯•

æ¯ä¸ªç³»ç»Ÿéƒ½æœ‰å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹ï¼š

```gdscript
# test_joker_system.gd
extends GutTest

func test_joker_trigger_timing():
    var joker = JokerData.new()
    joker.trigger_timing = GlobalEnums.EffectTriggerTiming.ON_SCORE_CALCULATION

    # æµ‹è¯•è§¦å‘æ—¶æœºåŒ¹é…
    assert_true(joker.should_trigger_on(GlobalEnums.EffectTriggerTiming.ON_SCORE_CALCULATION))
    assert_false(joker.should_trigger_on(GlobalEnums.EffectTriggerTiming.ON_TURN_START))

func test_spell_charge_system():
    var spell = SpellData.new()
    spell.charges = 3

    # æµ‹è¯•å……èƒ½æ¶ˆè€—
    assert_true(spell.use())
    assert_eq(spell.charges, 2)

    # æµ‹è¯•å……èƒ½å¢åŠ 
    spell.add_charge(2)
    assert_eq(spell.charges, 4)
```

### é›†æˆæµ‹è¯•

æµ‹è¯•ç³»ç»Ÿé—´çš„åä½œï¼š

```gdscript
# test_ability_integration.gd
extends GutTest

func test_joker_effect_on_score():
    var joker = create_test_joker("SCORE_BONUS", 0.2)
    GameManager.activate_joker(joker)

    var base_score = 100
    var final_score = calculate_score_with_abilities(base_score)

    assert_eq(final_score, 120)  # 100 * 1.2
```

---

## ğŸ“š APIå‚è€ƒ

### JokerData API

```gdscript
# ä¸»è¦æ–¹æ³•
func get_description() -> String          # è·å–æè¿°æ–‡æœ¬
func should_trigger_on(timing: int) -> bool  # æ£€æŸ¥æ˜¯å¦åº”åœ¨æŒ‡å®šæ—¶æœºè§¦å‘
func clone() -> JokerData                # å…‹éš†å®ˆæŠ¤çµæ•°æ®
```

### SpellData API

```gdscript
# ä¸»è¦æ–¹æ³•
func get_info() -> String                # è·å–æ³•æœ¯ä¿¡æ¯
func use() -> bool                       # ä½¿ç”¨æ³•æœ¯ï¼ˆæ¶ˆè€—å……èƒ½ï¼‰
func add_charge(amount: int = 1) -> void # å¢åŠ å……èƒ½
func can_use() -> bool                   # æ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨
```

### ArtifactData API

```gdscript
# ä¸»è¦æ–¹æ³•
func get_description() -> String         # è·å–æè¿°æ–‡æœ¬
func get_info() -> String               # è·å–æ³•å™¨ä¿¡æ¯
func clone() -> ArtifactData            # å…‹éš†æ³•å™¨æ•°æ®
func is_stackable() -> bool             # æ£€æŸ¥æ˜¯å¦å¯å åŠ 
```

---

## ğŸ”® æœªæ¥æ‰©å±•

### è®¡åˆ’åŠŸèƒ½

1. **ç»„åˆæ•ˆæœç³»ç»Ÿ**ï¼š
   - å¤šä¸ªå®ˆæŠ¤çµçš„ååŒæ•ˆæœ
   - æ³•å™¨å¥—è£…æ•ˆæœ
   - æ³•æœ¯è¿å‡»ç³»ç»Ÿ

2. **åŠ¨æ€æ•ˆæœ**ï¼š
   - åŸºäºæ¸¸æˆçŠ¶æ€çš„åŠ¨æ€æ•ˆæœè°ƒæ•´
   - æ¡ä»¶è§¦å‘çš„å¤æ‚æ•ˆæœ
   - æ—¶é—´é™åˆ¶çš„ä¸´æ—¶æ•ˆæœ

3. **è‡ªå®šä¹‰èƒ½åŠ›**ï¼š
   - ç©å®¶è‡ªå®šä¹‰å®ˆæŠ¤çµ
   - æ¨¡ç»„æ”¯æŒç³»ç»Ÿ
   - ç¤¾åŒºå†…å®¹åˆ†äº«

### æŠ€æœ¯æ”¹è¿›

1. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - æ›´é«˜æ•ˆçš„æ•ˆæœè®¡ç®—
   - æ‰¹é‡UIæ›´æ–°
   - å†…å­˜ä½¿ç”¨ä¼˜åŒ–

2. **å¯ç»´æŠ¤æ€§**ï¼š
   - æ›´å¥½çš„ä»£ç æ–‡æ¡£
   - è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–
   - é…ç½®éªŒè¯å·¥å…·

---

## ğŸ¯ æ€»ç»“

å®ˆæŠ¤çµã€æ³•æœ¯ä¸æ³•å™¨ç³»ç»Ÿä¸ºå¥¥æœ¯å­¦é™¢æ‰‘å…‹æä¾›äº†ä¸°å¯Œçš„ç­–ç•¥æ·±åº¦å’Œå¯ç©æ€§ã€‚é€šè¿‡æ•°æ®é©±åŠ¨çš„è®¾è®¡ï¼Œç³»ç»Ÿå…·æœ‰é«˜åº¦çš„å¯é…ç½®æ€§å’Œæ‰©å±•æ€§ï¼Œèƒ½å¤Ÿè½»æ¾æ·»åŠ æ–°çš„èƒ½åŠ›å’Œæ•ˆæœï¼Œä¸ºç©å®¶æä¾›æŒç»­çš„æ–°é²œä½“éªŒã€‚

### æ ¸å¿ƒä¼˜åŠ¿

- **æ¨¡å—åŒ–è®¾è®¡**ï¼šå„ç³»ç»Ÿç‹¬ç«‹ä½†åè°ƒå·¥ä½œ
- **æ•°æ®é©±åŠ¨**ï¼šé…ç½®ä¸ä»£ç åˆ†ç¦»ï¼Œä¾¿äºè°ƒæ•´
- **æ‰©å±•æ€§å¼º**ï¼šæ–°å¢èƒ½åŠ›æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç 
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå¯¹è±¡æ± å’Œäº‹ä»¶ç³»ç»Ÿç¡®ä¿æµç•…ä½“éªŒ
- **æµ‹è¯•å®Œå¤‡**ï¼šå®Œæ•´çš„æµ‹è¯•æ¡†æ¶ä¿è¯è´¨é‡

è¿™å¥—ç³»ç»Ÿä¸ºæ¸¸æˆæä¾›äº†åšå®çš„åŸºç¡€ï¼Œæ”¯æŒæœªæ¥çš„åŠŸèƒ½æ‰©å±•å’Œå†…å®¹æ›´æ–°ã€‚
